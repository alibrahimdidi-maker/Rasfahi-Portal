<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zaad Secure Event Portal</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thaana:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- 1. THEME VARIABLES (MATCHING MAIN SITE) --- */
        :root {
            --royal-blue: #0C2D48;
            --royal-dark: #051626;
            --royal-gold: #B49658;
            --white: #ffffff;
            --bg-color: #f4f6f8;
            --font-dv: 'Noto Sans Thaana', sans-serif; 
            --font-en: 'Playfair Display', serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-dv);
            background-color: var(--bg-color);
            color: #333;
            background-image: radial-gradient(#B49658 0.5px, transparent 0.5px);
            background-size: 40px 40px;
            min-height: 100vh;
            display: flex; flex-direction: column;
        }

        /* --- HEADER & NAV (COPIED FROM MAIN SITE) --- */
        .top-bar {
            background: var(--royal-dark); color: #ddd; padding: 8px 2%;
            display: flex; justify-content: space-between; font-family: var(--font-en); font-size: 0.9em;
            direction: ltr; /* English text needs LTR */
        }
        
        header {
            background: linear-gradient(135deg, var(--royal-blue) 0%, var(--royal-dark) 100%);
            padding: 20px; border-bottom: 5px solid var(--royal-gold); text-align: center;
            color: white;
        }
        .site-title h1 { color: var(--royal-gold); margin: 0; font-size: 1.8em; }
        .site-title span { font-family: var(--font-en); color: #ccc; font-size: 0.8em; letter-spacing: 1px; }

        /* NAVIGATION */
        nav { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #eee; }
        .nav-inner { max-width: 1600px; margin: 0 auto; display: flex; justify-content: center; align-items: center; padding: 0 2%; min-height: 60px; }
        .main-menu { display: flex; list-style: none; gap: 20px; padding: 0; margin: 0; }
        .main-menu li a { display: block; padding: 15px; color: var(--royal-blue); font-weight: bold; text-decoration: none; }
        .main-menu li a:hover { color: var(--royal-gold); }

        /* --- PORTAL SPECIFIC STYLES --- */
        
        /* SEARCH BAR */
        .search-area {
            background: var(--royal-dark); padding: 20px; text-align: center;
            border-bottom: 2px solid var(--royal-gold);
        }
        .search-input {
            width: 100%; max-width: 600px; padding: 12px 20px;
            border: 2px solid var(--royal-gold); border-radius: 50px;
            font-size: 1.1rem; text-align: center; outline: none;
            font-family: var(--font-en);
        }

        /* GRID LAYOUT (FIXED: MULTI-COLUMN) */
        .portal-container {
            max-width: 1600px; margin: 30px auto; padding: 0 20px;
            flex: 1; width: 100%;
        }
        .grid {
            display: grid;
            /* Creates columns that fill the space, min width 300px */
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* CARD DESIGN */
        .card {
            background: white; border: 1px solid #ddd; border-radius: 8px;
            overflow: hidden; box-shadow: 0 3px 6px rgba(0,0,0,0.05);
            transition: 0.3s; position: relative;
            display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(12, 45, 72, 0.15); border-color: var(--royal-gold); }

        .card-header {
            background: linear-gradient(90deg, #f8f9fa, #fff);
            padding: 15px 20px; border-bottom: 1px solid #eee;
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer;
        }
        .cus-id { font-family: var(--font-en); font-weight: bold; font-size: 1.2em; color: var(--royal-blue); }
        .status { font-size: 0.8em; color: #777; background: #eee; padding: 2px 8px; border-radius: 10px; }
        
        /* HIDDEN CONTENT */
        .card-body {
            padding: 20px; display: none; background: #fafafa;
            border-top: 3px solid var(--royal-gold);
        }
        .card.active .card-body { display: block; animation: fadeIn 0.3s; }

        /* LOGIN FORM */
        .login-box { text-align: center; }
        .login-input {
            width: 100%; padding: 10px; margin-bottom: 10px;
            border: 1px solid #ccc; border-radius: 4px; font-family: var(--font-en);
        }
        .login-btn {
            background: var(--royal-blue); color: white; border: none;
            padding: 10px 20px; border-radius: 4px; cursor: pointer; width: 100%; font-weight: bold;
        }
        .login-btn:hover { background: var(--royal-gold); }

        /* SECURE KEY DISPLAY */
        .secure-key-area { display: none; text-align: center; }
        .key-title { color: #27ae60; font-weight: bold; margin-bottom: 10px; display: block; }
        .key-val {
            width: 100%; padding: 10px; background: #fff;
            border: 2px dashed var(--royal-gold); color: var(--royal-blue);
            font-family: monospace; font-weight: bold; font-size: 1.1em;
            text-align: center; margin-bottom: 10px;
        }
        .copy-btn {
            background: #27ae60; color: white; border: none;
            padding: 10px; width: 100%; border-radius: 4px; cursor: pointer;
            font-weight: bold; display: flex; justify-content: center; gap: 8px;
        }

        /* ADMIN TOOLBAR */
        .admin-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: #222; color: white; padding: 15px;
            display: none; justify-content: space-between; align-items: center;
            border-top: 4px solid var(--royal-gold); z-index: 2000;
        }
        .admin-btn { background: var(--royal-gold); color: white; border: none; padding: 8px 20px; cursor: pointer; border-radius: 4px; font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Footer */
        footer { background: var(--royal-blue); color: #aaa; padding: 20px; text-align: center; margin-top: auto; border-top: 4px solid var(--royal-gold); }
    </style>
</head>
<body>

    <div class="top-bar">
        <div>Zaad Event Portal System</div>
        <div><i class="fas fa-lock"></i> Secure Access</div>
    </div>

    <header>
        <div class="site-title">
            <h1>ޒާދް އެކަޑެމީ - އިވެންޓް ޕޯޓަލް</h1>
            <span>ZAAD EVENT PORTAL & KEY DISTRIBUTION SYSTEM</span>
        </div>
    </header>

    <nav>
        <div class="nav-inner">
            <ul class="main-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="event_slideshow.html">Slideshow App</a></li>
                <li><a href="contact.html">Contact Support</a></li>
            </ul>
        </div>
    </nav>

    <div class="search-area">
        <input type="text" class="search-input" id="searchBox" placeholder="Search Customer ID (e.g., CUS-005)..." onkeyup="filterCards()">
    </div>

    <div class="portal-container">
        <div class="grid" id="gridContainer">
            </div>
    </div>

    <footer>
        <div ondblclick="openAdminMode()" style="cursor: pointer;">
            &copy; 2025 Zaad Academy. All Rights Reserved. (Double Click for Admin)
        </div>
    </footer>

    <div class="admin-bar" id="adminToolbar">
        <div>
            <strong>ADMIN MODE ACTIVE</strong><br>
            <small>You can now edit Keys inside cards and Save.</small>
        </div>
        <div>
            <button class="admin-btn" onclick="downloadMasterList()">1. Download CSV List</button>
            <button class="admin-btn" onclick="saveAndDownload()" style="background:#27ae60;">2. Save & Download HTML</button>
        </div>
    </div>

    <script id="data-script">
        // --- DATABASE CONFIGURATION ---
        // This array holds all customer data. 
        // Admin Mode creates this.
        var db = []; 
        const TOTAL_CARDS = 500;

        // Helper: Random Generator
        function randStr(len) {
            const c = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let r = ''; for(let i=0; i<len; i++) r+=c.charAt(Math.floor(Math.random()*c.length));
            return r;
        }

        // --- 1. INITIALIZE / GENERATE DATA ---
        function init() {
            // If DB is empty (first run), generate it.
            if(db.length === 0) {
                for(let i=1; i<=TOTAL_CARDS; i++) {
                    let num = i.toString().padStart(3,'0');
                    db.push({
                        id: `CUS-${num}`,
                        user: `USER${num}`,
                        pass: randStr(6),
                        // Default empty key. Admin will paste real key here later.
                        key: "NO-KEY-ASSIGNED-YET" 
                    });
                }
            }
            render();
        }

        // --- 2. RENDER CARDS ---
        function render() {
            const grid = document.getElementById('gridContainer');
            let html = '';

            db.forEach((item, index) => {
                html += `
                <div class="card" data-id="${item.id}" id="card-${index}">
                    <div class="card-header" onclick="toggleCard(${index})">
                        <div class="cus-id"><i class="fas fa-id-card-alt"></i> ${item.id}</div>
                        <div class="status"><i class="fas fa-lock"></i> Locked</div>
                    </div>
                    <div class="card-body">
                        
                        <div class="login-box" id="login-${index}">
                            <p style="font-size:0.9em; margin-bottom:10px;">Enter credentials to retrieve Gig Key:</p>
                            <input type="text" class="login-input" id="u-${index}" placeholder="Username">
                            <input type="password" class="login-input" id="p-${index}" placeholder="Password">
                            <button class="login-btn" onclick="checkLogin(${index})">UNLOCK</button>
                        </div>

                        <div class="secure-key-area" id="secure-${index}">
                            <span class="key-title">ACCESS GRANTED</span>
                            <p style="font-size:0.85em; margin-bottom:5px;">Copy this code and paste it in the Slideshow App:</p>
                            
                            <input type="text" class="key-val" id="key-field-${index}" value="${item.key}" readonly>
                            
                            <button class="copy-btn" id="btn-${index}" onclick="copyKey(${index})">
                                <i class="fas fa-copy"></i> COPY KEY
                            </button>
                            
                            <button class="login-btn" id="adm-save-${index}" style="display:none; margin-top:10px; background:#e67e22;" onclick="updateKey(${index})">
                                UPDATE KEY IN DB
                            </button>
                        </div>

                    </div>
                </div>`;
            });
            grid.innerHTML = html;
        }

        // --- 3. INTERACTION ---
        function toggleCard(index) {
            // Close others (optional) - uncomment to allow only one open
            // document.querySelectorAll('.card.active').forEach(c => c.classList.remove('active'));
            document.getElementById(`card-${index}`).classList.toggle('active');
        }

        function checkLogin(index) {
            const u = document.getElementById(`u-${index}`).value;
            const p = document.getElementById(`p-${index}`).value;
            
            // Check against DB
            if(u === db[index].user && p === db[index].pass) {
                document.getElementById(`login-${index}`).style.display = 'none';
                document.getElementById(`secure-${index}`).style.display = 'block';
                // Change Header Status
                document.querySelector(`#card-${index} .status`).innerHTML = '<i class="fas fa-unlock"></i> Open';
                document.querySelector(`#card-${index}`).style.borderColor = '#27ae60';
            } else {
                alert("Incorrect Username or Password!");
            }
        }

        function copyKey(index) {
            const k = document.getElementById(`key-field-${index}`);
            k.select(); k.setSelectionRange(0,99999);
            navigator.clipboard.writeText(k.value);
            const b = document.getElementById(`btn-${index}`);
            b.innerHTML = '<i class="fas fa-check"></i> COPIED!';
            b.style.background = '#27ae60';
            setTimeout(() => { 
                b.innerHTML = '<i class="fas fa-copy"></i> COPY KEY'; 
            }, 2000);
        }

        function filterCards() {
            const q = document.getElementById('searchBox').value.toUpperCase();
            document.querySelectorAll('.card').forEach(c => {
                c.style.display = c.dataset.id.includes(q) ? 'flex' : 'none';
            });
        }

        // --- 4. ADMIN FUNCTIONS ---
        let adminMode = false;

        function openAdminMode() {
            if(adminMode) return;
            const p = prompt("Enter Admin Password:");
            if(p === "admin123") {
                adminMode = true;
                document.getElementById('adminToolbar').style.display = 'flex';
                alert("Admin Mode Active!\n1. You can now download the Excel list of passwords.\n2. You can search for a card, login (auto), and paste the real Gig Key.");
                enableAdminFeatures();
            }
        }

        function enableAdminFeatures() {
            db.forEach((item, idx) => {
                // Remove readonly from key fields
                const kf = document.getElementById(`key-field-${idx}`);
                if(kf) {
                    kf.removeAttribute('readonly');
                    kf.style.borderColor = 'red';
                }
                // Show update buttons
                const btn = document.getElementById(`adm-save-${idx}`);
                if(btn) btn.style.display = 'block';
                
                // Auto Unlock all cards for admin visibility (Optional, cleaner to keep closed)
                // But let's allow Admin to bypass login by adding a secret attribute
            });
        }

        function updateKey(index) {
            const newKey = document.getElementById(`key-field-${index}`).value;
            db[index].key = newKey; // Update Memory
            alert("Key Updated in Memory! Remember to click 'Save & Download HTML' at the bottom to make it permanent.");
        }

        function downloadMasterList() {
            let csv = "Customer ID,Username,Password,Current Key\n";
            db.forEach(row => {
                csv += `${row.id},${row.user},${row.pass},${row.key}\n`;
            });
            const link = document.createElement("a");
            link.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            link.download = "zaad_master_list.csv";
            link.click();
        }

        function saveAndDownload() {
            // Serialize DB back to string
            const dbString = JSON.stringify(db);
            
            // Get current HTML
            let html = document.documentElement.outerHTML;
            
            // Replace the init logic so the new DB is hardcoded
            // We find the db variable definition and replace it
            const pattern = /var db = \[\];/;
            if(html.match(pattern)) {
                 // First save replaces the empty array
                 html = html.replace(pattern, `var db = ${dbString};`);
            } else {
                // Subsequent saves need to find the existing populated array
                // This is a bit complex with regex, so simpler method:
                // We reload the page logic. 
                // For this simple version, let's assume first save works best.
                // Or better: Let's replace the entire script block if needed.
                
                // ROBUST METHOD:
                const startMarker = 'var db = ';
                const endMarker = '; const TOTAL_CARDS';
                const startPos = html.indexOf(startMarker);
                const endPos = html.indexOf(endMarker);
                
                if(startPos > -1 && endPos > -1) {
                    const before = html.substring(0, startPos + startMarker.length);
                    const after = html.substring(endPos);
                    html = before + dbString + after;
                }
            }

            const blob = new Blob(['<!DOCTYPE html>\n' + html], {type: "text/html"});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = "event-portal.html";
            a.click();
        }

        // START
        window.onload = init;

    </script>
</body>
</html>
