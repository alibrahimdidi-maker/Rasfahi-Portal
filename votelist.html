<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidential Suite v11 - Branding Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face { font-family: 'Faruma'; src: local('Faruma'), local('MV Boli'); }
        :root { 
            --royal-blue: #000c1a; --gold: #c5a059; --pure-white: #ffffff;
            --my-color: #c5a059; --opp-color: #d32f2f;
        }
        
        body { font-family: 'Faruma', sans-serif; background-color: var(--royal-blue); color: var(--pure-white); margin: 0; transition: 0.3s; }
        .header-panel { background: linear-gradient(to bottom, #001a33, #000c1a); border-bottom: 3px solid var(--gold); padding: 25px; text-align: center; }
        
        /* Branding Controls */
        .branding-bar { background: rgba(255,255,255,0.05); margin: 10px 20px; padding: 15px; border-radius: 10px; border: 1px solid var(--gold); display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: center; }
        .color-input { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }

        /* Analytics */
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; padding: 20px; }
        .chart-box { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; height: 350px; }

        /* Candidate Entry */
        .candidate-grid { background: rgba(255,255,255,0.03); margin: 20px; padding: 20px; border-radius: 15px; border: 1px solid var(--gold); }
        .candidate-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .cand-row { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; border: 1px solid #444; }
        .cand-row input { width: 90%; padding: 8px; margin-top: 5px; border: 1px solid var(--gold); background: #001a33; color: white; border-radius: 4px; }

        /* Actions */
        .action-bar { padding: 15px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; background: white; margin: 20px; border-radius: 10px; color: black; }
        .btn { padding: 10px 18px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Faruma'; font-weight: bold; }
        .btn-gold { background: var(--gold); color: white; }
        
        /* Table */
        .table-container { margin: 20px; background: white; border-radius: 10px; overflow-x: auto; color: black; }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 12px; }
        td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; }

        .btn-status { width: 35px; height: 35px; border-radius: 50%; border: 1px solid #ccc; cursor: pointer; }
        .active-yes { background-color: var(--my-color) !important; color: white; }
        .active-no { background-color: var(--opp-color) !important; color: white; }
        
        @media (max-width: 768px) { table { display: none; } .mobile-card { background: white; color: black; margin: 10px; padding: 15px; border-radius: 10px; border-right: 5px solid var(--gold); } }
    </style>
</head>
<body>

<div class="header-panel">
    <h1 id="main-title">PRESIDENTIAL COMMAND SUITE</h1>
    <div style="margin-top:10px;">
        <button class="btn btn-gold" onclick="setLang('dv')">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</button>
        <button class="btn btn-gold" onclick="setLang('en')">English</button>
    </div>
</div>

<div class="branding-bar no-print">
    <div class="color-input">
        <label id="lbl-my-col">ﬁâﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ﬁÜﬁ™ﬁçﬁ¶:</label>
        <input type="color" id="myColor" value="#c5a059" onchange="applyBranding()">
    </div>
    <div class="color-input">
        <label id="lbl-opp-col">ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™ ﬁÜﬁ™ﬁçﬁ¶:</label>
        <input type="color" id="oppColor" value="#d32f2f" onchange="applyBranding()">
    </div>
    <div class="color-input">
        <label id="lbl-font">ﬁäﬁ¶ﬁÉﬁ™ﬁâﬁß ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ (TTF):</label>
        <input type="file" id="fontFile" accept=".ttf" onchange="loadCustomFont(this)">
    </div>
</div>



<div class="analytics-grid">
    <div class="chart-box"><canvas id="supportChart"></canvas></div>
    <div class="chart-box"><canvas id="candidateChart"></canvas></div>
</div>

<div class="candidate-grid">
    <h3 id="h-results">ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁÇﬁ¶ﬁåﬁ©ﬁñﬁß (Manual Input)</h3>
    <div class="candidate-inputs" id="candidateList"></div>
</div>

<div class="action-bar no-print">
    <select id="st_filter" style="padding:10px;" onchange="updateUI()"><option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option></select>
    <input type="text" id="srch" placeholder="ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß..." style="padding:10px; flex:1;" oninput="updateUI()">
    <button class="btn btn-gold" onclick="download2000Dummy()">2000 ﬁëﬁ¶ﬁâﬁ©</button>
    <button class="btn btn-gold" onclick="document.getElementById('fIn').click()">Import CSV</button>
    <button class="btn btn-gold" style="background:#d32f2f;" onclick="clearMem()">Clear Memory</button>
    <input type="file" id="fIn" hidden onchange="importCSV(event)">
</div>

<div id="voterArea"></div>

<script>
    let voters = JSON.parse(localStorage.getItem('v11_db')) || [];
    let candRes = JSON.parse(localStorage.getItem('v11_cands')) || [
        {name: 'ﬁâﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞', votes: 0}, 
        ...Array.from({length: 10}, (_, i) => ({name: `ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ${i+1}`, votes: 0}))
    ];
    let charts = {};
    let currentLang = 'dv';

    const langData = {
        dv: { title: "ﬁïﬁ∞ﬁÉﬁ¨ﬁíﬁ®ﬁëﬁ¨ﬁÇﬁ∞ﬁùﬁ¶ﬁçﬁ∞ ﬁÜﬁÆﬁâﬁßﬁÇﬁ∞ﬁëﬁ∞ ﬁêﬁ™ﬁáﬁ©ﬁìﬁ∞", myCol: "ﬁâﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ﬁÜﬁ™ﬁçﬁ¶:", oppCol: "ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™ ﬁÜﬁ™ﬁçﬁ¶:", font: "ﬁäﬁ¶ﬁÉﬁ™ﬁâﬁß ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ (TTF):", results: "ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁÇﬁ¶ﬁåﬁ©ﬁñﬁß", sup: "ﬁåﬁßﬁáﬁ©ﬁãﬁ™", opp: "ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™", none: "ﬁÇﬁ™ﬁÇﬁ®ﬁÇﬁ∞ﬁâﬁß", name: "ﬁÇﬁ¶ﬁÇﬁ∞", id: "ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©", st: "ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", ph: "ﬁäﬁØﬁÇﬁ™" },
        en: { title: "PRESIDENTIAL COMMAND SUITE", myCol: "My Candidate Color:", oppCol: "Opponent Color:", font: "Custom Font (TTF):", results: "Candidate Results", sup: "Support", opp: "Opponent", none: "Undecided", name: "Name", id: "ID", st: "Station", ph: "Phone" }
    };

    function init() {
        renderCands();
        const commonStyle = { color: '#fff', font: { family: 'Faruma' } };
        
        charts.s = new Chart(document.getElementById('supportChart'), {
            type: 'pie',
            data: { labels: [], datasets: [{ data: [0,0,0], backgroundColor: [] }] },
            options: { maintainAspectRatio: false, plugins: { legend: { labels: commonStyle } } }
        });

        charts.c = new Chart(document.getElementById('candidateChart'), {
            type: 'bar',
            data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
            options: { 
                maintainAspectRatio: false, 
                plugins: { legend: { display: false } },
                scales: { y: { ticks: commonStyle }, x: { ticks: commonStyle } }
            }
        });

        applyBranding();
        populateStations();
    }

    function setLang(l) {
        currentLang = l;
        document.body.dir = l === 'dv' ? 'rtl' : 'ltr';
        const d = langData[l];
        document.getElementById('main-title').innerText = d.title;
        document.getElementById('lbl-my-col').innerText = d.myCol;
        document.getElementById('lbl-opp-col').innerText = d.oppCol;
        document.getElementById('lbl-font').innerText = d.font;
        document.getElementById('h-results').innerText = d.results;
        updateUI();
    }

    function loadCustomFont(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const newFont = new FontFace('CustomFaruma', e.target.result);
                newFont.load().then(f => {
                    document.fonts.add(f);
                    document.body.style.fontFamily = 'CustomFaruma, Faruma, sans-serif';
                    updateUI();
                });
            };
            reader.readAsArrayBuffer(input.files[0]);
        }
    }

    function applyBranding() {
        const myC = document.getElementById('myColor').value;
        const oppC = document.getElementById('oppColor').value;
        document.documentElement.style.setProperty('--my-color', myC);
        document.documentElement.style.setProperty('--opp-color', oppC);
        updateUI();
    }

    function renderCands() {
        document.getElementById('candidateList').innerHTML = candRes.map((c, i) => `
            <div class="cand-row" style="${i===0?'border-color:var(--my-color)':''}">
                <input type="text" value="${c.name}" oninput="updateCand(${i},'name',this.value)">
                <input type="number" value="${c.votes}" oninput="updateCand(${i},'votes',this.value)">
            </div>`).join('');
    }

    function updateCand(i, f, v) {
        if(f==='votes') candRes[i].votes = parseInt(v) || 0;
        else candRes[i].name = v;
        localStorage.setItem('v11_cands', JSON.stringify(candRes));
        updateUI();
    }

    function updateUI() {
        const myC = document.getElementById('myColor').value;
        const oppC = document.getElementById('oppColor').value;
        const d = langData[currentLang];

        // Support Chart
        charts.s.data.labels = [d.sup, d.opp, d.none];
        charts.s.data.datasets[0].data = [voters.filter(v=>v.sup==='yes').length, voters.filter(v=>v.sup==='no').length, voters.filter(v=>v.sup==='none').length];
        charts.s.data.datasets[0].backgroundColor = [myC, oppC, '#444'];
        charts.s.update();

        // Candidate Chart
        charts.c.data.labels = candRes.map(c => c.name);
        charts.c.data.datasets[0].data = candRes.map(c => c.votes);
        charts.c.data.datasets[0].backgroundColor = candRes.map((_, i) => i === 0 ? myC : oppC);
        charts.c.update();

        // Table Filter & Render
        const f_st = document.getElementById('st_filter').value;
        const q = document.getElementById('srch').value.toLowerCase();
        const filtered = voters.filter(v => (f_st==='all' || v.st===f_st) && (v.name.toLowerCase().includes(q) || v.id.toLowerCase().includes(q)));

        const area = document.getElementById('voterArea');
        if(window.innerWidth < 768) {
            area.innerHTML = filtered.map(v => `<div class="mobile-card"><b>${v.name}</b><br>${v.id} | ${v.ph}<br>
                <button class="btn-status ${v.sup==='yes'?'active-yes':''}" onclick="tSup(${voters.indexOf(v)},'yes')">üëç</button>
                <button class="btn-status ${v.sup==='no'?'active-no':''}" onclick="tSup(${voters.indexOf(v)},'no')">üëé</button>
            </div>`).join('');
        } else {
            area.innerHTML = `<div class="table-container"><table><thead><tr><th>${d.name}</th><th>${d.id}</th><th>${d.st}</th><th>${d.ph}</th><th>${d.sup}</th></tr></thead>
                <tbody>${filtered.map(v => `<tr><td>${v.name}</td><td>${v.id}</td><td>${v.st}</td><td>${v.ph}</td>
                <td><button class="btn-status ${v.sup==='yes'?'active-yes':''}" onclick="tSup(${voters.indexOf(v)},'yes')">üëç</button> 
                <button class="btn-status ${v.sup==='no'?'active-no':''}" onclick="tSup(${voters.indexOf(v)},'no')">üëé</button></td></tr>`).join('')}</tbody></table></div>`;
        }
    }

    function tSup(i, v) { voters[i].sup = voters[i].sup===v ? 'none' : v; localStorage.setItem('v11_db', JSON.stringify(voters)); updateUI(); }
    function download2000Dummy() {
        let csv = "No,Name,ID,Address,Cur,Station,Phone1\n";
        for(let i=1; i<=2000; i++) csv += `${i},Voter ${i},A${i},Home,City,Station ${Math.ceil(i/100)},777${i}\n`;
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'})); a.download="Dummy2000.csv"; a.click();
    }
    function importCSV(e) {
        const r = new FileReader();
        r.onload = (ev) => {
            const lines = ev.target.result.split('\n').slice(1);
            voters = lines.map(l => { const d = l.split(','); return d.length>5?{name:d[1], id:d[2], st:d[5], ph:d[6], sup:'none'}:null; }).filter(x=>x);
            localStorage.setItem('v11_db', JSON.stringify(voters)); populateStations(); updateUI();
        };
        r.readAsText(e.target.files[0]);
    }
    function populateStations() {
        const sts = [...new Set(voters.map(v => v.st))];
        document.getElementById('st_filter').innerHTML = '<option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option>' + sts.map(s => `<option value="${s}">${s}</option>`).join('');
    }
    function clearMem() { if(confirm("Clear?")) { localStorage.clear(); location.reload(); } }

    window.onload = init;
</script>
</body>
</html>
