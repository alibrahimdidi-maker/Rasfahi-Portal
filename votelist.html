<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Presidential Election Suite</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --royal-blue: #00172d;
            --gold: #c5a059;
            --gold-light: #e2c275;
            --pure-white: #ffffff;
            --danger: #b22222;
            --success: #1a5e1a;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', 'MV Boli', sans-serif;
            background-color: var(--royal-blue);
            color: var(--pure-white);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* Royal Header & Dashboard */
        .header {
            background: linear-gradient(145deg, #001f3f, #000c1a);
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid var(--gold);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .title-gold {
            color: var(--gold);
            font-size: 2.5rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .chart-container {
            background: var(--glass);
            border: 1px solid var(--gold);
            border-radius: 15px;
            padding: 20px;
            height: 300px;
        }

        /* Presidential Inputs */
        .control-panel {
            padding: 20px;
            background: var(--pure-white);
            color: #000;
            margin: 20px;
            border-radius: 10px;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 5px;
            font-size: 1rem;
        }

        .btn-royal {
            background: var(--gold);
            color: var(--royal-blue);
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn-royal:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
        }

        /* Table Design */
        .table-wrapper {
            overflow-x: auto;
            margin: 20px;
            background: var(--pure-white);
            border-radius: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #000;
        }

        th {
            background: var(--royal-blue);
            color: var(--gold);
            padding: 15px;
            white-space: nowrap;
        }

        td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .status-pill {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .support-yes { background: #d4edda; color: #155724; }
        .support-no { background: #f8d7da; color: #721c24; }

        @media print {
            .control-panel, .btn-royal { display: none; }
            body { background: white; color: black; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1 class="title-gold">PRESIDENTIAL ELECTION SUITE</h1>
    <div style="margin-top: 10px;">
        <button class="btn-royal" onclick="exportCSV()">Export CSV</button>
        <button class="btn-royal" onclick="window.print()">Print Report</button>
        <button class="btn-royal" onclick="switchLang()" id="langBtn">English</button>
    </div>
</div>

<div class="dashboard-grid">
    <div class="chart-container">
        <canvas id="supportChart"></canvas>
    </div>
    <div class="chart-container">
        <canvas id="votingChart"></canvas>
    </div>
</div>

<div class="control-panel">
    <h3>މަޢުލޫމާތު އިތުރުކުރައްވާ (Data Entry)</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
        <input type="text" id="v_name" placeholder="ފުރިހަމަ ނަން">
        <input type="text" id="v_id" placeholder="އައިޑީ ކާޑު ނަންބަރު">
        <input type="text" id="v_address" placeholder="ދާއިމީ އެޑްރެސް">
        <input type="text" id="v_phone" placeholder="ފޯނު 1">
        <select id="v_support">
            <option value="none">ތާއީދު ބެލުން...</option>
            <option value="yes">ތާއީދުކުރޭ</option>
            <option value="no">ތާއީދު ނުކުރޭ</option>
            <option value="undecided">ވަކި ގޮތެއް ނުނިންމާ</option>
        </select>
        <select id="v_voted">
            <option value="no">ވޯޓު ނުލާ</option>
            <option value="yes">ވޯޓުލައިފި</option>
        </select>
    </div>
    <button class="btn-royal" style="margin-top: 15px;" onclick="addVoter()">ލިސްޓަށް އިތުރުކުރޭ</button>
</div>

<div class="table-wrapper">
    <table id="voterTable">
        <thead>
            <tr>
                <th>ނަން</th>
                <th>އައިޑީ ކާޑު</th>
                <th>އެޑްރެސް</th>
                <th>ފޯނު</th>
                <th>ތާއީދު</th>
                <th>ވޯޓު</th>
                <th>ކޮމެންޓް</th>
            </tr>
        </thead>
        <tbody id="voterBody"></tbody>
    </table>
</div>

<script>
    let voters = JSON.parse(localStorage.getItem('royal_voters')) || [];
    let supportChart, votingChart;

    // Initialize Charts
    function initCharts() {
        const ctx1 = document.getElementById('supportChart').getContext('2d');
        const ctx2 = document.getElementById('votingChart').getContext('2d');

        supportChart = new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: ['ތާއީދުކުރޭ', 'ނުކުރޭ', 'ނުނިންމާ'],
                datasets: [{
                    label: 'ތާއީދު ހުރި މިންވަރު',
                    data: [0, 0, 0],
                    backgroundColor: ['#c5a059', '#b22222', '#555']
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        votingChart = new Chart(ctx2, {
            type: 'pie',
            data: {
                labels: ['ވޯޓުލީ', 'ވޯޓު ނުލާ'],
                datasets: [{
                    data: [0, 100],
                    backgroundColor: ['#1a5e1a', '#00172d']
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
        updateCharts();
    }

    function addVoter() {
        const voter = {
            name: document.getElementById('v_name').value,
            id: document.getElementById('v_id').value,
            address: document.getElementById('v_address').value,
            phone: document.getElementById('v_phone').value,
            support: document.getElementById('v_support').value,
            voted: document.getElementById('v_voted').value,
            comment: ""
        };

        if(!voter.name) return alert("ނަން ފުރިހަމަކުރައްވާ");
        
        voters.push(voter);
        saveAndRender();
        
        // Clear inputs
        document.querySelectorAll('.control-panel input').forEach(i => i.value = "");
    }

    function saveAndRender() {
        localStorage.setItem('royal_voters', JSON.stringify(voters));
        renderTable();
        updateCharts();
    }

    function renderTable() {
        const tbody = document.getElementById('voterBody');
        tbody.innerHTML = voters.map((v, index) => `
            <tr>
                <td>${v.name}</td>
                <td>${v.id}</td>
                <td>${v.address}</td>
                <td>${v.phone}</td>
                <td><span class="status-pill support-${v.support}">${v.support}</span></td>
                <td>${v.voted === 'yes' ? '✅' : '❌'}</td>
                <td><input type="text" onchange="updateComment(${index}, this.value)" value="${v.comment || ''}"></td>
            </tr>
        `).join('');
    }

    function updateCharts() {
        const yes = voters.filter(v => v.support === 'yes').length;
        const no = voters.filter(v => v.support === 'no').length;
        const maybe = voters.filter(v => v.support === 'undecided').length;
        const voted = voters.filter(v => v.voted === 'yes').length;

        supportChart.data.datasets[0].data = [yes, no, maybe];
        supportChart.update();

        votingChart.data.datasets[0].data = [voted, voters.length - voted];
        votingChart.update();
    }

    function exportCSV() {
        let csv = "Name,ID,Address,Phone,Support,Voted\n";
        voters.forEach(v => {
            csv += `${v.name},${v.id},${v.address},${v.phone},${v.support},${v.voted}\n`;
        });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('href', url);
        a.setAttribute('download', 'election_report.csv');
        a.click();
    }

    function updateComment(index, val) {
        voters[index].comment = val;
        saveAndRender();
    }

    window.onload = initCharts;
</script>
</body>
</html>
