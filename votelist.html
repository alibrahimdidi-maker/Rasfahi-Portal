<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidential Suite v6 - Final Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --royal-bg: #000814;
            --gold: #c5a059;
            --support-bar-color: #c5a059;
            --vote-bar-color: #2e7d32;
        }

        @font-face { font-family: 'Faruma'; src: local('Faruma'), local('MV Boli'); }
        body { font-family: 'Faruma', sans-serif; background-color: var(--royal-bg); color: #fff; margin: 0; transition: 0.3s; }

        /* Interface Layout */
        .executive-header {
            background: linear-gradient(180deg, #001d3d, #000814);
            padding: 30px; border-bottom: 2px solid var(--gold); text-align: center;
        }

        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; padding: 20px; }
        .chart-card { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; height: 350px; }

        /* Controls */
        .control-panel { background: #fff; color: #000; margin: 20px; padding: 20px; border-radius: 10px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .royal-btn { background: var(--gold); color: #000; border: none; padding: 10px 20px; font-weight: bold; border-radius: 4px; cursor: pointer; font-family: 'Faruma'; }
        
        /* Table Styles */
        .table-wrapper { margin: 20px; background: #fff; color: #000; border-radius: 10px; overflow: auto; max-height: 600px; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th { background: #001d3d; color: var(--gold); padding: 15px; position: sticky; top: 0; }
        td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }

        /* Mobile View Cards */
        @media (max-width: 768px) {
            .desktop-only { display: none; }
            .mobile-card { background: #fff; color: #000; margin: 10px; padding: 15px; border-radius: 10px; border-right: 6px solid var(--gold); }
            .card-btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 10px; }
        }

        .active-yes { background: var(--support-bar-color) !important; color: white !important; }
        .active-no { background: #d32f2f !important; color: white !important; }
        .active-vote { background: var(--vote-bar-color) !important; color: white !important; }
    </style>
</head>
<body onbeforeunload="return 'ﬁâﬁ¶ﬁ¢ﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ™ ﬁêﬁ≠ﬁàﬁ∞ﬁÜﬁ™ﬁÉﬁ¨ﬁáﬁ∞ﬁàﬁ®ﬁÇﬁ∞ﬁåﬁØÿü'">

<div class="executive-header">
    <h1 id="appTitle">ﬁùﬁßﬁÄﬁ© ﬁáﬁ®ﬁÇﬁ∞ﬁåﬁ®ﬁöﬁßﬁÑﬁ© ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™</h1>
    <div style="margin-top: 15px; display: flex; justify-content: center; gap: 10px;">
        <button class="royal-btn" onclick="changeLang('dv')">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</button>
        <button class="royal-btn" onclick="changeLang('en')">English</button>
    </div>
    <div style="margin-top: 20px; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
        <div><label>ﬁåﬁßﬁáﬁ©ﬁãﬁ™ ﬁÑﬁß ﬁÜﬁ™ﬁçﬁ¶: </label><input type="color" id="supColor" value="#c5a059" onchange="updateColors()"></div>
        <div><label>ﬁàﬁØﬁìﬁ™ ﬁÑﬁß ﬁÜﬁ™ﬁçﬁ¶: </label><input type="color" id="voteColor" value="#2e7d32" onchange="updateColors()"></div>
        <div><label>ﬁäﬁ¶ﬁÉﬁ™ﬁâﬁß ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ (Local): </label><input type="file" id="fontUp" accept=".ttf" onchange="loadFont(this)"></div>
    </div>
</div>

<div class="dashboard-grid">
    <div class="chart-card"><canvas id="chartSup"></canvas></div>
    <div class="chart-card"><canvas id="chartVote"></canvas></div>
</div>

<div class="control-panel">
    <input type="text" id="searchInput" placeholder="ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß (ﬁÇﬁ¶ﬁÇﬁ∞ ﬁÇﬁ™ﬁàﬁ¶ﬁåﬁ¶ ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©)..." style="padding:10px; width:250px;" oninput="render()">
    <button class="royal-btn" onclick="downloadTemplate()">ﬁëﬁ¶ﬁâﬁ© ﬁäﬁ¶ﬁáﬁ®ﬁçﬁ∞ ﬁëﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁçﬁØﬁëﬁ∞</button>
    <input type="file" id="csvIn" style="display:none" onchange="importData(this)">
    <button class="royal-btn" onclick="document.getElementById('csvIn').click()">CSV ﬁáﬁ®ﬁâﬁ∞ﬁïﬁØﬁìﬁ∞</button>
    <button class="royal-btn" onclick="window.print()">ﬁïﬁ∞ﬁÉﬁ®ﬁÇﬁ∞ﬁìﬁ∞ / PDF</button>
</div>

<div id="mainView"></div>

<script>
    let voters = JSON.parse(localStorage.getItem('election_db_v6')) || [];
    let curLang = 'dv';
    let sChart, vChart;

    const ui = {
        dv: { title: "ﬁùﬁßﬁÄﬁ© ﬁáﬁ®ﬁÇﬁ∞ﬁåﬁ®ﬁöﬁßﬁÑﬁ© ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", name: "ﬁÇﬁ¶ﬁÇﬁ∞", id: "ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©", perm: "ﬁãﬁßﬁáﬁ®ﬁâﬁ© ﬁáﬁ¨ﬁëﬁ∞ﬁÉﬁ¨ﬁêﬁ∞", cur: "ﬁãﬁ®ﬁÉﬁ®ﬁáﬁ™ﬁÖﬁ≠ ﬁáﬁ¨ﬁëﬁ∞ﬁÉﬁ¨ﬁêﬁ∞", st: "ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", p1: "ﬁäﬁØﬁÇﬁ™ 1", p2: "ﬁäﬁØﬁÇﬁ™ 2", sup: "ﬁåﬁßﬁáﬁ©ﬁãﬁ™", vote: "ﬁàﬁØﬁìﬁ™", comm: "ﬁÜﬁÆﬁâﬁ¨ﬁÇﬁ∞ﬁìﬁ∞" },
        en: { title: "Presidential Election Suite", name: "Name", id: "ID", perm: "Perm. Address", cur: "Current Address", st: "Station", p1: "Phone 1", p2: "Phone 2", sup: "Support", vote: "Vote", comm: "Comment" }
    };

    function changeLang(l) {
        curLang = l;
        document.body.dir = (l === 'dv') ? 'rtl' : 'ltr';
        document.getElementById('appTitle').innerText = ui[l].title;
        render();
    }

    function updateColors() {
        const sCol = document.getElementById('supColor').value;
        const vCol = document.getElementById('voteColor').value;
        document.documentElement.style.setProperty('--support-bar-color', sCol);
        document.documentElement.style.setProperty('--vote-bar-color', vCol);
        updateCharts();
        render();
    }

    function loadFont(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const f = new FontFace('Faruma', e.target.result);
            f.load().then(loaded => { document.fonts.add(loaded); document.body.style.fontFamily = 'Faruma'; });
        };
        reader.readAsArrayBuffer(file);
    }

    function downloadTemplate() {
        let csv = "No,Full Name,ID Card,Permanent Address,Current Address,Station,Phone1,Phone2\n";
        for(let i=1; i<=100; i++) csv += `${i},Voter ${i},A${100000+i},H. Perm ${i},H. Current ${i},Polling Station ${Math.ceil(i/10)},77700${i},99900${i}\n`;
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "Election_Template.csv"; a.click();
    }

    function importData(input) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const rows = e.target.result.split('\n').slice(1);
            voters = rows.map(row => {
                const c = row.split(',').map(s => s.trim());
                if(c.length < 5) return null;
                return { name: c[1], id: c[2], perm: c[3], cur: c[4], st: c[5], p1: c[6], p2: c[7], sup: 'none', voted: false, comm: '' };
            }).filter(v => v);
            save();
        };
        reader.readAsText(input.files[0]);
    }

    function save() { localStorage.setItem('election_db_v6', JSON.stringify(voters)); render(); updateCharts(); }

    function updateV(i, key, val) {
        if(key === 'sup' && voters[i].sup === val) voters[i].sup = 'none';
        else voters[i][key] = val;
        save();
    }

    function render() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const filtered = voters.filter(v => v.name.toLowerCase().includes(q) || v.id.toLowerCase().includes(q));
        const view = document.getElementById('mainView');
        const l = ui[curLang];

        if(window.innerWidth < 768) {
            view.innerHTML = filtered.map((v, i) => `
                <div class="mobile-card">
                    <b>${v.name}</b><br><small>${v.id} | ${v.st}</small><br><small>${v.p1} / ${v.p2}</small>
                    <div class="card-btn-group">
                        <button class="royal-btn ${v.sup==='yes'?'active-yes':''}" onclick="updateV(${voters.indexOf(v)},'sup','yes')">üëç</button>
                        <button class="royal-btn ${v.sup==='no'?'active-no':''}" onclick="updateV(${voters.indexOf(v)},'sup','no')">üëé</button>
                        <button class="royal-btn ${v.voted?'active-vote':''}" style="grid-column: span 2" onclick="updateV(${voters.indexOf(v)},'voted',!v.voted)">${v.voted?'ﬁàﬁØﬁìﬁ™ﬁçﬁ¶ﬁáﬁ®ﬁäﬁ®':'ﬁàﬁØﬁìﬁ™ ﬁÇﬁ™ﬁçﬁß'}</button>
                    </div>
                </div>`).join('');
        } else {
            view.innerHTML = `<div class="table-wrapper"><table><thead><tr>
                <th>${l.name}</th><th>${l.id}</th><th>${l.perm}</th><th>${l.cur}</th><th>${l.st}</th><th>${l.p1}</th><th>${l.sup}</th><th>${l.vote}</th><th>${l.comm}</th>
            </tr></thead><tbody>${filtered.map((v, i) => `<tr>
                <td>${v.name}</td><td>${v.id}</td><td>${v.perm}</td><td>${v.cur}</td><td>${v.st}</td><td>${v.p1}</td>
                <td><button class="royal-btn ${v.sup==='yes'?'active-yes':''}" onclick="updateV(${voters.indexOf(v)},'sup','yes')">üëç</button>
                <button class="royal-btn ${v.sup==='no'?'active-no':''}" onclick="updateV(${voters.indexOf(v)},'sup','no')">üëé</button></td>
                <td><button class="royal-btn ${v.voted?'active-vote':''}" onclick="updateV(${voters.indexOf(v)},'voted',!v.voted)">${v.voted?'‚úÖ':'üó≥Ô∏è'}</button></td>
                <td><input type="text" value="${v.comm}" onchange="voters[${voters.indexOf(v)}].comm=this.value;save()"></td>
            </tr>`).join('')}</tbody></table></div>`;
        }
    }

    function initCharts() {
        sChart = new Chart(document.getElementById('chartSup'), { type: 'bar', data: { labels: ['ﬁåﬁßﬁáﬁ©ﬁãﬁ™', 'ﬁÇﬁ™ﬁÜﬁ™ﬁÉﬁ≠', 'ﬁÇﬁ≠ﬁÇﬁéﬁ≠'], datasets: [{ data: [0,0,0], backgroundColor: [document.getElementById('supColor').value, '#d32f2f', '#444'] }] }, options: { maintainAspectRatio: false, color: '#fff' } });
        vChart = new Chart(document.getElementById('chartVote'), { type: 'bar', data: { labels: ['ﬁàﬁØﬁìﬁ™ﬁçﬁ©', 'ﬁÇﬁ™ﬁçﬁß'], datasets: [{ data: [0,0], backgroundColor: [document.getElementById('voteColor').value, '#111'] }] }, options: { maintainAspectRatio: false, color: '#fff' } });
        updateCharts();
    }

    function updateCharts() {
        const y = voters.filter(v => v.sup === 'yes').length;
        const n = voters.filter(v => v.sup === 'no').length;
        const m = voters.filter(v => v.sup === 'none').length;
        const v = voters.filter(v => v.voted).length;
        sChart.data.datasets[0].data = [y, n, m]; sChart.data.datasets[0].backgroundColor[0] = document.getElementById('supColor').value; sChart.update();
        vChart.data.datasets[0].data = [v, voters.length - v]; vChart.data.datasets[0].backgroundColor[0] = document.getElementById('voteColor').value; vChart.update();
    }

    window.onload = () => { initCharts(); render(); };
    window.onresize = render;
</script>
</body>
</html>
