<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidential Command Suite - Professional Master Edition</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Typography */
        @font-face { font-family: 'Faruma'; src: local('Faruma'), local('MV Boli'); }
        
        :root {
            --royal-blue: #000c1a;
            --gold: #c5a059;
            --deep-gold: #a68541;
            --pure-white: #ffffff;
            --bg-dark: #00050a;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(197, 160, 89, 0.3);
        }

        /* Essential Reset & Security */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-user-select: none; user-select: none;
        }

        body {
            background-color: var(--bg-dark);
            font-family: 'Faruma', sans-serif;
            color: var(--pure-white);
            height: 100vh;
            display: flex;
            flex-direction: column;
            border: 2px solid var(--border);
            overflow: hidden;
        }

        /* --- UI COMPONENTS --- */
        
        .main-scroller {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
        }

        .header-section {
            background: linear-gradient(180deg, #001a33 0%, #000c1a 100%);
            border-bottom: 3px solid var(--gold);
            padding: 40px 20px;
            text-align: center;
            position: relative;
        }

        .fs-btn {
            position: absolute; top: 20px; right: 20px;
            background: transparent; border: 1px solid var(--gold);
            color: var(--gold); padding: 8px 15px; cursor: pointer;
            border-radius: 5px; font-size: 0.8rem;
        }

        /* Analytics Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-wrapper {
            background: var(--glass);
            border: 1.5px solid var(--gold);
            border-radius: 20px;
            padding: 25px;
            height: 450px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        }

        /* Candidate Results Configurator */
        .results-manager {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .candidate-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .cand-input-card {
            background: rgba(255,255,255,0.08);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--gold);
        }

        .cand-input-card input {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: #000c1a;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
            font-family: 'Faruma';
        }

        /* Customization Bar */
        .brand-bar {
            background: var(--glass);
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .control-group { display: flex; align-items: center; gap: 10px; }

        /* Action Toolbar */
        .toolbar {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        }

        .search-field {
            flex: 2;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Faruma';
            font-size: 1rem;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Faruma';
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-gold { background: var(--gold); color: white; }
        .btn-green { background: #1b5e20; color: white; }
        .btn-red { background: #b71c1c; color: white; }
        .btn:hover { opacity: 0.8; transform: translateY(-2px); }

        /* Master Data Table */
        .data-table-container {
            background: white;
            border-radius: 15px;
            overflow-x: auto;
            color: #333;
        }

        table { width: 100%; border-collapse: collapse; min-width: 1100px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 20px; font-size: 1rem; }
        td { padding: 18px; border-bottom: 1px solid #eee; text-align: center; }

        .circle-btn {
            width: 45px; height: 45px; border-radius: 50%;
            border: 1px solid #ccc; cursor: pointer; transition: 0.2s;
            font-size: 1.2rem; display: inline-flex; align-items: center; justify-content: center;
        }

        .active-my { background: var(--gold) !important; color: white; border: none; }
        .active-opp { background: #d32f2f !important; color: white; border: none; }
        .active-voted { background: #2e7d32 !important; color: white; border: none; box-shadow: 0 0 10px #2e7d32; }

        /* Mobile Optimization */
        @media (max-width: 1024px) {
            .data-table-container { display: none; }
            .mobile-card {
                background: white; color: black; margin-bottom: 15px;
                padding: 20px; border-radius: 15px; border-right: 10px solid var(--gold);
            }
            .m-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #f9f9f9; padding-bottom: 5px; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 5px; }
    </style>
</head>
<body oncontextmenu="return false;">

<button class="fs-btn" onclick="toggleFS()">‚õ∂ Full Screen</button>

<div class="main-scroller">
    
    <div class="header-section">
        <div style="margin-bottom: 20px;">
            <button class="btn btn-gold" onclick="setLang('dv')">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</button>
            <button class="btn btn-gold" onclick="setLang('en')">English</button>
        </div>
        <h1 id="title-main" style="letter-spacing: 5px; font-size: 2.5rem;">PRESIDENTIAL COMMAND SUITE</h1>
    </div>

    <div class="brand-bar">
        <div class="control-group">
            <label>ﬁâﬁ¶ﬁáﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ﬁÜﬁ™ﬁçﬁ¶:</label>
            <input type="color" id="myColor" value="#c5a059" onchange="refreshCharts()">
        </div>
        <div class="control-group">
            <label>ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™ ﬁÜﬁ™ﬁçﬁ¶:</label>
            <input type="color" id="oppColor" value="#d32f2f" onchange="refreshCharts()">
        </div>
        <div class="control-group">
            <label>Custom Font:</label>
            <input type="file" accept=".ttf" onchange="applyFont(this)">
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="chart-wrapper">
            <h3 id="chart-bar-title" style="text-align:center; color:var(--gold); margin-bottom:15px;">ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁàﬁØﬁìﬁ™ﬁéﬁ¨ ﬁÇﬁ®ﬁêﬁ∞ﬁÑﬁ¶ﬁåﬁ∞ (Live Bar Chart)</h3>
            <canvas id="mainBarChart"></canvas>
        </div>
        <div class="chart-wrapper">
            <h3 id="chart-pie-title" style="text-align:center; color:var(--gold); margin-bottom:15px;">ﬁñﬁ™ﬁâﬁ∞ﬁçﬁ¶ ﬁåﬁßﬁáﬁ©ﬁãﬁ™</h3>
            <canvas id="mainPieChart"></canvas>
        </div>
    </div>

    <div class="results-manager">
        <h3 id="h-cand-mgmt" style="color:var(--gold); border-bottom:1px solid var(--gold); padding-bottom:10px;">ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁÇﬁ¶ﬁÇﬁ∞ﬁåﬁ¶ﬁáﬁ∞</h3>
        <div class="candidate-input-grid" id="candGrid"></div>
    </div>

    <div class="toolbar no-print">
        <select id="stationSelect" style="padding:15px; border-radius:8px; font-family:'Faruma';" onchange="renderUI()">
            <option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option>
        </select>
        <input type="text" id="search" class="search-field" placeholder="ﬁÇﬁ¶ﬁÇﬁ∞ ﬁÇﬁ™ﬁàﬁ¶ﬁåﬁ¶ ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ© ﬁÜﬁßﬁëﬁ™ ﬁÇﬁ¶ﬁÇﬁ∞ﬁÑﬁ¶ﬁÉﬁ™ﬁÇﬁ∞ ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß..." oninput="renderUI()">
        <button class="btn btn-gold" onclick="generateDummy(2000)">2000 Dummy CSV</button>
        <button class="btn btn-gold" onclick="document.getElementById('csvIn').click()">Import CSV</button>
        <button class="btn btn-green" onclick="exportData()">Export Data</button>
        <button class="btn btn-red" onclick="resetApp()">Reset All</button>
        <input type="file" id="csvIn" hidden onchange="handleImport(event)">
    </div>

    <div id="renderArea"></div>

</div>

<script>
    /* --- SECURITY LAYER --- */
    document.onkeydown = e => {
        if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74))) return false;
    };

    /* --- APPLICATION STATE --- */
    let voters = JSON.parse(localStorage.getItem('p_suite_voters')) || [];
    let candidates = JSON.parse(localStorage.getItem('p_suite_cands')) || [
        { name: 'ﬁâﬁ¶ﬁáﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞', votes: 0 },
        { name: 'ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ 2', votes: 0 },
        { name: 'ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ 3', votes: 0 },
        { name: 'ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ 4', votes: 0 }
    ];
    let lang = 'dv';
    let charts = {};

    const dictionary = {
        dv: { main: "ﬁïﬁ∞ﬁÉﬁ¨ﬁíﬁ®ﬁëﬁ¨ﬁÇﬁ∞ﬁùﬁ¶ﬁçﬁ∞ ﬁÜﬁÆﬁâﬁßﬁÇﬁ∞ﬁëﬁ∞ ﬁêﬁ™ﬁáﬁ©ﬁìﬁ∞", cand: "ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁÇﬁ¶ﬁÇﬁ∞ﬁåﬁ¶ﬁáﬁ∞", name: "ﬁÇﬁ¶ﬁÇﬁ∞", id: "ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©", st: "ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", sup: "ﬁåﬁßﬁáﬁ©ﬁãﬁ™", v: "ﬁàﬁØﬁìﬁ™" },
        en: { main: "PRESIDENTIAL COMMAND SUITE", cand: "CANDIDATE NAMES", name: "NAME", id: "ID CARD", st: "STATION", sup: "SUPPORT", v: "VOTE" }
    };

    /* --- INITIALIZATION --- */
    function init() {
        initCharts();
        createCandInputs();
        updateStations();
        renderUI();
    }

    function initCharts() {
        // Bar Chart Initialization
        const bCtx = document.getElementById('mainBarChart').getContext('2d');
        charts.bar = new Chart(bCtx, {
            type: 'bar',
            data: { labels: [], datasets: [{ label: 'Votes', data: [], borderRadius: 10 }] },
            options: { 
                maintainAspectRatio: false,
                scales: { 
                    y: { beginAtZero: true, ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: '#fff', font: { family: 'Faruma', size: 14 } } }
                },
                plugins: { legend: { display: false } }
            }
        });

        // Pie Chart Initialization
        const pCtx = document.getElementById('mainPieChart').getContext('2d');
        charts.pie = new Chart(pCtx, {
            type: 'doughnut',
            data: { labels: ['ﬁåﬁßﬁáﬁ©ﬁãﬁ™', 'ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™', 'ﬁÇﬁ≠ﬁÇﬁéﬁ≠'], datasets: [{ data: [0,0,0], borderWidth: 0 }] },
            options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#fff', font: { family: 'Faruma', size: 14 } } } } }
        });
    }

    function createCandInputs() {
        const grid = document.getElementById('candGrid');
        grid.innerHTML = candidates.map((c, i) => `
            <div class="cand-input-card">
                <label>Candidate ${i+1}</label>
                <input type="text" value="${c.name}" oninput="updateCandName(${i}, this.value)">
            </div>
        `).join('');
    }

    /* --- CORE LOGIC --- */

    function renderUI() {
        const q = document.getElementById('search').value.toLowerCase();
        const st = document.getElementById('stationSelect').value;
        const d = dictionary[lang];

        const filtered = voters.filter(v => 
            (st === 'all' || v.st === st) && 
            (v.name.toLowerCase().includes(q) || v.id.includes(q))
        );

        refreshCharts();

        const area = document.getElementById('renderArea');
        if (window.innerWidth < 1024) {
            area.innerHTML = filtered.map(v => `
                <div class="mobile-card">
                    <div class="m-row"><b>${d.name}:</b> ${v.name}</div>
                    <div class="m-row"><b>${d.id}:</b> ${v.id}</div>
                    <div class="m-row"><b>${d.st}:</b> ${v.st}</div>
                    <div style="display:flex; gap:10px; margin-top:15px;">
                        <button class="circle-btn ${v.sup==='yes'?'active-my':''}" onclick="setStatus(${voters.indexOf(v)}, 'sup', 'yes')">üëç</button>
                        <button class="circle-btn ${v.sup==='no'?'active-opp':''}" onclick="setStatus(${voters.indexOf(v)}, 'sup', 'no')">üëé</button>
                        <button class="circle-btn ${v.voted?'active-voted':''}" style="margin-right:auto" onclick="setStatus(${voters.indexOf(v)}, 'voted')">üó≥Ô∏è</button>
                    </div>
                </div>
            `).join('');
        } else {
            area.innerHTML = `<div class="data-table-container"><table>
                <thead><tr><th>${d.name}</th><th>${d.id}</th><th>${d.st}</th><th>${d.sup}</th><th>${d.v}</th></tr></thead>
                <tbody>${filtered.map(v => `
                    <tr>
                        <td>${v.name}</td><td>${v.id}</td><td>${v.st}</td>
                        <td>
                            <button class="circle-btn ${v.sup==='yes'?'active-my':''}" onclick="setStatus(${voters.indexOf(v)}, 'sup', 'yes')">üëç</button>
                            <button class="circle-btn ${v.sup==='no'?'active-opp':''}" onclick="setStatus(${voters.indexOf(v)}, 'sup', 'no')">üëé</button>
                        </td>
                        <td><button class="circle-btn ${v.voted?'active-voted':''}" onclick="setStatus(${voters.indexOf(v)}, 'voted')">üó≥Ô∏è</button></td>
                    </tr>
                `).join('')}</tbody></table></div>`;
        }
    }

    function refreshCharts() {
        const myC = document.getElementById('myColor').value;
        const opC = document.getElementById('oppColor').value;

        // Bar Chart Logic (ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁÑﬁßﬁåﬁ¶ﬁáﬁ∞)
        charts.bar.data.labels = candidates.map(c => c.name);
        // ﬁâﬁ® ﬁÑﬁ¶ﬁáﬁ®ﬁéﬁ¶ﬁáﬁ® ﬁàﬁØﬁìﬁ™ﬁçﬁ© ﬁâﬁ©ﬁÄﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁåﬁ¨ﬁÉﬁ¨ﬁáﬁ®ﬁÇﬁ∞ ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁÇﬁ¶ﬁÅﬁ∞ ﬁÄﬁ™ﬁÉﬁ® ﬁåﬁßﬁáﬁ©ﬁãﬁ™ ﬁéﬁ™ﬁÇﬁßﬁÇﬁ¨
        const voteData = candidates.map((c, i) => {
            if (i === 0) return voters.filter(v => v.voted && v.sup === 'yes').length;
            if (i === 1) return voters.filter(v => v.voted && v.sup === 'no').length;
            return 0; // ﬁáﬁ®ﬁåﬁ™ﬁÉﬁ™ ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁÇﬁ¶ﬁÅﬁ∞ ﬁëﬁ≠ﬁìﬁß ﬁáﬁ®ﬁåﬁ™ﬁÉﬁ™ﬁÜﬁ™ﬁÉﬁ¨ﬁàﬁ®ﬁãﬁßﬁÇﬁ¨
        });

        charts.bar.data.datasets[0].data = voteData;
        charts.bar.data.datasets[0].backgroundColor = [myC, opC, '#444', '#666'];
        charts.bar.update();

        // Pie Chart Logic
        charts.pie.data.datasets[0].data = [
            voters.filter(v => v.sup === 'yes').length,
            voters.filter(v => v.sup === 'no').length,
            voters.filter(v => v.sup === 'none').length
        ];
        charts.pie.data.datasets[0].backgroundColor = [myC, opC, '#333'];
        charts.pie.update();
    }

    function setStatus(idx, field, val) {
        if (field === 'sup') voters[idx].sup = (voters[idx].sup === val) ? 'none' : val;
        else voters[idx].voted = !voters[idx].voted;
        save();
    }

    function updateCandName(idx, val) {
        candidates[idx].name = val;
        save();
    }

    function save() {
        localStorage.setItem('p_suite_voters', JSON.stringify(voters));
        localStorage.setItem('p_suite_cands', JSON.stringify(candidates));
        renderUI();
    }

    /* --- DATA TOOLS --- */

    function generateDummy(num) {
        voters = [];
        for (let i = 1; i <= num; i++) {
            voters.push({
                name: "Voter " + i,
                id: "A" + (200000 + i),
                st: "Station " + (i % 5 + 1),
                sup: 'none',
                voted: false
            });
        }
        save();
        updateStations();
    }

    function handleImport(e) {
        const reader = new FileReader();
        reader.onload = ev => {
            const rows = ev.target.result.split('\n').slice(1);
            voters = rows.map(r => {
                const d = r.split(',');
                if (d.length > 2) return { name: d[1].trim(), id: d[2].trim(), st: d[5].trim(), sup: 'none', voted: false };
                return null;
            }).filter(x => x);
            save(); updateStations();
        };
        reader.readAsText(e.target.files[0]);
    }

    function exportData() {
        let csv = "Name,ID Card,Station,Support,Voted\n";
        voters.forEach(v => csv += `${v.name},${v.id},${v.st},${v.sup},${v.voted?'YES':'NO'}\n`);
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
        a.download = "Election_Final_Data.csv";
        a.click();
    }

    function updateStations() {
        const sts = [...new Set(voters.map(v => v.st))];
        const el = document.getElementById('stationSelect');
        el.innerHTML = '<option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option>' + sts.map(s => `<option value="${s}">${s}</option>`).join('');
    }

    function setLang(l) {
        lang = l; document.body.dir = (l==='dv'?'rtl':'ltr');
        document.getElementById('title-main').innerText = dictionary[l].main;
        document.getElementById('h-cand-mgmt').innerText = dictionary[l].cand;
        renderUI();
    }

    function applyFont(input) {
        if (input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                const f = new FontFace('CustomF', e.target.result);
                f.load().then(loaded => {
                    document.fonts.add(loaded);
                    document.body.style.fontFamily = 'CustomF, Faruma';
                });
            };
            reader.readAsArrayBuffer(input.files[0]);
        }
    }

    function toggleFS() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else document.exitFullscreen();
    }

    function resetApp() {
        if (confirm("üö® ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁëﬁ≠ﬁìﬁßﬁáﬁ¨ﬁáﬁ∞ ﬁäﬁÆﬁÄﬁ¨ﬁçﬁ¶ﬁÇﬁ∞ﬁàﬁ©ﬁåﬁØÿü")) {
            localStorage.clear();
            location.reload();
        }
    }

    window.onload = init;
</script>
</body>
</html>
