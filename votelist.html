<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidential Suite v10 - Ultimate Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face { font-family: 'Faruma'; src: local('Faruma'), local('MV Boli'); }
        :root { 
            --royal-blue: #000c1a; 
            --gold: #c5a059; 
            --pure-white: #ffffff; 
            --my-vote-color: #2e7d32; 
        }
        
        body { font-family: 'Faruma', sans-serif; background-color: var(--royal-blue); color: var(--pure-white); margin: 0; padding: 0; }
        .header-panel { background: linear-gradient(to bottom, #001a33, #000c1a); border-bottom: 3px solid var(--gold); padding: 30px; text-align: center; }
        
        /* Stats & Charts */
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; padding: 20px; }
        .chart-box { background: rgba(255,255,255,0.05); border: 1px solid var(--gold); border-radius: 15px; padding: 20px; height: 400px; }

        /* Multi-Candidate Entry */
        .candidate-grid { background: rgba(255,255,255,0.03); margin: 20px; padding: 25px; border-radius: 15px; border: 1px solid var(--gold); }
        .candidate-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-top: 15px; }
        .cand-row { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; border: 1px solid #444; }
        .cand-row input { width: 90%; padding: 8px; margin-top: 5px; border-radius: 4px; border: 1px solid var(--gold); background: #001a33; color: white; }

        /* Actions */
        .action-bar { padding: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; background: white; margin: 20px; border-radius: 10px; color: black; }
        .btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Faruma'; font-weight: bold; }
        .btn-gold { background: var(--gold); color: white; }
        
        /* Table */
        .table-container { margin: 20px; background: white; border-radius: 10px; overflow-x: auto; color: black; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 15px; }
        td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }

        .btn-status { width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc; cursor: pointer; font-size: 1.2rem; }
        .active-yes { background-color: var(--gold) !important; color: white; }
        .active-no { background-color: #d32f2f !important; color: white; }
        .active-vote { background-color: var(--my-vote-color) !important; color: white; }

        @media (max-width: 992px) { table { display: none; } .mobile-card { background: white; color: black; margin: 10px; padding: 15px; border-radius: 10px; border-right: 5px solid var(--gold); } }
    </style>
</head>
<body>

<div class="header-panel">
    <h1 style="color: var(--gold); margin: 0;">PRESIDENTIAL COMMAND SUITE v10</h1>
    <div style="margin-top:15px;">
        <label>ﬁàﬁØﬁìﬁ™ ﬁóﬁßﬁìﬁ™ ﬁÜﬁ™ﬁçﬁ¶: </label>
        <input type="color" id="colorPicker" value="#2e7d32" onchange="updateColors()">
        <button class="btn btn-gold" onclick="download2000Dummy()">2000 ﬁëﬁ¶ﬁâﬁ© ﬁÉﬁ¨ﬁÜﬁØﬁëﬁ∞</button>
    </div>
</div>

<div class="analytics-grid">
    <div class="chart-box"><canvas id="supportChart"></canvas></div>
    <div class="chart-box"><canvas id="candidateChart"></canvas></div>
</div>

<div class="candidate-grid">
    <h3 style="margin:0; color:var(--gold);">ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ™ﬁÇﬁ∞ﬁéﬁ¨ ﬁÇﬁ¶ﬁåﬁ©ﬁñﬁß (Manual Result Entry)</h3>
    <div class="candidate-inputs" id="candidateList">
        </div>
</div>

<div class="action-bar no-print">
    <select id="st_filter" style="padding:10px;" onchange="updateUI()"><option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option></select>
    <input type="text" id="srch" placeholder="ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß (ﬁÇﬁ¶ﬁÇﬁ∞/ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©)..." style="padding:10px; flex:1;" oninput="updateUI()">
    <button class="btn btn-gold" onclick="document.getElementById('fIn').click()">Import CSV</button>
    <button class="btn btn-gold" onclick="exportCSV()">Export Report</button>
    <button class="btn btn-gold" style="background:#d32f2f;" onclick="clearAll()">Clear Memory</button>
    <input type="file" id="fIn" hidden onchange="importCSV(event)">
</div>

<div id="voterArea"></div>

<script>
    let voters = JSON.parse(localStorage.getItem('v10_db')) || [];
    let candResults = JSON.parse(localStorage.getItem('v10_cands')) || Array(11).fill({name: '', votes: 0});
    let charts = {};

    // Initial Candidate List Setup (1 My Cand + 10 Opponents)
    if(!localStorage.getItem('v10_cands')) {
        candResults = [
            {name: 'ﬁâﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞', votes: 0},
            ...Array.from({length: 10}, (_, i) => ({name: `ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ${i+1}`, votes: 0}))
        ];
    }

    function init() {
        renderCandidateInputs();
        
        const ctxS = document.getElementById('supportChart').getContext('2d');
        charts.s = new Chart(ctxS, {
            type: 'doughnut',
            data: { labels: ['ﬁåﬁßﬁáﬁ©ﬁãﬁ™', 'ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™', 'ﬁÇﬁ™ﬁÇﬁ®ﬁÇﬁ∞ﬁâﬁß'], datasets: [{ data: [0,0,0], backgroundColor: ['#c5a059', '#d32f2f', '#444'] }] },
            options: { maintainAspectRatio: false, plugins: { legend: { labels: { color: '#fff' } } } }
        });

        const ctxC = document.getElementById('candidateChart').getContext('2d');
        charts.c = new Chart(ctxC, {
            type: 'bar',
            data: { labels: [], datasets: [{ label: 'ﬁàﬁØﬁìﬁ™ ﬁáﬁ¶ﬁãﬁ¶ﬁãﬁ™', data: [], backgroundColor: document.getElementById('colorPicker').value }] },
            options: { 
                maintainAspectRatio: false, 
                scales: { y: { ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } },
                plugins: { legend: { display: false } }
            }
        });

        populateStations();
        updateUI();
    }

    function renderCandidateInputs() {
        const container = document.getElementById('candidateList');
        container.innerHTML = candResults.map((c, i) => `
            <div class="cand-row" style="${i===0?'border-color:var(--gold); background:rgba(197,160,89,0.1);':''}">
                <label style="font-size:0.8rem; color:${i===0?'var(--gold)':'#aaa'}">${i===0?'ﬁâﬁ¶ﬁáﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞':'ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™ ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ' + i}</label>
                <input type="text" value="${c.name}" placeholder="ﬁÇﬁ¶ﬁÇﬁ∞" oninput="updateCand(${i}, 'name', this.value)">
                <input type="number" value="${c.votes}" placeholder="ﬁàﬁØﬁìﬁ™ ﬁáﬁ¶ﬁãﬁ¶ﬁãﬁ™" oninput="updateCand(${i}, 'votes', this.value)">
            </div>
        `).join('');
    }

    function updateCand(idx, field, val) {
        if(field === 'votes') candResults[idx].votes = parseInt(val) || 0;
        else candResults[idx].name = val;
        localStorage.setItem('v10_cands', JSON.stringify(candResults));
        updateUI();
    }

    function updateColors() {
        const newCol = document.getElementById('colorPicker').value;
        document.documentElement.style.setProperty('--my-vote-color', newCol);
        charts.c.data.datasets[0].backgroundColor = newCol;
        charts.c.update();
        updateUI();
    }

    function download2000Dummy() {
        let csv = "No,Name,ID,Address,CurrentAddress,Station,Phone1,Phone2\n";
        for(let i=1; i<=2000; i++) {
            csv += `${i},Voter Name ${i},A${100000+i},House ${i},Mal√©,Station ${Math.ceil(i/200)},777${i},999${i}\n`;
        }
        const blob = new Blob([csv], {type: 'text/csv'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "Royal_2000_Voters.csv";
        a.click();
    }

    function importCSV(e) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const lines = ev.target.result.split('\n').slice(1);
            voters = lines.map(l => {
                const d = l.split(',');
                if(d.length < 6) return null;
                return { name: d[1], id: d[2], st: d[5], ph: d[6], sup: 'none', voted: false };
            }).filter(x => x);
            saveData();
            populateStations();
        };
        reader.readAsText(e.target.files[0]);
    }

    function updateUI() {
        const filter = document.getElementById('st_filter').value;
        const search = document.getElementById('srch').value.toLowerCase();
        const filtered = voters.filter(v => (filter==='all' || v.st===filter) && (v.name.toLowerCase().includes(search) || v.id.toLowerCase().includes(search)));

        // Update Charts
        charts.s.data.datasets[0].data = [voters.filter(v=>v.sup==='yes').length, voters.filter(v=>v.sup==='no').length, voters.filter(v=>v.sup==='none').length];
        charts.s.update();

        charts.c.data.labels = candResults.map(c => c.name || '---');
        charts.c.data.datasets[0].data = candResults.map(c => c.votes);
        charts.c.update();

        // Render List
        const area = document.getElementById('voterArea');
        if(window.innerWidth < 992) {
            area.innerHTML = filtered.map((v, i) => `
                <div class="mobile-card">
                    <b>${v.name}</b><br><small>${v.id} | ${v.st} | ${v.ph}</small>
                    <div style="margin-top:10px; display:flex; gap:10px;">
                        <button class="btn-status ${v.sup==='yes'?'active-yes':''}" onclick="tSup(${voters.indexOf(v)},'yes')">üëç</button>
                        <button class="btn-status ${v.sup==='no'?'active-no':''}" onclick="tSup(${voters.indexOf(v)},'no')">üëé</button>
                        <button class="btn-status ${v.voted?'active-vote':''}" onclick="tVote(${voters.indexOf(v)})">üó≥Ô∏è</button>
                    </div>
                </div>`).join('');
        } else {
            area.innerHTML = `<div class="table-container"><table>
                <thead><tr><th>ﬁÇﬁ¶ﬁÇﬁ∞</th><th>ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©</th><th>ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™</th><th>ﬁäﬁØﬁÇﬁ™</th><th>ﬁåﬁßﬁáﬁ©ﬁãﬁ™</th><th>ﬁàﬁØﬁìﬁ™ﬁçﬁ©</th></tr></thead>
                <tbody>${filtered.map(v => `
                    <tr>
                        <td>${v.name}</td><td>${v.id}</td><td>${v.st}</td><td>${v.ph}</td>
                        <td>
                            <button class="btn-status ${v.sup==='yes'?'active-yes':''}" onclick="tSup(${voters.indexOf(v)},'yes')">üëç</button>
                            <button class="btn-status ${v.sup==='no'?'active-no':''}" onclick="tSup(${voters.indexOf(v)},'no')">üëé</button>
                        </td>
                        <td><button class="btn-status ${v.voted?'active-vote':''}" onclick="tVote(${voters.indexOf(v)})">üó≥Ô∏è</button></td>
                    </tr>`).join('')}
                </tbody></table></div>`;
        }
    }

    function tSup(i, v) { voters[i].sup = voters[i].sup===v ? 'none' : v; saveData(); }
    function tVote(i) { voters[i].voted = !voters[i].voted; saveData(); }
    function saveData() { localStorage.setItem('v10_db', JSON.stringify(voters)); updateUI(); }
    function clearAll() { if(confirm("Clear memory?")) { localStorage.clear(); location.reload(); } }
    function populateStations() {
        const sts = [...new Set(voters.map(v => v.st))];
        document.getElementById('st_filter').innerHTML = '<option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option>' + sts.map(s => `<option value="${s}">${s}</option>`).join('');
    }
    function exportCSV() {
        let csv = "Name,ID,Station,Phone,Support,Voted\n";
        voters.forEach(v => csv += `${v.name},${v.id},${v.st},${v.ph},${v.sup},${v.voted?'YES':'NO'}\n`);
        const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([csv], {type:'text/csv'})); a.download="Report.csv"; a.click();
    }

    window.onload = init;
</script>
</body>
</html>
