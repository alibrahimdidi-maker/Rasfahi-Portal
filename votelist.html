<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presidential Suite v9 - Master Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face { font-family: 'Faruma'; src: local('Faruma'), local('MV Boli'); }
        :root { --royal-blue: #000c1a; --gold: #c5a059; --pure-white: #ffffff; --support-color: #c5a059; --vote-color: #2e7d32; --opp-color: #d32f2f; }
        
        body { font-family: 'Faruma', sans-serif; background-color: var(--royal-blue); color: var(--pure-white); margin: 0; padding: 0; }
        .header-panel { background: linear-gradient(to bottom, #001a33, #000c1a); border-bottom: 3px solid var(--gold); padding: 30px; text-align: center; }
        
        .office-info { display: flex; justify-content: center; gap: 15px; margin-top: 15px; flex-wrap: wrap; }
        .office-info input { background: rgba(255,255,255,0.1); border: 1px solid var(--gold); color: var(--gold); padding: 10px; border-radius: 5px; text-align: center; }

        /* Stats & Charts */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 20px; }
        .stat-card { background: rgba(197, 160, 89, 0.1); border-right: 5px solid var(--gold); padding: 15px; border-radius: 5px; }
        .dashboard { display: flex; flex-wrap: wrap; gap: 20px; padding: 0 20px; }
        .chart-box { flex: 1; min-width: 300px; height: 300px; background: rgba(255,255,255,0.05); border: 1px solid var(--gold); border-radius: 15px; padding: 15px; }

        /* Comparison Section */
        .comparison-zone { background: rgba(255,255,255,0.03); margin: 20px; padding: 20px; border-radius: 15px; border: 1px solid var(--gold); }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 10px; }

        /* Actions */
        .action-bar { padding: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; background: white; margin: 20px; border-radius: 10px; color: black; }
        .btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Faruma'; font-weight: bold; }
        .btn-gold { background: var(--gold); color: white; }
        .btn-red { background: #d32f2f; color: white; }

        /* Table */
        .table-container { margin: 20px; background: white; border-radius: 10px; overflow-x: auto; color: black; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 15px; }
        td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }

        .btn-status { width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc; cursor: pointer; }
        .active-yes { background-color: var(--support-color) !important; }
        .active-no { background-color: var(--opp-color) !important; }
        .active-vote { background-color: var(--vote-color) !important; }

        @media (max-width: 992px) {
            table { display: none; }
            .mobile-card { background: white; color: black; margin: 10px; padding: 15px; border-radius: 10px; border-right: 5px solid var(--gold); }
        }
    </style>
</head>
<body>

<div class="header-panel">
    <h1 style="color: var(--gold); margin: 0;">PRESIDENTIAL COMMAND SUITE v9</h1>
    <div class="office-info">
        <input type="text" id="off_n" placeholder="ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ﬁáﬁÆﬁäﬁ©ﬁêﬁ∞" oninput="localStorage.setItem('m1', this.value)">
        <input type="text" id="st_n" placeholder="ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™" oninput="localStorage.setItem('m2', this.value)">
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card"><h4>ﬁñﬁ™ﬁâﬁ∞ﬁçﬁ¶ ﬁàﬁØﬁìﬁ¶ﬁÉﬁ™ﬁÇﬁ∞</h4><p id="t_voters">0</p></div>
    <div class="stat-card"><h4>ﬁàﬁØﬁìﬁ™ﬁçﬁ© ﬁÇﬁ®ﬁêﬁ∞ﬁÑﬁ¶ﬁåﬁ∞</h4><p id="p_voted">0%</p></div>
    <div class="stat-card"><h4>ﬁçﬁ¶ﬁäﬁßﬁÜﬁ™ﬁÉﬁß ﬁçﬁ©ﬁëﬁ∞</h4><p id="p_lead">0</p></div>
    <div class="stat-card"><h4>ﬁäﬁ¶ﬁáﬁ®ﬁÇﬁ¶ﬁçﬁ∞ ﬁêﬁ∞ﬁìﬁ≠ﬁìﬁ¶ﬁêﬁ∞</h4><p id="f_status">ﬁÑﬁ¶ﬁçﬁ¶ﬁÇﬁ©...</p></div>
</div>



<div class="dashboard">
    <div class="chart-box"><canvas id="c1"></canvas></div>
    <div class="chart-box"><canvas id="c2"></canvas></div>
</div>

<div class="comparison-zone">
    <h3 style="margin:0; color:var(--gold);">ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ© ﬁÇﬁ¶ﬁåﬁ©ﬁñﬁß (Manual Input)</h3>
    <div class="input-row">
        <select id="res_st" class="btn" style="background:#001a33; color:white;" onchange="loadRes()"></select>
        <input type="number" id="my_v" placeholder="ﬁâﬁ® ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞" oninput="saveRes()">
        <input type="number" id="op_v" placeholder="ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™" oninput="saveRes()">
    </div>
</div>

<div class="action-bar no-print">
    <select id="st_filter" style="padding:10px;" onchange="updateUI()">
        <option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option>
    </select>
    <input type="text" id="srch" placeholder="ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß..." style="padding:10px;" oninput="updateUI()">
    <button class="btn btn-gold" onclick="downloadDummyCSV()">ﬁëﬁ¶ﬁâﬁ© CSV</button>
    <button class="btn btn-gold" onclick="document.getElementById('fIn').click()">Import</button>
    <button class="btn btn-gold" onclick="exportCSV()">Save Report</button>
    <button class="btn btn-red" onclick="clearMem()">Clear</button>
    <input type="file" id="fIn" hidden onchange="importCSV(event)">
</div>

<div id="out"></div>

<script>
    let voters = JSON.parse(localStorage.getItem('v9_data')) || [];
    let results = JSON.parse(localStorage.getItem('v9_res')) || {};
    let charts = {};

    function init() {
        charts.s = new Chart(document.getElementById('c1'), { type: 'pie', data: { labels: ['ﬁåﬁßﬁáﬁ©ﬁãﬁ™', 'ﬁáﬁ®ﬁãﬁ®ﬁÜﬁÆﬁÖﬁ™', 'ﬁÇﬁ≠ﬁÇﬁéﬁ≠'], datasets: [{ data: [0,0,0], backgroundColor: ['#c5a059', '#d32f2f', '#444'] }] }, options: { maintainAspectRatio: false } });
        charts.v = new Chart(document.getElementById('c2'), { type: 'bar', data: { labels: [], datasets: [{ label: 'ﬁàﬁØﬁìﬁ™ﬁçﬁ©', data: [], backgroundColor: '#2e7d32' }] }, options: { maintainAspectRatio: false } });
        populate();
        updateUI();
    }

    function downloadDummyCSV() {
        let c = "No,Name,ID,Address,Current,Station,Phone1,Phone2\n";
        for(let i=1; i<=10; i++) c += `${i},Voter ${i},A${100+i},House,Current,Station ${Math.ceil(i/5)},777${i},999${i}\n`;
        const b = new Blob([c], {type:'text/csv'});
        const a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download="Dummy.csv"; a.click();
    }

    function importCSV(e) {
        const r = new FileReader();
        r.onload = (ev) => {
            const lines = ev.target.result.split('\n').slice(1);
            voters = lines.map(l => {
                const d = l.split(',');
                return d.length > 5 ? { name: d[1], id: d[2], st: d[5], ph: d[6], sup: 'none', voted: false } : null;
            }).filter(x => x);
            save();
            populate();
        };
        r.readAsText(e.target.files[0]);
    }

    function populate() {
        const sts = [...new Set(voters.map(v => v.st))];
        const f = document.getElementById('st_filter');
        const r = document.getElementById('res_st');
        f.innerHTML = '<option value="all">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ¨ﬁáﬁ∞</option>' + sts.map(s => `<option value="${s}">${s}</option>`).join('');
        r.innerHTML = sts.map(s => `<option value="${s}">${s}</option>`).join('');
    }

    function loadRes() {
        const s = document.getElementById('res_st').value;
        document.getElementById('my_v').value = results[s]?.m || 0;
        document.getElementById('op_v').value = results[s]?.o || 0;
    }

    function saveRes() {
        const s = document.getElementById('res_st').value;
        if(!s) return;
        results[s] = { m: parseInt(document.getElementById('my_v').value)||0, o: parseInt(document.getElementById('op_v').value)||0 };
        save();
    }

    function save() {
        localStorage.setItem('v9_data', JSON.stringify(voters));
        localStorage.setItem('v9_res', JSON.stringify(results));
        updateUI();
    }

    function updateUI() {
        const f_st = document.getElementById('st_filter').value;
        const q = document.getElementById('srch').value.toLowerCase();
        const filtered = voters.filter(v => (f_st==='all' || v.st===f_st) && (v.name.toLowerCase().includes(q) || v.id.toLowerCase().includes(q)));
        
        // Dashboard Stats
        let myT = 0, opT = 0;
        Object.values(results).forEach(r => { myT += r.m; opT += r.o; });
        document.getElementById('t_voters').innerText = voters.length;
        document.getElementById('p_voted').innerText = voters.length ? Math.round((voters.filter(v=>v.voted).length/voters.length)*100)+'%' : '0%';
        document.getElementById('p_lead').innerText = myT - opT;
        document.getElementById('f_status').innerText = myT > opT ? "ﬁÜﬁ™ﬁÉﬁ©ﬁéﬁ¶ﬁáﬁ®" : "ﬁäﬁ¶ﬁÄﬁ¶ﬁåﬁ™ﬁéﬁ¶ﬁáﬁ®";

        // Charts
        charts.s.data.datasets[0].data = [voters.filter(v=>v.sup==='yes').length, voters.filter(v=>v.sup==='no').length, voters.filter(v=>v.sup==='none').length];
        charts.s.update();

        const st_counts = {};
        voters.forEach(v => { if(v.voted) st_counts[v.st] = (st_counts[v.st]||0)+1; });
        charts.v.data.labels = Object.keys(st_counts);
        charts.v.data.datasets[0].data = Object.values(st_counts);
        charts.v.update();

        // Table
        const out = document.getElementById('out');
        if(window.innerWidth < 992) {
            out.innerHTML = filtered.map((v, i) => `<div class="mobile-card">
                <b>${v.name}</b><br><small>${v.st} | ${v.ph}</small>
                <div style="margin-top:10px;">
                    <button class="btn-status ${v.sup==='yes'?'active-yes':''}" onclick="tSup(${voters.indexOf(v)},'yes')">üëç</button>
                    <button class="btn-status ${v.sup==='no'?'active-no':''}" onclick="tSup(${voters.indexOf(v)},'no')">üëé</button>
                    <button class="btn-status ${v.voted?'active-vote':''}" onclick="tV(${voters.indexOf(v)})">üó≥Ô∏è</button>
                </div>
            </div>`).join('');
        } else {
            out.innerHTML = `<div class="table-container"><table><thead><tr><th>ﬁÇﬁ¶ﬁÇﬁ∞</th><th>ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©</th><th>ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™</th><th>ﬁäﬁØﬁÇﬁ™</th><th>ﬁåﬁßﬁáﬁ©ﬁãﬁ™</th><th>ﬁàﬁØﬁìﬁ™</th></tr></thead><tbody>
                ${filtered.map(v => `<tr><td>${v.name}</td><td>${v.id}</td><td>${v.st}</td><td>${v.ph}</td>
                <td><button class="btn-status ${v.sup==='yes'?'active-yes':''}" onclick="tSup(${voters.indexOf(v)},'yes')">üëç</button> <button class="btn-status ${v.sup==='no'?'active-no':''}" onclick="tSup(${voters.indexOf(v)},'no')">üëé</button></td>
                <td><button class="btn-status ${v.voted?'active-vote':''}" onclick="tV(${voters.indexOf(v)})">üó≥Ô∏è</button></td></tr>`).join('')}
            </tbody></table></div>`;
        }
    }

    function tSup(i, v) { voters[i].sup = voters[i].sup===v ? 'none' : v; save(); }
    function tV(i) { voters[i].voted = !voters[i].voted; save(); }
    function clearMem() { if(confirm("ﬁäﬁÆﬁÄﬁ¨ﬁçﬁ¶ﬁÇﬁ∞ﬁàﬁ©ﬁåﬁØÿü")) { localStorage.clear(); location.reload(); } }

    window.onload = () => {
        document.getElementById('off_n').value = localStorage.getItem('m1') || '';
        document.getElementById('st_n').value = localStorage.getItem('m2') || '';
        init();
    };
    function exportCSV() {
        let csv = "Name,ID,Station,Phone,Support,Voted\n";
        voters.forEach(v => { csv += `${v.name},${v.id},${v.st},${v.ph},${v.sup},${v.voted?'YES':'NO'}\n`; });
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = "Election_Report.csv"; a.click();
    }
</script>
</body>
</html>
