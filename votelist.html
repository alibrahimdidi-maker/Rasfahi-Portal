<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supreme Presidential Suite v7</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @font-face { font-family: 'Faruma'; src: local('Faruma'), local('MV Boli'); }
        
        :root {
            --royal-blue: #000c1a;
            --gold: #c5a059;
            --pure-white: #ffffff;
            --support-color: #c5a059;
            --vote-color: #2e7d32;
        }

        body {
            font-family: 'Faruma', sans-serif;
            background: radial-gradient(circle, #001a33 0%, var(--royal-blue) 100%);
            color: var(--pure-white);
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* Presidential Header */
        .header-panel {
            background: linear-gradient(to bottom, #001a33, #000c1a);
            border-bottom: 3px solid var(--gold);
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .main-title {
            color: var(--gold);
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(197, 160, 89, 0.5);
            margin: 0;
        }

        .office-info {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .office-info input {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            width: 250px;
        }

        /* Color & Font Customizer */
        .customizer {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            margin: 10px 20px;
            border-radius: 10px;
            border: 1px solid var(--gold);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            align-items: center;
        }

        /* Dashboard & Charts */
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; padding: 20px; }
        .chart-box { height: 350px; background: rgba(0,0,0,0.3); border: 1px solid var(--gold); border-radius: 15px; padding: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }

        /* Action Bar */
        .action-bar { padding: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; background: rgba(255,255,255,0.9); margin: 0 20px; border-radius: 10px; }
        
        .btn { padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-family: 'Faruma'; font-weight: bold; transition: 0.3s; }
        .btn-gold { background: var(--gold); color: #000; border: 1px solid #8e6d28; }
        .btn-gold:hover { transform: scale(1.05); background: #d4b373; }

        /* Table & Mobile Card Layout */
        .table-container { margin: 20px; background: white; border-radius: 10px; overflow-x: auto; color: black; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        table { width: 100%; border-collapse: collapse; min-width: 900px; }
        th { background: var(--royal-blue); color: var(--gold); padding: 15px; position: sticky; top: 0; }
        td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }

        .btn-status { width: 45px; height: 45px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; font-size: 1.2rem; transition: 0.2s; }
        .active-yes { background-color: var(--support-color) !important; color: white; border-color: var(--gold); box-shadow: 0 0 10px var(--gold); }
        .active-no { background-color: #d32f2f !important; color: white; }
        .active-vote { background-color: var(--vote-color) !important; color: white; box-shadow: 0 0 10px var(--vote-color); }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            table { display: none; }
            .mobile-card {
                background: white; color: black; margin: 10px; padding: 20px;
                border-radius: 12px; border-right: 8px solid var(--gold);
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            .card-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
            .card-actions .btn-status { width: 100%; height: 50px; }
            .btn-vote-mobile { grid-column: span 3; }
        }

        @media print {
            .no-print, .customizer, .action-bar, .header-panel button { display: none !important; }
            body { background: white; color: black; }
            .chart-box { border: 1px solid #000 !important; page-break-inside: avoid; }
        }
    </style>
</head>
<body onbeforeunload="return 'ﬁêﬁ≠ﬁàﬁ∞ ﬁÇﬁ™ﬁÜﬁÆﬁÅﬁ∞ ﬁÉﬁ®ﬁäﬁ∞ﬁÉﬁ¨ﬁùﬁ∞ ﬁÜﬁ™ﬁÉﬁ¶ﬁÇﬁ∞ﬁàﬁ©ﬁåﬁØÿü'">

<div class="header-panel">
    <h1 class="main-title" id="txt-title">PRESIDENTIAL ELECTION SUITE</h1>
    <div class="office-info">
        <input type="text" id="office_name" placeholder="ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁëﬁ≠ﬁìﬁ∞ ﬁáﬁÆﬁäﬁ©ﬁêﬁ∞ ﬁÇﬁ¶ﬁÇﬁ∞" oninput="autoSaveMeta()">
        <input type="text" id="station_name" placeholder="ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™ﬁéﬁ¨ ﬁÇﬁ¶ﬁÇﬁ∞" oninput="autoSaveMeta()">
    </div>
    <div style="margin-top: 15px;">
        <button class="btn btn-gold" onclick="switchLang('dv')">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</button>
        <button class="btn btn-gold" onclick="switchLang('en')">English</button>
    </div>
</div>

<div class="customizer no-print">
    <div style="display:flex; gap:10px; align-items:center;">
        <label>ﬁåﬁßﬁáﬁ©ﬁãﬁ™ ﬁÜﬁ™ﬁçﬁ¶: </label>
        <input type="color" id="supportColorPicker" value="#c5a059" onchange="updateColors()">
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
        <label>ﬁàﬁØﬁìﬁ™ ﬁÜﬁ™ﬁçﬁ¶: </label>
        <input type="color" id="voteColorPicker" value="#2e7d32" onchange="updateColors()">
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
        <label>ﬁäﬁ¶ﬁÉﬁ™ﬁâﬁß ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ (Local): </label>
        <input type="file" id="fontInput" accept=".ttf,.woff" onchange="loadLocalFont(this)">
    </div>
</div>

<div class="dashboard">
    <div class="chart-box"><canvas id="supportChart"></canvas></div>
    <div class="chart-box"><canvas id="voteChart"></canvas></div>
</div>

<div class="action-bar no-print">
    <input type="text" id="searchInput" placeholder="ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß (ﬁÇﬁ¶ﬁÇﬁ∞ ﬁÇﬁ™ﬁàﬁ¶ﬁåﬁ¶ ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©)..." style="padding:10px; border-radius:5px; border:1px solid #ccc; width:200px;" oninput="updateUI()">
    <input type="file" id="csvFile" style="display:none" onchange="importCSV(event)">
    <button class="btn btn-gold" onclick="document.getElementById('csvFile').click()">CSV ﬁáﬁ®ﬁâﬁ∞ﬁïﬁØﬁìﬁ∞</button>
    <button class="btn btn-gold" onclick="downloadDummyCSV()">2000 ﬁëﬁ¶ﬁâﬁ© ﬁÉﬁ¨ﬁÜﬁØﬁëﬁ∞</button>
    <button class="btn btn-gold" onclick="exportCSV()">ﬁêﬁ≠ﬁàﬁ∞ ﬁÉﬁ¨ﬁÜﬁØﬁëﬁ∞ (CSV)</button>
    <button class="btn btn-gold" onclick="window.print()">ﬁïﬁ∞ﬁÉﬁ®ﬁÇﬁ∞ﬁìﬁ∞ / PDF</button>
</div>

<div id="contentArea"></div>

<script>
    let voters = JSON.parse(localStorage.getItem('election_v7_data')) || [];
    let curLang = 'dv';
    let supportChart, voteChart;

    const uiTexts = {
        dv: { title: "ﬁùﬁßﬁÄﬁ© ﬁáﬁ®ﬁÇﬁ∞ﬁåﬁ®ﬁöﬁßﬁÑﬁ© ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", name: "ﬁÇﬁ¶ﬁÇﬁ∞", id: "ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ©", station: "ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", vote: "ﬁàﬁØﬁìﬁ™ﬁçﬁ¶ﬁáﬁ®ﬁäﬁ®", notvoted: "ﬁàﬁØﬁìﬁ™ ﬁÇﬁ™ﬁçﬁß" },
        en: { title: "PRESIDENTIAL COMMAND CENTER", name: "Name", id: "ID", station: "Station", vote: "Voted", notvoted: "Not Voted" }
    };

    function switchLang(l) {
        curLang = l;
        document.body.dir = (l === 'dv') ? 'rtl' : 'ltr';
        document.getElementById('txt-title').innerText = uiTexts[l].title;
        updateUI();
    }

    function updateColors() {
        const sCol = document.getElementById('supportColorPicker').value;
        const vCol = document.getElementById('voteColorPicker').value;
        document.documentElement.style.setProperty('--support-color', sCol);
        document.documentElement.style.setProperty('--vote-color', vCol);
        
        supportChart.data.datasets[0].backgroundColor[0] = sCol;
        voteChart.data.datasets[0].backgroundColor[0] = vCol;
        
        supportChart.update();
        voteChart.update();
        updateUI();
    }

    function loadLocalFont(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const font = new FontFace('Faruma', e.target.result);
            font.load().then(loaded => {
                document.fonts.add(loaded);
                document.body.style.fontFamily = 'Faruma';
            });
        };
        reader.readAsArrayBuffer(file);
    }

    function initCharts() {
        const ctxS = document.getElementById('supportChart').getContext('2d');
        const ctxV = document.getElementById('voteChart').getContext('2d');

        supportChart = new Chart(ctxS, {
            type: 'bar',
            data: { labels: ['ﬁåﬁßﬁáﬁ©ﬁãﬁ™ﬁÜﬁ™ﬁÉﬁ≠', 'ﬁÇﬁ™ﬁÜﬁ™ﬁÉﬁ≠', 'ﬁÇﬁ™ﬁÇﬁ®ﬁÇﬁ∞ﬁâﬁß'], datasets: [{ label: 'ﬁåﬁßﬁáﬁ©ﬁãﬁ™', data: [0,0,0], backgroundColor: [document.getElementById('supportColorPicker').value, '#d32f2f', '#444'] }] },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } } }
        });

        voteChart = new Chart(ctxV, {
            type: 'bar',
            data: { labels: ['ﬁàﬁØﬁìﬁ™ﬁçﬁ©', 'ﬁÇﬁ™ﬁçﬁß'], datasets: [{ label: 'ﬁàﬁØﬁìﬁ™ﬁçﬁ© ﬁâﬁ©ﬁÄﬁ™ﬁÇﬁ∞', data: [0,0], backgroundColor: [document.getElementById('voteColorPicker').value, '#222'] }] },
            options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { ticks: { color: '#fff' } }, x: { ticks: { color: '#fff' } } } }
        });
        updateUI();
    }

    function downloadDummyCSV() {
        let content = "No,Full Name,ID Card,Permanent Address,Current Address,Station,Phone1,Phone2\n";
        for(let i=1; i<=2000; i++) {
            content += `${i},Voter Name ${i},A${100000+i},House ${i},Current ${i},Polling Station ${Math.ceil(i/100)},777${i},999${i}\n`;
        }
        const blob = new Blob([content], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "Dummy_2000_Voters.csv";
        a.click();
    }

    function exportCSV() {
        let content = "No,Name,ID,Station,Support,Voted,Comment\n";
        voters.forEach((v, i) => {
            content += `${i+1},${v.name},${v.id},${v.station},${v.support},${v.voted?'YES':'NO'},${v.comment}\n`;
        });
        const blob = new Blob([content], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = "Final_Election_Report.csv";
        a.click();
    }

    function importCSV(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = (event) => {
            const rows = event.target.result.split('\n').slice(1);
            voters = rows.map(row => {
                const c = row.split(',');
                if(c.length < 5) return null;
                return { name: c[1], id: c[2], perm: c[3], station: c[5], p1: c[6], support: 'none', voted: false, comment: '' };
            }).filter(x => x);
            saveData();
        };
        reader.readAsText(file);
    }

    function toggleSupport(index, val) {
        voters[index].support = (voters[index].support === val) ? 'none' : val;
        saveData();
    }

    function toggleVote(index) {
        voters[index].voted = !voters[index].voted;
        saveData();
    }

    function saveData() {
        localStorage.setItem('election_v7_data', JSON.stringify(voters));
        updateUI();
    }

    function autoSaveMeta() {
        localStorage.setItem('meta_office', document.getElementById('office_name').value);
        localStorage.setItem('meta_station', document.getElementById('station_name').value);
    }

    function updateUI() {
        const container = document.getElementById('contentArea');
        const search = document.getElementById('searchInput').value.toLowerCase();
        const filtered = voters.filter(v => v.name.toLowerCase().includes(search) || v.id.toLowerCase().includes(search));
        
        const l = uiTexts[curLang];

        if (window.innerWidth < 768) {
            // Mobile Card View
            container.innerHTML = filtered.map((v, i) => `
                <div class="mobile-card">
                    <div style="font-weight:bold; font-size:1.1rem; color:var(--royal-blue);">${v.name}</div>
                    <div style="font-size:0.9rem; margin:5px 0;">${v.id} | ${v.station}</div>
                    <div class="card-actions">
                        <button class="btn-status ${v.support==='yes'?'active-yes':''}" onclick="toggleSupport(${voters.indexOf(v)},'yes')">üëç</button>
                        <button class="btn-status ${v.support==='no'?'active-no':''}" onclick="toggleSupport(${voters.indexOf(v)},'no')">üëé</button>
                        <button class="btn-status ${v.voted?'active-vote':''}" onclick="toggleVote(${voters.indexOf(v)})">üó≥Ô∏è</button>
                        <button class="btn btn-gold btn-vote-mobile ${v.voted?'active-vote':''}" onclick="toggleVote(${voters.indexOf(v)})">
                            ${v.voted ? l.vote : l.notvoted}
                        </button>
                    </div>
                </div>
            `).join('');
        } else {
            // Desktop Table View
            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th><th>${l.name}</th><th>${l.id}</th><th>${l.station}</th>
                                <th>ﬁåﬁßﬁáﬁ©ﬁãﬁ™</th><th>ﬁàﬁØﬁìﬁ™</th><th>ﬁÜﬁÆﬁâﬁ¨ﬁÇﬁ∞ﬁìﬁ∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filtered.map((v, i) => `
                                <tr>
                                    <td>${i+1}</td>
                                    <td>${v.name}</td><td>${v.id}</td><td>${v.station}</td>
                                    <td>
                                        <button class="btn-status ${v.support==='yes'?'active-yes':''}" onclick="toggleSupport(${voters.indexOf(v)},'yes')">üëç</button>
                                        <button class="btn-status ${v.support==='no'?'active-no':''}" onclick="toggleSupport(${voters.indexOf(v)},'no')">üëé</button>
                                    </td>
                                    <td>
                                        <button class="btn-status ${v.voted?'active-vote':''}" onclick="toggleVote(${voters.indexOf(v)})">üó≥Ô∏è</button>
                                    </td>
                                    <td><input type="text" value="${v.comment}" onchange="voters[${voters.indexOf(v)}].comment=this.value;saveData()" style="border:none; border-bottom:1px solid #ccc; width:100px;"></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        const yes = voters.filter(v => v.support === 'yes').length;
        const no = voters.filter(v => v.support === 'no').length;
        const maybe = voters.filter(v => v.support === 'none').length;
        const voted = voters.filter(v => v.voted).length;

        supportChart.data.datasets[0].data = [yes, no, maybe];
        supportChart.update();
        voteChart.data.datasets[0].data = [voted, voters.length - voted];
        voteChart.update();
    }

    window.onload = () => {
        document.getElementById('office_name').value = localStorage.getItem('meta_office') || '';
        document.getElementById('station_name').value = localStorage.getItem('meta_station') || '';
        initCharts();
    };
    window.onresize = updateUI;
</script>
</body>
</html>
