<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Royal Election Suite - Faruma Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Faruma Font Integration */
        @font-face {
            font-family: 'Faruma';
            src: url('https://fonts.gstatic.com/s/faruma/v1/faruma.woff2'); /* Standard fallback or local path */
        }

        :root {
            --royal-blue: #001226;
            --gold-gradient: linear-gradient(145deg, #c5a059, #8e6d28);
            --gold: #c5a059;
            --pure-white: #ffffff;
            --danger-red: #d32f2f;
            --success-green: #2e7d32;
        }

        body {
            font-family: 'Faruma', 'MV Boli', sans-serif;
            background-color: var(--royal-blue);
            color: var(--pure-white);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .imperial-header {
            background: rgba(0, 0, 0, 0.4);
            border-bottom: 2px solid var(--gold);
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .gold-text {
            color: var(--gold);
            text-shadow: 0px 0px 10px rgba(197, 160, 89, 0.5);
            margin: 0;
        }

        .dashboard {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .chart-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--gold);
            border-radius: 15px;
            padding: 15px;
            width: 45%;
            min-width: 300px;
            height: 300px;
        }

        .action-bar {
            background: var(--pure-white);
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Faruma';
            font-weight: bold;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn-gold { background: var(--gold-gradient); color: white; }
        .btn-outline { border: 2px solid var(--gold); background: transparent; color: var(--gold); }
        .btn-danger { background: var(--danger-red); color: white; }

        .table-container {
            margin: 20px;
            background: var(--pure-white);
            border-radius: 15px;
            overflow: auto;
            max-height: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #333;
            font-size: 14px;
        }

        th {
            background: #f8f9fa;
            position: sticky;
            top: 0;
            padding: 15px;
            border-bottom: 2px solid var(--gold);
            color: var(--royal-blue);
        }

        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }

        .btn-vote { padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer; }
        .active-yes { background: var(--success-green); color: white; }
        .active-no { background: var(--danger-red); color: white; }

        input[type="text"] {
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 4px;
            width: 100%;
        }

        @media print {
            .action-bar, .imperial-header button { display: none; }
            body { background: white; color: black; }
        }
    </style>
</head>
<body onbeforeunload="return 'ﬁâﬁ¶ﬁ¢ﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ™ ﬁéﬁ¨ﬁáﬁ∞ﬁçﬁ®ﬁãﬁßﬁÇﬁ¨! ﬁêﬁ≠ﬁàﬁ∞ ﬁÜﬁ™ﬁÉﬁ¨ﬁáﬁ∞ﬁàﬁ®ﬁÇﬁ∞ﬁåﬁØÿü'">

<div class="imperial-header">
    <h1 class="gold-text" id="app-title">ﬁùﬁßﬁÄﬁ© ﬁáﬁ®ﬁÇﬁ∞ﬁåﬁ®ﬁöﬁßﬁÑﬁ© ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™</h1>
    <div style="margin-top: 15px;">
        <button class="btn btn-outline" onclick="switchLang('dv')">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</button>
        <button class="btn btn-outline" onclick="switchLang('en')">English</button>
    </div>
</div>

<div class="dashboard">
    <div class="chart-box"><canvas id="supportChart"></canvas></div>
    <div class="chart-box"><canvas id="voterChart"></canvas></div>
</div>

<div class="action-bar">
    <input type="file" id="csvFileInput" accept=".csv" style="display:none" onchange="handleFileUpload(event)">
    <button class="btn btn-gold" onclick="document.getElementById('csvFileInput').click()" id="btn-import">ﬁêﬁ©.ﬁáﬁ¨ﬁêﬁ∞.ﬁàﬁ© ﬁçﬁ®ﬁêﬁ∞ﬁìﬁ™ ﬁáﬁ¶ﬁÖﬁ™ﬁáﬁ∞ﬁàﬁß</button>
    <button class="btn btn-outline" onclick="downloadDummyCSV()" id="btn-dummy">ﬁëﬁ¶ﬁâﬁ© ﬁäﬁ¶ﬁáﬁ®ﬁçﬁ∞ ﬁëﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁçﬁØﬁëﬁ∞</button>
    <button class="btn btn-gold" onclick="exportCSV()" id="btn-export">ﬁêﬁ©.ﬁáﬁ¨ﬁêﬁ∞.ﬁàﬁ© ﬁÉﬁ®ﬁïﬁØﬁìﬁ∞</button>
    <button class="btn btn-gold" onclick="window.print()" id="btn-print">ﬁïﬁ∞ﬁÉﬁ®ﬁÇﬁ∞ﬁìﬁ∞ / PDF</button>
    <button class="btn btn-danger" onclick="clearData()" id="btn-clear">ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁëﬁ≠ﬁìﬁßﬁáﬁ¨ﬁáﬁ∞ ﬁäﬁÆﬁÄﬁ¨ﬁçﬁß</button>
</div>

<div class="table-container">
    <table id="mainTable">
        <thead>
            <tr>
                <th id="h-no">ﬁêﬁ™ﬁâﬁßﬁÉﬁ™</th>
                <th id="h-name">ﬁäﬁ™ﬁÉﬁ®ﬁÄﬁ¶ﬁâﬁ¶ ﬁÇﬁ¶ﬁÇﬁ∞</th>
                <th id="h-id">ﬁáﬁ¶ﬁáﬁ®ﬁëﬁ© ﬁÜﬁßﬁëﬁ™</th>
                <th id="h-addr1">ﬁãﬁßﬁáﬁ®ﬁâﬁ© ﬁáﬁ¨ﬁëﬁ∞ﬁÉﬁ¨ﬁêﬁ∞</th>
                <th id="h-addr2">ﬁãﬁ®ﬁÉﬁ®ﬁáﬁ™ﬁÖﬁ≠ ﬁáﬁ¨ﬁëﬁ∞ﬁÉﬁ¨ﬁêﬁ∞</th>
                <th id="h-p1">ﬁäﬁØﬁÇﬁ™ 1</th>
                <th id="h-p2">ﬁäﬁØﬁÇﬁ™ 2</th>
                <th id="h-support">ﬁåﬁßﬁáﬁ©ﬁãﬁ™</th>
                <th id="h-voted">ﬁàﬁØﬁìﬁ™</th>
                <th id="h-comm">ﬁÜﬁÆﬁâﬁ¨ﬁÇﬁ∞ﬁìﬁ∞</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>



<script>
    let voters = JSON.parse(localStorage.getItem('election_data')) || [];
    let supportChart, voterChart;

    const langDoc = {
        dv: { title: "ﬁùﬁßﬁÄﬁ© ﬁáﬁ®ﬁÇﬁ∞ﬁåﬁ®ﬁöﬁßﬁÑﬁ© ﬁâﬁ¶ﬁÉﬁ™ﬁÜﬁ¶ﬁíﬁ™", import: "ﬁêﬁ©.ﬁáﬁ¨ﬁêﬁ∞.ﬁàﬁ© ﬁçﬁ®ﬁêﬁ∞ﬁìﬁ™ ﬁáﬁ¶ﬁÖﬁ™ﬁáﬁ∞ﬁàﬁß", dummy: "ﬁëﬁ¶ﬁâﬁ© ﬁäﬁ¶ﬁáﬁ®ﬁçﬁ∞ ﬁëﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁçﬁØﬁëﬁ∞", export: "ﬁêﬁ©.ﬁáﬁ¨ﬁêﬁ∞.ﬁàﬁ© ﬁÉﬁ®ﬁïﬁØﬁìﬁ∞", print: "ﬁïﬁ∞ﬁÉﬁ®ﬁÇﬁ∞ﬁìﬁ∞ / PDF", clear: "ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁëﬁ≠ﬁìﬁßﬁáﬁ¨ﬁáﬁ∞ ﬁäﬁÆﬁÄﬁ¨ﬁçﬁß", dir: "rtl" },
        en: { title: "Royal Election Suite", import: "Import CSV", dummy: "Download Dummy", export: "Export CSV", print: "Print / PDF", clear: "Clear All Data", dir: "ltr" }
    };

    function switchLang(l) {
        document.body.dir = langDoc[l].dir;
        document.getElementById('app-title').innerText = langDoc[l].title;
        document.getElementById('btn-import').innerText = langDoc[l].import;
        document.getElementById('btn-dummy').innerText = langDoc[l].dummy;
        document.getElementById('btn-export').innerText = langDoc[l].export;
        document.getElementById('btn-print').innerText = langDoc[l].print;
        document.getElementById('btn-clear').innerText = langDoc[l].clear;
        renderTable();
    }

    function initCharts() {
        const config = (id, label, colors) => new Chart(document.getElementById(id), {
            type: 'bar',
            data: { labels: [], datasets: [{ label: label, data: [], backgroundColor: colors }] },
            options: { maintainAspectRatio: false, color: '#fff' }
        });
        supportChart = config('supportChart', 'ﬁåﬁßﬁáﬁ©ﬁãﬁ™', ['#c5a059', '#d32f2f', '#777']);
        voterChart = config('voterChart', 'ﬁàﬁØﬁìﬁ™ﬁçﬁ© ﬁâﬁ®ﬁÇﬁ∞ﬁàﬁ¶ﬁÉﬁ™', ['#2e7d32', '#555']);
        updateUI();
    }

    function handleFileUpload(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function(event) {
            const rows = event.target.result.split('\n').slice(1);
            voters = rows.map((row, i) => {
                const cols = row.split(',');
                if(cols.length < 5) return null;
                return {
                    no: i+1, name: cols[1], id: cols[2], addr1: cols[3], addr2: cols[4],
                    p1: cols[5], p2: cols[6], support: 'none', voted: false, comment: ''
                };
            }).filter(x => x !== null);
            saveData();
        };
        reader.readAsText(file);
    }

    function downloadDummyCSV() {
        const content = "No,Name,ID,Permanent Address,Current Address,Phone1,Phone2\n1,Ahmed Mohamed,A000000,H. Moon,G. Sun,7771234,9991234\n2,Fatmath Ali,A111111,Ma. Rose,Ma. Sky,7778888,9990000";
        const blob = new Blob([content], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = "election_dummy.csv"; a.click();
    }

    function toggleSupport(index, val) {
        voters[index].support = (voters[index].support === val) ? 'none' : val;
        saveData();
    }

    function toggleVote(index) {
        voters[index].voted = !voters[index].voted;
        saveData();
    }

    function updateComment(index, val) {
        voters[index].comment = val;
        saveData();
    }

    function saveData() {
        localStorage.setItem('election_data', JSON.stringify(voters));
        updateUI();
    }

    function updateUI() {
        renderTable();
        const yes = voters.filter(v => v.support === 'yes').length;
        const no = voters.filter(v => v.support === 'no').length;
        const maybe = voters.filter(v => v.support === 'none').length;
        const voted = voters.filter(v => v.voted).length;

        supportChart.data.labels = ['ﬁåﬁßﬁáﬁ©ﬁãﬁ™', 'ﬁÇﬁ™ﬁÜﬁ™ﬁÉﬁ≠', 'ﬁÇﬁ≠ﬁÇﬁéﬁ≠'];
        supportChart.data.datasets[0].data = [yes, no, maybe];
        supportChart.update();

        voterChart.data.labels = ['ﬁçﬁ© ﬁâﬁ©ﬁÄﬁ™ﬁÇﬁ∞', 'ﬁÇﬁ™ﬁçﬁß ﬁâﬁ©ﬁÄﬁ™ﬁÇﬁ∞'];
        voterChart.data.datasets[0].data = [voted, voters.length - voted];
        voterChart.update();
    }

    function renderTable() {
        const body = document.getElementById('tableBody');
        body.innerHTML = voters.map((v, i) => `
            <tr>
                <td>${i+1}</td>
                <td>${v.name}</td>
                <td>${v.id}</td>
                <td>${v.addr1}</td>
                <td>${v.addr2}</td>
                <td>${v.p1}</td>
                <td>${v.p2}</td>
                <td>
                    <button class="btn-vote ${v.support==='yes'?'active-yes':''}" onclick="toggleSupport(${i},'yes')">üëç</button>
                    <button class="btn-vote ${v.support==='no'?'active-no':''}" onclick="toggleSupport(${i},'no')">üëé</button>
                </td>
                <td>
                    <button class="btn-vote ${v.voted?'active-yes':''}" onclick="toggleVote(${i})">${v.voted?'ﬁçﬁ¶ﬁáﬁ®ﬁäﬁ®':'ﬁÇﬁ™ﬁçﬁß'}</button>
                </td>
                <td><input type="text" value="${v.comment}" onchange="updateComment(${i}, this.value)"></td>
            </tr>
        `).join('');
    }

    function exportCSV() {
        let csv = "No,Name,ID,Address,Phone,Support,Voted,Comment\n";
        voters.forEach(v => { csv += `${v.no},${v.name},${v.id},${v.addr1},${v.p1},${v.support},${v.voted},${v.comment}\n`; });
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob); a.download = "Full_Report.csv"; a.click();
    }

    function clearData() { if(confirm("ﬁÜﬁ¶ﬁÅﬁ¶ﬁàﬁ¶ﬁÉﬁ™ﬁåﬁØÿü ﬁÄﬁ™ﬁÉﬁ®ﬁÄﬁß ﬁâﬁ¶ﬁáﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ¨ﬁáﬁ∞ ﬁäﬁÆﬁÄﬁ¨ﬁàﬁ≠ﬁÇﬁ¨!")) { voters = []; saveData(); } }

    window.onload = initCharts;
</script>
</body>
</html>
