```html
<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Royal Graduation (V17.0 - Ultimate Pro)</title>
    <style>
        /* 1. Google Font (Backup for Dhivehi) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thaana:wght@400;700&display=swap');
        /* Import for Traditional Arabic */
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
        /* 2. Faruuma Font (Local) */
        @font-face {
            font-family: 'Faruuma';
            src: local('Faruuma'), local('Faruumaa'), url('Fonts/faruuma.ttf') format('truetype');
        }
        /* --- GLOBAL VARIABLES --- */
        :root {
            --royal-accent: #c5a059;
            --royal-blue-dark: #001b3d;
            --royal-blue-mid: #0d47a1;
            --royal-green: #003322;
            --input-bg: #e3f2fd;
            --input-border: #90caf9;
            --panel-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }
        /* DEFAULT BODY STYLE (DHIVEHI) */
        body {
            -webkit-user-select: none; user-select: none;
            margin: 0; padding: 0;
            background: linear-gradient(135deg, #000c1a 0%, #00281c 100%);
            overflow: hidden; height: 100vh; width: 100vw;
            color: #333;
            /* Default Font for the App is Dhivehi */
            font-family: 'Faruuma', 'MV Boli', 'Noto Sans Thaana', serif;
        }
        /* --- LANGUAGE SWITCHER TABS (ADDED SECTION) --- */
        .lang-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            justify-content: center;
            direction: ltr !important;
            flex-shrink: 0; /* Prevent shrinking */
        }
        .lang-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            text-decoration: none;
            background: #37474f;
            color: #fff;
            border-radius: 4px;
            font-size: 13px;
            font-weight: bold;
            border: 1px solid #555;
            transition: 0.3s;
            font-family: sans-serif !important; /* Force readable font */
        }
        .lang-btn:hover { background: var(--royal-accent); color: #000; }
        .lang-btn.active { background: var(--royal-blue-mid); border: 1px solid #fff; pointer-events: none; }
        /* --- SCREEN SWITCHER TABS --- */
        .screen-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            justify-content: center;
            direction: ltr !important;
            flex-shrink: 0;
        }
        .screen-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            background: #37474f;
            color: #fff;
            border-radius: 4px;
            font-size: 13px;
            font-weight: bold;
            border: 1px solid #555;
            transition: 0.3s;
            font-family: sans-serif !important;
        }
        .screen-btn:hover { background: var(--royal-accent); color: #000; }
        .screen-btn.active { background: var(--royal-green); border: 1px solid #fff; pointer-events: none; }
        /* --- SECURITY OVERLAY (ENGLISH STYLING) --- */
        #securityOverlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.98); z-index: 99999;
            display: flex; justify-content: center; align-items: center;
            
            /* FORCE ENGLISH SETTINGS FOR THIS WINDOW */
            direction: ltr !important;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            text-align: center;
        }
        /* Ensure all text inside security box is English Font */
        #securityOverlay * {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            direction: ltr !important;
        }
        .sec-box {
            background: linear-gradient(135deg, var(--royal-blue-dark), var(--royal-green));
            padding: 60px; border-radius: 20px;
            border: 2px solid var(--royal-accent);
            box-shadow: 0 0 50px rgba(13, 71, 161, 0.5);
            max-width: 600px; width: 90%;
        }
        
        .sec-input {
            padding: 15px;
            font-size: 24px;
            text-align: center;
            width: 100%;
            margin-top: 20px;
            background: #fff;
            color: #000;
            border-radius:5px;
            border:none;
        }
        
        .sec-btn {
            margin-top: 25px;
            padding: 15px 50px;
            font-size: 20px;
            background: var(--royal-blue-mid);
            color: #fff;
            border: 1px solid #fff;
            cursor: pointer;
            font-weight: bold;
            border-radius:8px;
            text-transform: uppercase;
        }
        .sec-btn:hover { background: #fff; color: var(--royal-blue-mid); }
        /* --- REST OF APP (DHIVEHI STYLING) --- */
        
        /* Force Dhivehi Font on these elements */
        .sidebar, .editor, button:not(.sec-btn, .lang-btn, .screen-btn), input:not(.sec-input), select, textarea, h1, h2, h3, label, span, div:not(.lang-tabs, .screen-tabs) {
             font-family: 'Faruuma', 'MV Boli', 'Noto Sans Thaana', serif;
        }
        /* --- TOP BANNER --- */
        .royal-banner {
            background: linear-gradient(to right, var(--royal-blue-dark), var(--royal-green));
            color: #fff;
            text-align: center;
            padding: 15px;
            border-bottom: 3px solid var(--royal-accent);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            border-radius: 8px;
            flex-shrink: 0; /* Prevent shrinking */
        }
        .banner-main { font-family: 'Times New Roman', serif !important; font-weight: bold; font-size: 14px; letter-spacing: 2px; color: #a0c4ff; display: block; }
        .banner-sub { font-size: 24px; color: var(--royal-accent); text-shadow: 0 2px 4px #000; display: block; margin-top: 5px; }
        /* --- UI LAYOUT --- */
        .main-layout {
            display: none; gap: 20px; height: 100vh; width: 100vw;
            padding: 15px; box-sizing: border-box;
        }
        /* SIDEBAR (FIXED SCROLLING ISSUE) */
        .sidebar {
            flex: 0 0 360px;
            background: #f8fbff;
            padding: 15px; border-radius: 12px;
            display: flex; flex-direction: column; height: 100%;
            overflow-y: auto; /* Enable vertical scrolling */
            box-shadow: var(--panel-shadow);
            border: 3px solid var(--royal-blue-dark);
        }
        
        .sidebar h2 { color: var(--royal-blue-dark); text-align:center; margin-bottom: 10px; border-bottom: 2px solid var(--royal-blue-mid); padding-bottom: 5px; font-size: 22px; }
        
        /* DEVELOPER CREDITS */
        .dev-credits {
            margin-top: 20px; /* Ensure space above */
            text-align: center;
            font-size: 13px;
            color: #555;
            background: #e3f2fd;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #bbdefb;
            font-weight: bold;
            line-height: 1.4;
            flex-shrink: 0; /* Prevent shrinking */
        }
        .dev-name { color: var(--royal-blue-dark); font-size: 14px; display: block; margin-bottom: 2px; }
        .company-name { color: var(--royal-green); font-size: 12px; display: block; letter-spacing: 0.5px; }
        /* EDITOR (RIGHT) */
        .editor {
            flex: 1;
            background: #fff;
            padding: 25px; border-radius: 12px;
            display: flex; flex-direction: column; height: 100%; overflow-y: auto;
            position: relative;
            box-shadow: var(--panel-shadow);
            border: 3px solid var(--royal-green);
        }
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 12px; }
        ::-webkit-scrollbar-track { background: #eee; }
        ::-webkit-scrollbar-thumb { background: var(--royal-blue-mid); border-radius: 6px; }
        /* --- STYLING CONTROLS --- */
        h2, h3 { margin: 5px 0; }
        label { display: block; font-weight: bold; font-size: 16px; margin-bottom: 5px; color: var(--royal-blue-dark); }
        
        /* CATEGORY HEADERS */
        .d-label {
            font-size: 18px;
            font-weight: 900;
            color: var(--royal-blue-mid);
            display: block;
            margin-top: 15px;
            margin-bottom: 8px;
            border-bottom: 2px solid #b3e5fc;
            padding-bottom: 4px;
        }
        /* INPUTS */
        input[type="text"], textarea, select {
            width: 100%; padding: 10px;
            border: 1px solid var(--input-border);
            border-radius: 6px;
            background: var(--input-bg);
            color: #000;
            margin-bottom: 8px;
            font-size: 16px;
            box-sizing: border-box; transition: all 0.3s;
        }
        input[type="text"]:focus, select:focus, textarea:focus {
            border-color: var(--royal-blue-mid);
            background: #fff;
            outline: none;
            box-shadow: 0 0 8px rgba(13, 71, 161, 0.3);
        }
        /* --- SPECIAL STYLING FOR JALSA TITLES --- */
        #jLine1 {
            font-size: 28px !important;
            font-weight: 900 !important;
            text-align: center !important;
            color: var(--royal-blue-dark);
            border: 2px solid var(--royal-accent);
            background: #fff8e1; /* Light gold tint background */
            height: 60px;
        }
        #jLine2, #jLine3, #jLine4 {
            font-size: 20px !important;
            font-weight: bold !important;
            text-align: center !important;
            color: var(--royal-blue-mid);
            height: 45px;
        }
        /* FONT SIZES & ALIGNMENT */
        .font-dv { font-size: 20px !important; direction: rtl; text-align: right; }
        .eng { font-size: 18px !important; direction: ltr; text-align: left; font-family: 'Times New Roman', serif !important; font-weight: bold; }
        input[type=range] { width: 100%; cursor: pointer; height: 15px; accent-color: var(--royal-blue-mid); margin: 5px 0; }
        input[type=color] { width: 45px; height: 35px; border: 2px solid #fff; border-radius: 6px; cursor: pointer; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        /* --- SETTINGS GROUPS --- */
        .group-box {
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 30px 20px 20px 20px;
            margin-bottom: 35px;
            background: #f1f8e9;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .group-title {
            position: absolute; top: -20px; right: 20px;
            background: var(--royal-blue-dark);
            color: #fff;
            padding: 8px 25px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); z-index: 10;
        }
        .design-col { flex: 1; }
        /* --- BUTTONS --- */
        button { cursor: pointer; font-weight: bold; transition: all 0.2s; }
        
        .launch-btn {
            background: linear-gradient(to bottom, #d32f2f, #b71c1c);
            color: white; padding: 12px; width: 100%; border: 1px solid #ffcdd2;
            border-radius: 6px; margin-bottom: 10px; font-size: 18px; box-shadow: 0 3px 5px rgba(0,0,0,0.2);
        }
        .launch-btn:hover { filter: brightness(1.1); }
        .conf-btn { flex: 1; padding: 8px; font-size: 14px; border-radius: 4px; border: 1px solid #1565c0; color: #fff; background: var(--royal-blue-mid); }
        .conf-btn:hover { background: var(--royal-blue-dark); }
        .config-btn-row { display: flex; gap: 5px; margin-bottom: 10px; }
        .btn-live {
            background: linear-gradient(to bottom, #2e7d32, #1b5e20);
            flex: 2; border: 2px solid #a5d6a7;
            color: #fff; font-size: 20px; padding: 12px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .btn-live:hover { filter: brightness(1.1); }
        
        .btn-nav { background: #546e7a; color: white; padding: 12px; font-size: 20px; border: none; border-radius: 8px; width: 60px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #lockBtn {
            background: #fbc02d; color: #000; padding: 12px; width: 100%; border: 2px solid #fff;
            border-radius: 8px; margin-bottom: 15px; font-size: 18px; box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        #lockBtn.active { background: #c62828; color: white; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(198, 40, 40, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(198, 40, 40, 0); } 100% { box-shadow: 0 0 0 0 rgba(198, 40, 40, 0); } }
        .locked-zone { opacity: 0.5; pointer-events: none; filter: grayscale(80%); user-select: none; transition: all 0.3s ease; }
        /* --- PREVIEW --- */
        .preview-container {
            display: flex; gap: 15px; align-items: center; justify-content: center;
            background: #fff; padding: 15px; border: 2px solid #b2dfdb;
            border-radius: 10px; margin-top: 15px;
        }
        #previewImg { height: 90px; width: 90px; object-fit: cover; border-radius: 50%; border: 3px solid var(--royal-blue-mid); background: #eee; }
        
        .video-panel { background: #e1f5fe; padding: 15px; border-radius: 10px; border: 1px solid #81d4fa; margin-bottom: 20px; }
        .btn-vid { font-size: 14px; padding: 8px; margin-top: 5px; border:none; border-radius:4px; color:white; width: 100%; cursor: pointer; font-weight:bold; }
        /* --- SYSTEM FILES --- */
        #sidebarFiles {
            background: #fff;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 10px;
            /* RTL set for Dhivehi interface */
            direction: rtl !important;
            text-align: right !important;
        }
        #sidebarFiles label {
            font-size: 14px;
            color: #444;
            margin-bottom: 3px;
        }
        #sidebarFiles input[type="file"] {
            font-size: 12px;
            padding: 5px;
            direction: ltr; /* Keeps filenames readable */
        }
        /* --- FULL SCREEN BUTTON --- */
        #cpFsBtn {
            position: fixed; bottom: 20px; left: 20px; width: 45px; height: 45px;
            background: var(--royal-blue-dark); color: #fff; border-radius: 50%;
            border: 2px solid #fff; box-shadow: 0 0 15px rgba(0,0,0,0.5);
            z-index: 1000; font-size: 20px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.3s;
        }
        #cpFsBtn:hover { transform: scale(1.1); background: var(--royal-green); }
    </style>
</head>
<body oncontextmenu="return false;">
    <button id="cpFsBtn" onclick="toggleControlFS()" title="ﬁäﬁ™ﬁçﬁ∞ ﬁêﬁ∞ﬁÜﬁ∞ﬁÉﬁ©ﬁÇﬁ∞">‚õ∂</button>
    <div id="securityOverlay">
        <div class="sec-box">
            <h1 style="color:#fff; font-size:45px; margin-bottom:10px; text-shadow:0 2px 5px #000;">Royal Graduation V17.0</h1>
            <p style="color:#a0c4ff; font-size:18px; margin-bottom:30px;">üîí PRO EDITION - ENTER LICENSE KEY</p>
            
            <input type="password" id="licenseKey" class="sec-input" placeholder="Enter Key...">
            <button class="sec-btn" onclick="verifyLicense()">AUTHENTICATE</button>
            <p id="secMsg" style="color:#ff5252; font-size:16px; margin-top:20px; font-weight:bold;"></p>
        </div>
    </div>
    <div class="main-layout" id="mainApp">
        <div class="sidebar">
            
            <div class="lang-tabs">
                <a href="#" class="lang-btn active">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®</a>
                <a href="event_slideshow-eng.html" class="lang-btn">English</a>
                <a href="event_slideshow-ara.html" class="lang-btn">ÿπÿ±ÿ®Ÿä</a>
            </div>
            <div class="screen-tabs">
                <button class="screen-btn" onclick="switchScreen('left')">Left Screen</button>
                <button class="screen-btn active" onclick="switchScreen('main')">Main Screen</button>
                <button class="screen-btn" onclick="switchScreen('right')">Right Screen</button>
            </div>
            <div class="royal-banner">
                <span class="banner-main">EVENT AND GRADUATION CEREMONY SOFTWARE</span>
                <span class="banner-sub">ﬁÉﬁØﬁîﬁ¶ﬁçﬁ∞ ﬁéﬁ™ﬁÉﬁ¨ﬁñﬁ™ﬁáﬁ≠ﬁùﬁ¶ﬁÇﬁ∞ ﬁêﬁ®ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞</span>
            </div>
            <div id="licenseStatus" style="font-size:13px; color:#0d47a1; text-align:center; margin-bottom:10px; font-weight:bold;"></div>
            <h2>Screen Management</h2>
            <button class="launch-btn" onclick="openScreen('left')">üñ•Ô∏è Open Left Screen</button>
            <button class="launch-btn" onclick="openScreen('main')">üñ•Ô∏è Open Main Screen</button>
            <button class="launch-btn" onclick="openScreen('right')">üñ•Ô∏è Open Right Screen</button>
            <button class="conf-btn" onclick="toggleScreen('left')">On/Off Left</button>
            <button class="conf-btn" onclick="toggleScreen('main')">On/Off Main</button>
            <button class="conf-btn" onclick="toggleScreen('right')">On/Off Right</button>
            <button class="conf-btn" onclick="rescueMain()">Rescue Main</button>
            <button class="conf-btn" onclick="shiftToMain('left')">Shift Left to Main</button>
            <button class="conf-btn" onclick="shiftToMain('right')">Shift Right to Main</button>
            <div id="connStatusLeft" style="font-size:14px; color:red; text-align:center; background:#ffebee; padding:4px; border-radius:4px; margin-bottom:10px; border:1px solid #ffcdd2;">Left: ﬁÜﬁ¶ﬁÇﬁ¨ﬁÜﬁ∞ﬁìﬁ∞ ﬁÇﬁ™ﬁàﬁ≠</div>
            <div id="connStatusMain" style="font-size:14px; color:red; text-align:center; background:#ffebee; padding:4px; border-radius:4px; margin-bottom:10px; border:1px solid #ffcdd2;">Main: ﬁÜﬁ¶ﬁÇﬁ¨ﬁÜﬁ∞ﬁìﬁ∞ ﬁÇﬁ™ﬁàﬁ≠</div>
            <div id="connStatusRight" style="font-size:14px; color:red; text-align:center; background:#ffebee; padding:4px; border-radius:4px; margin-bottom:10px; border:1px solid #ffcdd2;">Right: ﬁÜﬁ¶ﬁÇﬁ¨ﬁÜﬁ∞ﬁìﬁ∞ ﬁÇﬁ™ﬁàﬁ≠</div>
            <div class="config-btn-row">
                <button class="conf-btn" onclick="downloadConfig()">‚¨á ﬁêﬁ≠ﬁàﬁ∞ ﬁêﬁ¨ﬁìﬁ®ﬁÇﬁ∞ﬁéﬁ∞ﬁêﬁ∞</button>
                <button class="conf-btn" onclick="document.getElementById('confInput').click()">‚¨Ü ﬁçﬁØﬁëﬁ∞ ﬁêﬁ¨ﬁìﬁ®ﬁÇﬁ∞ﬁéﬁ∞ﬁêﬁ∞</button>
                <input type="file" id="confInput" accept=".json" style="display:none" onchange="loadConfig(this)">
            </div>
            <div id="sidebarFiles">
                <label style="color:#0d47a1; border-bottom:1px solid #e3f2fd; padding-bottom:5px; margin-bottom:8px; font-size:16px; font-weight:bold;">üìÇ ﬁêﬁ®ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁäﬁ¶ﬁáﬁ®ﬁçﬁ∞ﬁåﬁ¶ﬁáﬁ∞</label>
                <label>1. ﬁÜﬁ™ﬁãﬁ®ﬁÇﬁ∞ﬁéﬁ¨ ﬁçﬁ®ﬁêﬁ∞ﬁìﬁ™ (CSV):</label><input type="file" id="csvFile" accept=".csv">
                <label>2. ﬁäﬁÆﬁìﬁØ ﬁäﬁØﬁçﬁ∞ﬁëﬁ¶ﬁÉ:</label><input type="file" id="photoFolder" webkitdirectory directory multiple>
                <label>3. ﬁàﬁ©ﬁëﬁ®ﬁáﬁØ ﬁäﬁØﬁçﬁ∞ﬁëﬁ¶ﬁÉ:</label><input type="file" id="videoFolder" webkitdirectory directory multiple>
                <label>4. ﬁçﬁØﬁéﬁØ ﬁäﬁ¶ﬁáﬁ®ﬁçﬁ∞:</label><input type="file" id="logoFile" accept="image/*">
                <label>5. ﬁÜﬁ¶ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ 1 (TTF):</label><input type="file" id="fontFile1" accept=".ttf, .otf">
                <label>6. ﬁÜﬁ¶ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ 2 (TTF):</label><input type="file" id="fontFile2" accept=".ttf, .otf">
                <label>7. ﬁÜﬁ¶ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁäﬁÆﬁÇﬁ∞ﬁìﬁ∞ 3 (TTF):</label><input type="file" id="fontFile3" accept=".ttf, .otf">
                <label>8. ﬁñﬁ¶ﬁçﬁ∞ﬁêﬁßﬁéﬁ¨ ﬁÇﬁ¶ﬁÇﬁ∞ﬁåﬁ¶ﬁáﬁ∞ (CSV):</label><input type="file" id="jalsaCsvFile" accept=".csv">
                <label style="color:#d84315;">9. ﬁÜﬁ¶ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞:</label><input type="file" id="customBorderFile" accept="image/*">
                <label>10. ﬁêﬁ∞ﬁïﬁÆﬁÇﬁ∞ﬁêﬁ¶ﬁÉ ﬁçﬁØﬁéﬁØﬁêﬁ∞/ﬁÑﬁ¨ﬁÇﬁ¶ﬁÉﬁêﬁ∞:</label><input type="file" id="logosFiles" accept="image/*" multiple>
                <label>11. ﬁêﬁ∞ﬁìﬁßﬁÉ PNG:</label><input type="file" id="starFile" accept="image/png">
                <label>12. ﬁìﬁ∞ﬁÉﬁØﬁäﬁ© PNG:</label><input type="file" id="trophyFile" accept="image/png">
            </div>
            <label style="margin-top:15px; color:#00281c;">üîç ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ™ﬁÇﬁ∞ ﬁÄﬁØﬁáﬁ∞ﬁãﬁ¶ﬁàﬁß:</label>
            <input type="text" id="search" placeholder="ﬁÇﬁ¶ﬁÇﬁ∞ ﬁñﬁ¶ﬁáﬁ∞ﬁêﬁ¶ﬁàﬁß..." onkeyup="filterList()">
            
            <select id="stuList" size="10" style="flex-grow:1; border:1px solid #ccc; min-height: 200px;" onchange="loadStudent()"></select>
            
            <div class="group-box">
                <span class="group-title">üèÜ Awards Section</span>
                <label>Category:</label>
                <select id="categorySel"></select>
                <label>Top N:</label>
                <select id="topN">
                    <option value="5">Top 5</option>
                    <option value="10">Top 10</option>
                </select>
                <label>Play on Screen:</label>
                <select id="awardTarget">
                    <option value="left">Left</option>
                    <option value="main">Main</option>
                    <option value="right">Right</option>
                </select>
                <button class="btn-live" onclick="playTopVideos()">Play Top Videos</button>
            </div>
            
            <div class="dev-credits">
                <span style="display:block; margin-bottom:3px;">ﬁïﬁ∞ﬁÉﬁÆﬁéﬁ∞ﬁÉﬁßﬁâﬁ∞ ﬁëﬁ®ﬁíﬁ¶ﬁáﬁ®ﬁÇﬁ∞ﬁÜﬁÆﬁÅﬁ∞ ﬁáﬁ™ﬁäﬁ¨ﬁáﬁ∞ﬁãﬁ©:</span>
                <span class="dev-name">ﬁëﬁ®ﬁàﬁ¨ﬁçﬁÆﬁïﬁ¶ﬁÉ ﬁ¢ﬁ¶ﬁçﬁ© ﬁáﬁ®ﬁÑﬁ∞ﬁÉﬁßﬁÄﬁ©ﬁâﬁ∞ ﬁãﬁ©ﬁãﬁ© (7791550)</span>
                <span class="company-name">ZAAD RESEARCH AND PUBLISHING CONSULTANCY FIRM</span>
            </div>
        </div>
        <div class="editor" id="editorPanel">
            <button id="lockBtn" onclick="toggleLock()">üîì ﬁÄﬁ™ﬁÖﬁ™ﬁàﬁ®ﬁäﬁ¶ﬁáﬁ® (ﬁÑﬁ¶ﬁãﬁ¶ﬁçﬁ™ﬁÜﬁ™ﬁÉﬁ¨ﬁàﬁ≠ ﬁâﬁØﬁëﬁ™)</button>
            <div class="controls">
                <button class="action btn-nav" onclick="move(-1)">‚óÄ</button>
                <button class="action btn-live" onclick="updateTV()">üì∫ ﬁçﬁ¶ﬁáﬁ®ﬁàﬁ∞ ﬁÜﬁ™ﬁÉﬁ≠</button>
                <button class="action btn-nav" onclick="move(1)">‚ñ∂</button>
                <button class="action btn-nav" style="background:#c62828; font-size:16px;" onclick="clearTV()">X</button>
            </div>
            <div class="video-panel">
                <div style="display:flex; gap:8px;">
                    <input type="file" id="videoLocal" accept="video/*" style="width:70%">
                    <button class="btn-vid" style="background:#ef6c00; width:30%;" onclick="playLocalVideo()">‚ñ∂ ﬁàﬁ©ﬁëﬁ®ﬁáﬁØ ﬁñﬁ¶ﬁáﬁ∞ﬁêﬁß</button>
                </div>
                <div style="display:flex; gap:8px; margin-top:5px;">
                    <input type="text" id="ytLink" placeholder="ﬁîﬁ´ﬁìﬁ®ﬁáﬁ™ﬁÑﬁ∞ ﬁçﬁ®ﬁÇﬁ∞ﬁÜﬁ∞..." style="width:50%; text-align:left;" class="font-en">
                    <button class="btn-vid" style="background:#c62828; width:30%;" onclick="playYoutube()">‚ñ∂ ﬁîﬁ´ﬁìﬁ®ﬁáﬁ™ﬁÑﬁ∞</button>
                    <button class="btn-vid" style="background:#0277bd; width:20%;" onclick="openYTPopup()">‚ö†Ô∏è ﬁïﬁÆﬁïﬁ∞ﬁáﬁ¶ﬁïﬁ∞</button>
                </div>
                <button class="btn-vid" style="background:#37474f; margin-top:5px; padding:10px;" onclick="stopVideo()">‚èπ ﬁàﬁ©ﬁëﬁ®ﬁáﬁØ ﬁïﬁ∞ﬁçﬁ≠ﬁîﬁ¶ﬁÉ ﬁÄﬁ™ﬁáﬁ∞ﬁìﬁßﬁçﬁß</button>
            </div>
            <div id="statusMsg" style="font-weight:bold; color:#00695c; text-align:center; font-size:18px; margin:5px 0;">ﬁêﬁ®ﬁêﬁ∞ﬁìﬁ¶ﬁâﬁ∞ ﬁÉﬁ¨ﬁëﬁ©</div>
            <div style="background:#fff; padding:20px; border-radius:10px; border:2px solid #90caf9; margin:15px 0; box-shadow:0 3px 10px rgba(0,0,0,0.05);">
                <h3 style="margin-top:0; font-size:22px; color:#0d47a1; border-bottom:1px solid #e3f2fd; padding-bottom:5px;">üéì ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ™ﬁéﬁ¨ ﬁâﬁ¶ﬁ¢ﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ™</h3>
                
                <div style="margin-bottom: 10px;">
                    <label style="font-size:14px; color:#555;">ﬁÇﬁ¶ﬁÇﬁ∞ (ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®):</label>
                    <input id="nD" class="font-dv" placeholder="ﬁÇﬁ¶ﬁÇﬁ∞ (ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®)" style="width:100%;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="font-size:14px; color:#555; text-align:right; display:block;">ﬁÇﬁ¶ﬁÇﬁ∞ (ﬁáﬁ®ﬁÇﬁéﬁ®ﬁÉﬁ≠ﬁêﬁ®):</label>
                    <input id="nE" class="eng" placeholder="Name (English)" style="width:100%; text-align:left;">
                </div>
                
                <div class="row" style="display:flex; gap:10px; width:100%;">
    <div class="col" style="flex:1;">
        <input id="fD" class="font-dv" placeholder="ﬁåﬁ¶ﬁäﬁ∞ﬁêﬁ©ﬁçﬁ™ 1 (ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®)" style="width:100%; text-align:right;">
    </div>
    <div class="col" style="flex:1;">
        <input id="fE" class="eng" placeholder="Detail 1 (English)" style="width:100%; direction:ltr; text-align:left;">
    </div>
</div>
<div class="row" style="display:flex; gap:10px; width:100%; margin-top:5px;">
    <div class="col" style="flex:1;">
        <input id="cD" class="font-dv" placeholder="ﬁåﬁ¶ﬁäﬁ∞ﬁêﬁ©ﬁçﬁ™ 2 (ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®)" style="width:100%; text-align:right;">
    </div>
    <div class="col" style="flex:1;">
        <input id="cE" class="eng" placeholder="Detail 2 (English)" style="width:100%; direction:ltr; text-align:left;">
    </div>
</div>
                
                <textarea id="cm" rows="2" class="font-dv" placeholder="ﬁáﬁ®ﬁåﬁ™ﬁÉﬁ™ ﬁâﬁ¶ﬁ¢ﬁ™ﬁçﬁ´ﬁâﬁßﬁåﬁ™..."></textarea>
                <div class="preview-container">
                    <div><img id="logoPreview" alt="Logo" style="height:50px; opacity:0.5;"></div>
                    <div style="text-align:center;">
                        <span id="pStat" style="font-size:14px; font-weight:bold; color:#777;">ﬁäﬁÆﬁìﬁØﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ¨ﬁåﬁ∞</span><br>
                        <img id="previewImg" src="https://via.placeholder.com/150">
                        <br><button style="font-size:12px; padding:3px 8px; margin-top:5px; background:#607d8b; color:#fff; border:none; border-radius:4px;" onclick="document.getElementById('singlePhoto').click()">ﬁÑﬁ¶ﬁãﬁ¶ﬁçﬁ™ﬁÜﬁ™ﬁÉﬁ≠</button>
                        <input type="file" id="singlePhoto" accept="image/*" style="display:none" onchange="manualPhoto(this)">
                    </div>
                </div>
            </div>
            <div style="text-align:center; font-size:15px; color:#777; margin:20px 0; font-weight:bold; letter-spacing:1px; background:#eceff1; padding:5px; border-radius:20px;">‚¨á ﬁêﬁ¨ﬁìﬁ®ﬁÇﬁ∞ﬁéﬁ∞ﬁêﬁ∞ ﬁáﬁ¶ﬁãﬁ® ﬁëﬁ®ﬁíﬁ¶ﬁáﬁ®ﬁÇﬁ∞ ﬁÜﬁÆﬁÇﬁ∞ﬁìﬁ∞ﬁÉﬁØﬁçﬁ∞ ‚¨á</div>
            <div id="designPanel">
                
                <div class="group-box">
                    <span class="group-title">üñ•Ô∏è Screen Scaling</span>
                    <span class="d-label">Zoom/Scale:</span>
                    <input type="range" id="scaleRange" min="0.5" max="2" step="0.1" value="1" oninput="liveUpdate('scale', this.value)">
                </div>
                
                <div class="group-box">
                    <span class="group-title">üè∑Ô∏è Branding (Logos & Banners)</span>
                    <span class="d-label">Position:</span>
                    <select id="bannersPositionSel" onchange="liveUpdate('bannersPosition', this.value)">
                        <option value="bottom">Bottom</option>
                        <option value="top">Up</option>
                        <option value="left">Left</option>
                        <option value="right">Right</option>
                    </select>
                    <span class="d-label">Size:</span>
                    <input type="range" id="logosSizeRange" min="50" max="300" value="100" oninput="liveUpdate('logosSize', this.value)">
                    <span class="d-label">Spacing/Gap:</span>
                    <input type="range" id="logosGapRange" min="0" max="100" value="20" oninput="liveUpdate('logosGap', this.value)">
                </div>
                
                <div class="group-box">
                    <span class="group-title">‚≠ê Graphics & Animations</span>
                    <span class="d-label">Trophy Position X:</span>
                    <input type="range" id="trophyXRange" min="-500" max="500" value="0" oninput="liveUpdate('trophyX', this.value)">
                    <span class="d-label">Trophy Position Y:</span>
                    <input type="range" id="trophyYRange" min="-500" max="500" value="0" oninput="liveUpdate('trophyY', this.value)">
                    <span class="d-label">Trophy Size:</span>
                    <input type="range" id="trophySizeRange" min="50" max="300" value="100" oninput="liveUpdate('trophySize', this.value)">
                </div>
                
                <div class="group-box">
                    <span class="group-title">üî§ Font Customization</span>
                    <span class="d-label">Row 1 Font:</span>
                    <select id="row1FontSel" onchange="liveUpdate('row1Font', this.value)">
                        <option value="font1">Font 1 (Faruma/Dhivehi)</option>
                        <option value="font2">Font 2 (Traditional Arabic)</option>
                        <option value="font3">Font 3 (Another)</option>
                    </select>
                    <span class="d-label">Row 2 Font:</span>
                    <select id="row2FontSel" onchange="liveUpdate('row2Font', this.value)">
                        <option value="font1">Font 1 (Faruma/Dhivehi)</option>
                        <option value="font2">Font 2 (Traditional Arabic)</option>
                        <option value="font3">Font 3 (Another)</option>
                    </select>
                    <span class="d-label">Row 3 Font:</span>
                    <select id="row3FontSel" onchange="liveUpdate('row3Font', this.value)">
                        <option value="font1">Font 1 (Faruma/Dhivehi)</option>
                        <option value="font2">Font 2 (Traditional Arabic)</option>
                        <option value="font3">Font 3 (Another)</option>
                    </select>
                </div>
                
                <div class="group-box">
                    <span class="group-title">üåç ﬁåﬁ©ﬁâﬁ∞ ﬁáﬁ¶ﬁãﬁ® ﬁÑﬁ¨ﬁÜﬁ∞ﬁéﬁ∞ﬁÉﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁëﬁ∞</span>
                    <div class="design-col">
                        <span class="d-label">1. ﬁàﬁØﬁçﬁ∞ﬁïﬁ≠ﬁïﬁ¶ﬁÉ ﬁÑﬁ¨ﬁÜﬁ∞ﬁéﬁ∞ﬁÉﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁëﬁ∞:</span>
                        <div style="display:flex; gap:10px;">
                            <select id="bgPresetSel" onchange="liveUpdate('bgPreset', this.value)" style="width:70%;">
                                 <script> for(let i=1; i<=50; i++) document.write(`<option value="bg${i}">ﬁÉﬁØﬁîﬁ¶ﬁçﬁ∞ ﬁåﬁ©ﬁâﬁ∞ ${i}</option>`); </script>
                            </select>
                            <input type="file" id="jalsaBgFile" accept="video/*, image/*" style="width:30%" title="Upload Custom BG">
                        </div>
                        <div style="margin-top:8px;">
                            <select id="bgLoopSel" onchange="liveUpdate('bgLoop', this.value)" style="background:#fff;">
                                <option value="on">ﬁàﬁ©ﬁëﬁ®ﬁáﬁØ ﬁåﬁ¶ﬁÜﬁ™ﬁÉﬁßﬁÉﬁ™: ﬁáﬁßﬁÇ</option>
                                <option value="off">ﬁàﬁ©ﬁëﬁ®ﬁáﬁØ ﬁåﬁ¶ﬁÜﬁ™ﬁÉﬁßﬁÉﬁ™: ﬁÇﬁ´ﬁÇﬁ∞</option>
                            </select>
                        </div>
                        <span class="d-label">2. ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ™ﬁéﬁ¨ ﬁÜﬁßﬁëﬁ™ ﬁëﬁ®ﬁíﬁ¶ﬁáﬁ®ﬁÇﬁ∞:</span>
                        <div style="display:flex; gap:10px;">
                            <select id="cBorderSel" onchange="liveUpdate('cBorder', this.value)" style="width:75%;">
                                <option value="custom">üñºÔ∏è ﬁáﬁ¶ﬁâﬁ®ﬁáﬁ∞ﬁçﬁ¶ ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞ (Image)</option>
                                <script> for(let i=1; i<=50; i++) document.write(`<option value="b${i}">ﬁÜﬁßﬁëﬁ™ ﬁêﬁ∞ﬁìﬁ¶ﬁáﬁ®ﬁçﬁ∞ ${i}</option>`); </script>
                                <option value="b0">üö´ ﬁÑﬁØﬁëﬁ¶ﬁÉﬁ¨ﬁáﬁ∞ ﬁÇﬁ¨ﬁåﬁ∞ (ﬁìﬁ∞ﬁÉﬁßﬁÇﬁ∞ﬁêﬁ∞ﬁïﬁ≠ﬁÉﬁ¨ﬁÇﬁ∞ﬁìﬁ∞)</option>
                            </select>
                            <input type="color" id="bdColorPick" value="#d4af37" oninput="liveUpdate('bdColor', this.value)" title="Theme Color">
                        </div>
                        <span class="d-label">3. ﬁÜﬁßﬁëﬁ™ﬁéﬁ¨ ﬁâﬁ¶ﬁ§ﬁßﬁâﬁ∞ (ﬁïﬁÆﬁíﬁ®ﬁùﬁ¶ﬁÇﬁ∞):</span>
                        <div style="display:flex; gap:10px; align-items:center; background:#fff; padding:10px; border-radius:8px; border:1px solid #ccc;">
                            <span style="font-size:14px; font-weight:bold;">ﬁÜﬁ¶ﬁÇﬁßﬁåﬁ∞/ﬁàﬁßﬁåﬁ∞:</span>
                            <input type="range" id="cardXRange" min="-600" max="600" value="0" oninput="liveUpdate('cardX', this.value)">
                            <span style="font-size:14px; font-weight:bold;">ﬁâﬁ¶ﬁåﬁ®/ﬁåﬁ®ﬁÉﬁ®:</span>
                            <input type="range" id="cardYRange" min="-450" max="450" value="0" oninput="liveUpdate('cardY', this.value)">
                        </div>
                        <span class="d-label">4. ﬁÜﬁßﬁëﬁ™ﬁéﬁ¨ ﬁêﬁ¶ﬁáﬁ®ﬁíﬁ∞:</span>
                        <div style="display:flex; gap:15px; align-items:center;">
                            <span style="font-size:14px; font-weight:bold;">ﬁäﬁ™ﬁÖﬁßﬁâﬁ®ﬁÇﬁ∞:</span>
                            <input type="range" id="cardWRange" min="50" max="100" value="90" oninput="liveUpdate('cardW', this.value)">
                            <span style="font-size:14px; font-weight:bold;">ﬁáﬁ™ﬁêﬁ∞ﬁâﬁ®ﬁÇﬁ∞:</span>
                            <input type="range" id="cardHRange" min="50" max="100" value="80" oninput="liveUpdate('cardH', this.value)">
                        </div>
                        <div style="display:flex; gap:10px; margin-top:8px;">
                            <select id="layoutDirSel" onchange="liveUpdate('layoutDir', this.value)" style="width:50%;">
                                <option value="rtl">ﬁäﬁÆﬁìﬁØ ﬁÜﬁ¶ﬁÇﬁßﬁåﬁ∞ ﬁäﬁ¶ﬁÉﬁßﬁåﬁ™ﬁéﬁ¶ﬁáﬁ® (RTL)</option>
                                <option value="ltr">ﬁäﬁÆﬁìﬁØ ﬁàﬁßﬁåﬁ∞ ﬁäﬁ¶ﬁÉﬁßﬁåﬁ™ﬁéﬁ¶ﬁáﬁ® (LTR)</option>
                            </select>
                            <select id="textAlignSel" onchange="liveUpdate('textAlign', this.value)" style="width:50%;">
                                <option value="right">ﬁçﬁ®ﬁîﬁ™ﬁÇﬁ∞: ﬁÜﬁ¶ﬁÇﬁßﬁåﬁ¶ﬁÅﬁ∞</option>
                                <option value="center">ﬁçﬁ®ﬁîﬁ™ﬁÇﬁ∞: ﬁâﬁ¨ﬁãﬁ¶ﬁÅﬁ∞</option>
                                <option value="left">ﬁçﬁ®ﬁîﬁ™ﬁÇﬁ∞: ﬁàﬁßﬁåﬁ¶ﬁÅﬁ∞</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="group-box">
                    <span class="group-title">üì∏ ﬁäﬁÆﬁìﬁØ ﬁêﬁ∞ﬁìﬁ´ﬁëﬁ®ﬁáﬁØ</span>
                    
                    <span class="d-label">1. ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞ ﬁêﬁ∞ﬁìﬁ¶ﬁáﬁ®ﬁçﬁ∞:</span>
                    <select id="photoPresetSel" onchange="applyPhotoPreset(this.value)" style="width:100%; font-weight:bold; font-size:15px; padding:10px;">
                        <option value="0">--- ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞ ﬁêﬁ∞ﬁìﬁ¶ﬁáﬁ®ﬁçﬁ∞ ﬁÇﬁ¶ﬁéﬁß ---</option>
                        <optgroup label="ﬁÑﬁØﬁëﬁ¶ﬁÉﬁ¨ﬁáﬁ∞ ﬁÇﬁ™ﬁàﬁ¶ﬁåﬁ¶ ﬁùﬁ¨ﬁëﬁØﬁáﬁ¨ﬁáﬁ∞ ﬁÇﬁ¨ﬁåﬁ∞">
                            <option value="1">1. ﬁáﬁßﬁãﬁ¶ﬁáﬁ®ﬁéﬁ¨ (ﬁÑﬁØﬁëﬁ¶ﬁÉﬁ¨ﬁáﬁ∞ ﬁÇﬁ¨ﬁåﬁ∞)</option>
                            <option value="2">2. ﬁâﬁ¶ﬁëﬁ™ ﬁÄﬁ®ﬁîﬁ¶ﬁÇﬁ® (Soft Shadow)</option>
                            <option value="3">3. ﬁéﬁ¶ﬁãﬁ¶ ﬁÄﬁ®ﬁîﬁ¶ﬁÇﬁ® (Hard Shadow)</option>
                            <option value="4">4. ﬁãﬁ®ﬁáﬁ∞ﬁçﬁ≠ ﬁéﬁÆﬁåﬁ¶ﬁÅﬁ∞ (Glow)</option>
                        </optgroup>
                        <optgroup label="ﬁáﬁßﬁãﬁ¶ﬁáﬁ®ﬁéﬁ¨ ﬁÑﬁØﬁëﬁ¶ﬁÉﬁ™">
                            <option value="5">5. ﬁÄﬁ®ﬁâﬁ¶ ﬁÜﬁ¶ﬁÖﬁ™ ﬁÉﬁÆﬁÇﬁéﬁ™</option>
                            <option value="6">6. ﬁÑﬁØ ﬁÇﬁ´ ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞</option>
                            <option value="7">7. ﬁåﬁ®ﬁÜﬁ® ﬁñﬁ¨ﬁÄﬁ® ﬁÉﬁÆﬁÇﬁéﬁ™</option>
                            <option value="8">8. ﬁÜﬁ¨ﬁÇﬁëﬁ®ﬁäﬁ¶ﬁáﬁ®ﬁàﬁß ﬁÉﬁÆﬁÇﬁéﬁ™</option>
                            <option value="9">9. ﬁëﬁ¶ﬁÑﬁ¶ﬁçﬁ∞ ﬁçﬁ¶ﬁáﬁ®ﬁÇﬁ∞</option>
                            <option value="10">10. ﬁàﬁ¶ﬁÅﬁ∞ ﬁÜﬁ¶ﬁÇﬁ¨ﬁáﬁ∞ (Rounded)</option>
                            <option value="11">11. ﬁàﬁ¶ﬁÅﬁ∞ ﬁÑﬁ™ﬁÉﬁ™ (Circle)</option>
                        </optgroup>
                        <optgroup label="ﬁÜﬁ∞ﬁÉﬁ®ﬁáﬁ≠ﬁìﬁ®ﬁàﬁ∞">
                            <option value="12">12. ﬁáﬁ¨ﬁåﬁ¨ﬁÉﬁ¨ﬁáﬁ¶ﬁÅﬁ∞ ﬁàﬁ¶ﬁãﬁ¨ﬁäﬁ¶ﬁáﬁ® (Inset 3D)</option>
                            <option value="13">13. ﬁÑﬁ≠ﬁÉﬁ¶ﬁÅﬁ∞ ﬁÇﬁ™ﬁÜﬁ™ﬁâﬁ¨ﬁäﬁ¶ﬁáﬁ® (Outset 3D)</option>
                            <option value="14">14. ﬁïﬁÆﬁçﬁ¶ﬁÉﬁÆﬁáﬁ®ﬁëﬁ∞ ﬁêﬁ∞ﬁìﬁ¶ﬁáﬁ®ﬁçﬁ∞</option>
                            <option value="15">15. ﬁÉﬁ¶ﬁÇﬁ∞ ﬁÜﬁ™ﬁçﬁ¶ﬁáﬁ®ﬁéﬁ¨ ﬁéﬁ∞ﬁÉﬁ´ﬁàﬁ∞</option>
                            <option value="16">16. ﬁÜﬁßﬁëﬁ™ ﬁêﬁ∞ﬁìﬁ¶ﬁáﬁ®ﬁçﬁ∞</option>
                        </optgroup>
                    </select>
                    <span class="d-label">2. ﬁäﬁ∞ﬁÉﬁ≠ﬁâﬁ∞ ﬁáﬁ¨ﬁñﬁ¶ﬁêﬁ∞ﬁìﬁ∞ﬁâﬁ¶ﬁÇﬁ∞ﬁìﬁ∞:</span>
                    <div style="display:flex; gap:10px; align-items:center; background:#fff; padding:10px; border-radius:8px; border:1px solid #b2dfdb;">
                        <span style="font-size:14px;">ﬁÜﬁ™ﬁçﬁ¶:</span><input type="color" id="pfColorPick" value="#000000" oninput="liveUpdate('pfColor', this.value)">
                        <span style="font-size:14px;">ﬁäﬁ™ﬁÖﬁßﬁâﬁ®ﬁÇﬁ∞:</span><input type="range" id="pfWidthRange" min="0" max="30" value="0" oninput="liveUpdate('pfWidth', this.value)">
                        <span style="font-size:14px;">ﬁàﬁ¶ﬁÅﬁ∞:</span><input type="range" id="pfRadiusRange" min="0" max="50" value="0" oninput="liveUpdate('pfRadius', this.value)">
                    </div>
                    
                    <span class="d-label">3. ﬁäﬁÆﬁìﬁØﬁéﬁ¨ ﬁâﬁ¶ﬁ§ﬁßﬁâﬁ∞ ﬁáﬁ¶ﬁãﬁ® ﬁíﬁ´ﬁâﬁ∞:</span>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <span style="font-size:14px; width:50px;">ﬁíﬁ´ﬁâﬁ∞:</span>
                        <input type="range" id="pSizeRange" min="150" max="800" value="260" oninput="liveUpdate('pSize', this.value)">
                        <select id="pVisSel" onchange="liveUpdate('pVis', this.value)" style="width:100px;"><option value="show">ﬁãﬁ¶ﬁáﬁ∞ﬁÜﬁß</option><option value="hide">ﬁäﬁÆﬁÉﬁ™ﬁàﬁß</option></select>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:8px; align-items:center;">
                        <span style="font-size:14px; width:50px;">ﬁâﬁ´ﬁàﬁ∞:</span>
                        <input type="range" id="pXRange" min="-600" max="600" value="0" title="X" oninput="liveUpdate('pX', this.value)">
                        <input type="range" id="pYRange" min="-400" max="400" value="0" title="Y" oninput="liveUpdate('pY', this.value)">
                    </div>
                </div>
                <div class="group-box">
                    <span class="group-title">üî§ ﬁçﬁ®ﬁîﬁ™ﬁÇﬁ∞ﬁåﬁ¶ﬁÜﬁ™ﬁéﬁ¨ ﬁëﬁ®ﬁíﬁ¶ﬁáﬁ®ﬁÇﬁ∞</span>
                    
                    <span class="d-label">1. ﬁãﬁ¶ﬁÉﬁ®ﬁàﬁ¶ﬁÉﬁ™ﬁéﬁ¨ ﬁÇﬁ¶ﬁÇﬁ∞ (ﬁêﬁ¶ﬁáﬁ®ﬁíﬁ∞/ﬁÜﬁ™ﬁçﬁ¶):</span>
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
                        <span style="font-size:14px; width:60px;">ﬁãﬁ®ﬁàﬁ¨ﬁÄﬁ®:</span>
                        <input type="range" min="2" max="10" step="0.1" value="6.5" oninput="liveUpdate('tnDSize', this.value)">
                        <input type="color" value="#ffffff" oninput="liveUpdate('tnDColor', this.value)">
                    </div>
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
                        <span style="font-size:14px; width:60px;">ﬁáﬁ®ﬁÇﬁéﬁ®ﬁÉﬁ≠ﬁêﬁ®:</span>
                        <input type="range" min="1" max="8" step="0.1" value="4.5" oninput="liveUpdate('tnESize', this.value)">
                        <input type="color" value="#ffffff" oninput="liveUpdate('tnEColor', this.value)">
                    </div>
                    <div style="margin-top:5px;">
                        <select onchange="liveUpdate('nLine', this.value)" style="background:#fff;">
                            <option value="off">ﬁÇﬁ¶ﬁâﬁ™ﬁéﬁ¨ ﬁåﬁ®ﬁÉﬁ© ﬁÉﬁÆﬁÇﬁéﬁ™: ﬁÇﬁ™ﬁçﬁß</option>
                            <option value="on">ﬁÇﬁ¶ﬁâﬁ™ﬁéﬁ¨ ﬁåﬁ®ﬁÉﬁ© ﬁÉﬁÆﬁÇﬁéﬁ™: ﬁçﬁß</option>
                        </select>
                    </div>
                    
                    <hr style="border:1px dashed #aaa; margin:12px 0;">
                    <span class="d-label">2. ﬁåﬁ¶ﬁäﬁ∞ﬁêﬁ©ﬁçﬁ™ ﬁçﬁ¶ﬁáﬁ®ﬁÇﬁ∞ﬁåﬁ¶ﬁáﬁ∞:</span>
                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
                        <span style="font-size:14px; width:60px;">ﬁçﬁ¶ﬁáﬁ®ﬁÇﬁ∞ 1:</span>
                        <input type="range" min="1" max="6" step="0.1" value="2.5" oninput="liveUpdate('tfDSize', this.value)">
                        <input type="color" value="#fff9c4" oninput="liveUpdate('tfDColor', this.value)">
                    </div>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <span style="font-size:14px; width:60px;">ﬁçﬁ¶ﬁáﬁ®ﬁÇﬁ∞ 2:</span>
                        <input type="range" min="1" max="6" step="0.1" value="3.0" oninput="liveUpdate('tcDSize', this.value)">
                        <input type="color" value="#fff9c4" oninput="liveUpdate('tcDColor', this.value)">
                    </div>
                </div>
                <div class="group-box">
                    <span class="group-title">üëë ﬁñﬁ¶ﬁçﬁ∞ﬁêﬁßﬁéﬁ¨ ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ﬁåﬁ¶ﬁáﬁ∞</span>
                    
                    <span class="d-label">1. ﬁâﬁ¶ﬁáﬁ® ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞:</span>
                    <input type="text" id="jLine1" placeholder="ﬁâﬁ¶ﬁáﬁ® ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞..." class="font-dv" oninput="updateJalsaText()">
                    
                    <div style="display:flex; align-items:center; gap:15px; margin-top:8px; background:#fff; padding:10px; border-radius:8px; border:1px solid #bbdefb;">
                        <div style="flex:1;">
                            <span style="font-size:13px; color:#555; display:block;">ﬁâﬁ¶ﬁåﬁ®/ﬁåﬁ®ﬁÉﬁ® (Y):</span>
                            <input type="range" id="mtYRange" min="-600" max="600" value="210" oninput="liveUpdate('mtY', this.value)">
                            <span style="font-size:13px; color:#555; display:block;">ﬁÜﬁ¶ﬁÇﬁßﬁåﬁ∞/ﬁàﬁßﬁåﬁ∞ (X):</span>
                            <input type="range" id="mtXRange" min="-800" max="800" value="0" oninput="liveUpdate('mtX', this.value)">
                        </div>
                        <div class="arrow-controls">
                            <button class="btn-arr" onclick="adjustTitle('y', -10)">‚¨Ü</button>
                            <div class="arrow-row">
                                <button class="btn-arr" onclick="adjustTitle('x', -10)">‚¨Ö</button>
                                <button class="btn-arr" onclick="adjustTitle('x', 10)">‚û°</button>
                            </div>
                            <button class="btn-arr" onclick="adjustTitle('y', 10)">‚¨á</button>
                        </div>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
                        <span style="font-size:14px;">ﬁêﬁ¶ﬁáﬁ®ﬁíﬁ∞:</span>
                        <input type="range" id="mtSizeRange" min="2" max="10" step="0.1" value="5.6" oninput="liveUpdate('mtSize', this.value)">
                        <input type="color" id="mtColorPick" value="#d4af37" oninput="liveUpdate('mtColor', this.value)">
                        <select id="mtAlignSel" onchange="liveUpdate('mtAlign', this.value)" style="width:100px;"><option value="center">ﬁâﬁ¨ﬁãﬁ¶ﬁÅﬁ∞</option><option value="right">ﬁÜﬁ¶ﬁÇﬁßﬁåﬁ¶ﬁÅﬁ∞</option><option value="left">ﬁàﬁßﬁåﬁ¶ﬁÅﬁ∞</option></select>
                    </div>
                    <div style="margin-top:5px;">
                        <select onchange="liveUpdate('tLine', this.value)" style="background:#fff;">
                            <option value="on">ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ ﬁåﬁ®ﬁÉﬁ© ﬁÉﬁÆﬁÇﬁéﬁ™: ﬁçﬁß</option>
                            <option value="off">ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ ﬁåﬁ®ﬁÉﬁ© ﬁÉﬁÆﬁÇﬁéﬁ™: ﬁÇﬁ™ﬁçﬁß</option>
                        </select>
                    </div>
                    <hr style="border:1px dashed #999; margin:15px 0;">
                    <span class="d-label">2. ﬁêﬁ¶ﬁÑﬁ∞ ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ﬁåﬁ¶ﬁáﬁ∞:</span>
                    <input type="text" id="jLine2" placeholder="ﬁêﬁ¶ﬁÑﬁ∞ ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ 1" class="font-dv">
                    <input type="text" id="jLine3" placeholder="ﬁêﬁ¶ﬁÑﬁ∞ ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ 2" class="font-dv">
                    <input type="text" id="jLine4" placeholder="ﬁêﬁ¶ﬁÑﬁ∞ ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ 3" class="font-dv">
                    
                    <div style="display:flex; gap:10px; margin-top:8px; align-items:center;">
                        <span style="font-size:14px;">ﬁêﬁ¶ﬁáﬁ®ﬁíﬁ∞:</span>
                        <input type="range" id="stSizeRange" min="1" max="6" step="0.1" value="2.6" oninput="liveUpdate('stSize', this.value)">
                        <input type="color" id="stColorPick" value="#ffffff" oninput="liveUpdate('stColor', this.value)">
                    </div>
                    <div style="display:flex; gap:10px; margin-top:8px; align-items:center;">
                        <span style="font-size:14px;">ﬁáﬁ¨ﬁçﬁ¶ﬁáﬁ®ﬁÇﬁ∞:</span>
                        <select id="stAlignSel" onchange="liveUpdate('stAlign', this.value)" style="width:100%; background:#fff;">
                            <option value="center">ﬁâﬁ¨ﬁãﬁ¶ﬁÅﬁ∞</option>
                            <option value="right">ﬁÜﬁ¶ﬁÇﬁßﬁåﬁ¶ﬁÅﬁ∞</option>
                            <option value="left">ﬁàﬁßﬁåﬁ¶ﬁÅﬁ∞</option>
                        </select>
                        <span style="font-size:14px;">ﬁãﬁ™ﬁÉﬁ™ﬁâﬁ®ﬁÇﬁ∞:</span>
                        <input type="range" id="stYRange" min="0" max="100" value="0" title="Space" oninput="liveUpdate('stY', this.value)">
                    </div>
                    
                    <button class="btn-vid" style="background:#2e7d32; width:100%; margin-top:15px; font-weight:bold; font-size:18px; padding:12px;" onclick="updateJalsaText()">ﬁìﬁ¶ﬁáﬁ®ﬁìﬁ∞ﬁçﬁ∞ﬁåﬁ¶ﬁáﬁ∞ ﬁáﬁ¶ﬁïﬁ∞ﬁëﬁ≠ﬁìﬁ∞ ﬁÜﬁ™ﬁÉﬁ≠</button>
                </div>
                <div class="group-box">
                    <span class="group-title">üñºÔ∏è ﬁçﬁØﬁéﬁØ ﬁÜﬁÆﬁÇﬁ∞ﬁìﬁ∞ﬁÉﬁØﬁçﬁ∞</span>
                    <div style="display:flex; gap:10px;">
                        <select id="lShapeSel" onchange="liveUpdate('lShape', this.value)" style="width:50%;">
                            <option value="square">ﬁÄﬁ¶ﬁåﬁ¶ﬁÉﬁ¨ﬁêﬁ∞ﬁÜﬁ¶ﬁÇ (Square)</option>
                            <option value="rounded">ﬁÉﬁ¶ﬁáﬁ™ﬁÇﬁ∞ﬁëﬁ¨ﬁëﬁ∞</option>
                            <option value="circle">ﬁàﬁ¶ﬁÅﬁ∞ (Circle)</option>
                        </select>
                        <select id="lVisSel" onchange="liveUpdate('lVis', this.value)" style="width:50%;">
                            <option value="show">ﬁãﬁ¶ﬁáﬁ∞ﬁÜﬁß</option>
                            <option value="hide">ﬁäﬁÆﬁÉﬁ™ﬁàﬁß</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:10px; margin-top:10px; align-items:center;">
                        <span style="font-size:14px;">ﬁâﬁ´ﬁàﬁ∞:</span>
                        <input type="range" id="logoXRange" min="-1200" max="1200" value="0" oninput="liveUpdate('logoX', this.value)" title="X">
                        <input type="range" id="logoYRange" min="0" max="900" value="40" oninput="liveUpdate('logoY', this.value)" title="Y">
                        <span style="font-size:14px;">ﬁêﬁ¶ﬁáﬁ®ﬁíﬁ∞:</span>
                        <input type="range" id="lSizeRange" min="50" max="500" value="145" oninput="liveUpdate('lSize', this.value)" title="Size">
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    document.addEventListener('contextmenu', event => event.preventDefault());
    
    // --- FULL SCREEN ---
    function toggleControlFS() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
                alert(`Error: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
    }
    // --- LICENSE LOGIC ---
    function verifyLicense() {
        const inputKey = document.getElementById('licenseKey').value.trim();
        const msg = document.getElementById('secMsg');
        const btn = document.querySelector('.sec-btn');
        if(!inputKey) { msg.innerText = "Please enter a key."; return; }
        btn.innerText = "VERIFYING...";
        setTimeout(() => {
            try {
                const reversed = inputKey.split('').reverse().join('');
                const payload = JSON.parse(atob(reversed));
                if(payload.s !== "ROYAL_V5_SECURE") throw new Error("Invalid License Key!");
                document.getElementById('securityOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'flex';
                document.getElementById('licenseStatus').innerText = "‚úÖ PREMIUM LICENSE | EXP: " + new Date(payload.e).toLocaleDateString();
            } catch(e) {
                console.error(e); msg.innerText = "‚ùå ACCESS DENIED: " + (e.message || "Invalid Key"); btn.innerText = "TRY AGAIN"; document.getElementById('licenseKey').value = "";
            }
        }, 800);
    }
    document.getElementById('licenseKey').addEventListener("keyup", e => { if (e.key === "Enter") verifyLicense(); });
    let currentTarget = 'main';
    let screens = { left: null, main: null, right: null };
    let students = [];
    let photoFiles = {};
    let videoFiles = {};
    let currentPhotoData = null;
    let currentLogoData = null;
    let customFontsData = {font1: null, font2: null, font3: null};
    let customFonts = {font1: 'Faruuma', font2: 'Amiri', font3: 'serif'};
    let currentJalsaBgData = null;
    let currentJalsaBgType = 'none';
    let customBorderData = null;
    let starData = null;
    let trophyData = null;
    let isLocked = false;
    let lastActiveState = 'title';
    let categories = new Set();
    // DEFAULT STATE
    let defaultDesignState = {
        mtY: 210, mtX: 0, mtSize: 5.6, mtColor: '#d4af37', mtAlign: 'center', tLine: 'on',
        stY: 0, stX: 0, stSize: 2.6, stColor: '#ffffff', stAlign: 'center',
        logoY: 40, logoX: 0, lVis: 'show', lShape: 'square', lSize: 145,
        pSize: 260, pX: 0, pY: 0, pVis: 'show',
        pfWidth: 0, pfColor: '#000000', pfStyle: 'solid', pfRadius: 0, pfShadow: 'none',
        cBorder: 'b1', bdColor: '#d4af37', bgPreset: 'bg1',
        layoutDir: 'rtl', textAlign: 'right', bgLoop: 'on',
        tnDSize: 6.5, tnDColor: '#ffffff', tnESize: 4.5, tnEColor: '#ffffff', nLine: 'off',
        tfDSize: 2.5, tfDColor: '#fff9c4', tcDSize: 3.0, tcDColor: '#fff9c4',
        cardW: 90, cardH: 80, cardX: 0, cardY: 0,
        scale: 1,
        bannersPosition: 'bottom', logosSize: 100, logosGap: 20, logos: [],
        trophyX: 0, trophyY: 0, trophySize: 100,
        row1Font: 'font1', row2Font: 'font2', row3Font: 'font3'
    };
    let designStates = {
        left: { ...defaultDesignState },
        main: { ...defaultDesignState },
        right: { ...defaultDesignState }
    };
    let designState = designStates['main']; // Current reference
    // --- LOCK FUNCTION ---
    function toggleLock() {
        isLocked = !isLocked;
        const btn = document.getElementById('lockBtn');
        const designPanel = document.getElementById('designPanel');
        const sidebarFiles = document.getElementById('sidebarFiles');
        const searchInput = document.getElementById('search');
        if (isLocked) {
            btn.innerHTML = "üîí SYSTEM LOCKED (LIVE MODE)";
            btn.classList.add('active');
            designPanel.classList.add('locked-zone');
            sidebarFiles.classList.add('locked-zone');
            if(searchInput) searchInput.disabled = true;
        } else {
            btn.innerHTML = "üîì UNLOCKED (Edit Mode)";
            btn.classList.remove('active');
            designPanel.classList.remove('locked-zone');
            sidebarFiles.classList.remove('locked-zone');
            if(searchInput) searchInput.disabled = false;
        }
    }
    function downloadConfig() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(designStates[currentTarget]));
        const a = document.createElement('a'); a.href = dataStr; a.download = "royal_config_" + currentTarget + "_v17.json"; document.body.appendChild(a); a.click(); a.remove();
    }
    function loadConfig(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                designStates[currentTarget] = JSON.parse(e.target.result);
                loadStateToControls();
                sendStateToScreen(currentTarget);
                alert("Settings Loaded for " + currentTarget + "!");
            } catch(err) { alert("Invalid Config File"); }
        };
        reader.readAsText(file);
    }
    
    function loadStateToControls() {
        designState = designStates[currentTarget];
        setVal('scaleRange', designState.scale);
        setVal('bannersPositionSel', designState.bannersPosition);
        setVal('logosSizeRange', designState.logosSize);
        setVal('logosGapRange', designState.logosGap);
        setVal('trophyXRange', designState.trophyX);
        setVal('trophyYRange', designState.trophyY);
        setVal('trophySizeRange', designState.trophySize);
        setVal('row1FontSel', designState.row1Font);
        setVal('row2FontSel', designState.row2Font);
        setVal('row3FontSel', designState.row3Font);
        // Add setVal for all other fields similarly
        setVal('mtYRange', designState.mtY);
        setVal('mtXRange', designState.mtX);
        setVal('mtSizeRange', designState.mtSize);
        setVal('mtColorPick', designState.mtColor);
        setVal('mtAlignSel', designState.mtAlign);
        setVal('stSizeRange', designState.stSize);
        setVal('stColorPick', designState.stColor);
        setVal('stAlignSel', designState.stAlign);
        setVal('stYRange', designState.stY);
        setVal('lShapeSel', designState.lShape);
        setVal('lVisSel', designState.lVis);
        setVal('logoXRange', designState.logoX);
        setVal('logoYRange', designState.logoY);
        setVal('lSizeRange', designState.lSize);
        setVal('pSizeRange', designState.pSize);
        setVal('pXRange', designState.pX);
        setVal('pYRange', designState.pY);
        setVal('pVisSel', designState.pVis);
        setVal('pfWidthRange', designState.pfWidth);
        setVal('pfColorPick', designState.pfColor);
        setVal('pfRadiusRange', designState.pfRadius);
        setVal('cBorderSel', designState.cBorder);
        setVal('bdColorPick', designState.bdColor);
        setVal('bgPresetSel', designState.bgPreset);
        setVal('layoutDirSel', designState.layoutDir);
        setVal('textAlignSel', designState.textAlign);
        setVal('bgLoopSel', designState.bgLoop);
        setVal('cardWRange', designState.cardW);
        setVal('cardHRange', designState.cardH);
        setVal('cardXRange', designState.cardX);
        setVal('cardYRange', designState.cardY);
        // etc for tnDSize, etc.
    }
    function switchScreen(target) {
        currentTarget = target;
        const btns = document.querySelectorAll('.screen-btn');
        btns.forEach(b => b.classList.remove('active'));
        document.querySelector(`[onclick="switchScreen('${target}')"]`).classList.add('active');
        loadStateToControls();
        window.focus();
    }
    function setVal(id, val) { const el = document.getElementById(id); if(el) el.value = val; }
    function applyPhotoPreset(val) {
        let w = 0, c = '#000000', s = 'solid', r = 0, sh = 'none';
        switch(val) {
            case "1": break;
            case "2": sh = '0 4px 8px rgba(0,0,0,0.3)'; break;
            case "3": sh = '5px 5px 0px rgba(0,0,0,1)'; break;
            case "4": sh = '0 0 15px rgba(0, 150, 255, 0.6)'; break;
            case "5": w=1; break;
            case "6": w=6; c='#0056b3'; break;
            case "7": w=4; c='#d9534f'; s='dotted'; break;
            case "8": w=4; c='#5cb85c'; s='dashed'; break;
            case "9": w=6; c='#f0ad4e'; s='double'; break;
            case "10": w=3; c='#333333'; r=10; break;
            case "11": w=3; c='#5bc0de'; r=50; break;
            case "12": w=10; c='#999999'; s='inset'; break;
            case "13": w=10; c='#999999'; s='outset'; break;
            case "14": w=15; c='#ffffff'; sh='0 2px 5px rgba(0,0,0,0.3)'; break;
            case "15": w=8; c='#FFD700'; s='groove'; break;
            case "16": w=5; c='#ffffff'; r=5; sh='0 4px 6px rgba(0,0,0,0.1)'; break;
        }
        setVal('pfWidthRange', w); setVal('pfColorPick', c); setVal('pfRadiusRange', r);
        liveUpdate('pfWidth', w); liveUpdate('pfColor', c); liveUpdate('pfStyle', s);
        liveUpdate('pfRadius', r); liveUpdate('pfShadow', sh);
    }
    
    function adjustTitle(axis, val) {
        if(axis === 'y') {
            let current = parseInt(document.getElementById('mtYRange').value);
            let newVal = current + val;
            document.getElementById('mtYRange').value = newVal;
            liveUpdate('mtY', newVal);
        } else if (axis === 'x') {
            let current = parseInt(document.getElementById('mtXRange').value);
            let newVal = current + val;
            document.getElementById('mtXRange').value = newVal;
            liveUpdate('mtX', newVal);
        }
    }
    function liveUpdate(key, value) {
        if(isLocked) return;
        designStates[currentTarget][key] = value;
        const win = screens[currentTarget];
        if(!win || win.closed) return;
        const doc = win.document;
        if(key === 'scale') {
            doc.body.style.transform = `scale(${value})`;
            doc.body.style.transformOrigin = 'top left';
        }
        if(key === 'bannersPosition' || key === 'logosSize' || key === 'logosGap' ) {
            const banners = doc.getElementById('banners');
            if(banners) {
                banners.style.position = 'absolute';
                banners.style.display = 'flex';
                banners.style.gap = designStates[currentTarget].logosGap + 'px';
                if(key === 'logosSize') {
                    banners.querySelectorAll('img').forEach(img => img.style.height = value + 'px');
                }
                switch(designStates[currentTarget].bannersPosition) {
                    case 'bottom': banners.style.bottom = '0'; banners.style.top = 'auto'; banners.style.left = '0'; banners.style.right = 'auto'; banners.style.width = '100%'; banners.style.height = 'auto'; banners.style.flexDirection = 'row'; banners.style.justifyContent = 'center'; break;
                    case 'top': banners.style.top = '0'; banners.style.bottom = 'auto'; banners.style.left = '0'; banners.style.right = 'auto'; banners.style.width = '100%'; banners.style.height = 'auto'; banners.style.flexDirection = 'row'; banners.style.justifyContent = 'center'; break;
                    case 'left': banners.style.left = '0'; banners.style.right = 'auto'; banners.style.top = '0'; banners.style.bottom = 'auto'; banners.style.height = '100%'; banners.style.width = 'auto'; banners.style.flexDirection = 'column'; banners.style.justifyContent = 'center'; break;
                    case 'right': banners.style.right = '0'; banners.style.left = 'auto'; banners.style.top = '0'; banners.style.bottom = 'auto'; banners.style.height = '100%'; banners.style.width = 'auto'; banners.style.flexDirection = 'column'; banners.style.justifyContent = 'center'; break;
                }
            }
        }
        if(key === 'row1Font') {
            doc.getElementById('jt1').style.fontFamily = customFonts[value];
            doc.getElementById('tnD').style.fontFamily = customFonts[value];
        }
        if(key === 'row2Font') {
            doc.getElementById('jt2').style.fontFamily = customFonts[value];
            doc.getElementById('tfD').style.fontFamily = customFonts[value];
        }
        if(key === 'row3Font') {
            doc.getElementById('jt3').style.fontFamily = customFonts[value];
            doc.getElementById('tcD').style.fontFamily = customFonts[value];
            doc.getElementById('tcm').style.fontFamily = customFonts[value];
        }
        // ... (keep existing liveUpdate logic, replacing tvWindow with win)
        if(key === 'pfWidth' || key === 'pfColor' || key === 'pfStyle' || key === 'pfRadius' || key === 'pfShadow') {
            const img = doc.getElementById('stuImg');
            if(img) {
                if(key === 'pfShadow') img.style.boxShadow = value;
                else {
                    img.style.borderWidth = designStates[currentTarget].pfWidth + 'px';
                    img.style.borderColor = designStates[currentTarget].pfColor;
                    img.style.borderStyle = designStates[currentTarget].pfStyle;
                    img.style.borderRadius = designStates[currentTarget].pfRadius + '%';
                }
            }
        }
        // Add similar for other keys, replacing designState with designStates[currentTarget]
        // For trophy
        if(key === 'trophyX' || key === 'trophyY' || key === 'trophySize') {
            const trophy = doc.getElementById('trophy');
            if(trophy) {
                trophy.style.left = designStates[currentTarget].trophyX + 'px';
                trophy.style.top = designStates[currentTarget].trophyY + 'px';
                trophy.style.width = designStates[currentTarget].trophySize + 'px';
            }
        }
        // For star, similar if rank1, but in updateTV
    }
    // --- TV WINDOW ---
    function openScreen(target) {
        let w, h;
        if(target === 'main') { w = 3360; h = 860; }
        else { w = 840; h = 840; }
        screens[target] = window.open('', target + 'TV', 'width=' + w + ',height=' + h + ',menubar=no,toolbar=no');
        if(!screens[target]) { alert("Please Allow Popups!"); return; }
        let fontCSS1 = customFontsData.font1 ? `url('${customFontsData.font1}') format('truetype')` : `local('Faruuma')`;
        let fontCSS2 = customFontsData.font2 ? `url('${customFontsData.font2}') format('truetype')` : `local('Amiri')`;
        let fontCSS3 = customFontsData.font3 ? `url('${customFontsData.font3}') format('truetype')` : `serif`;
        let cssGen = "";
        // (keep existing gradients and borderStyles)
        const html = `
        <!DOCTYPE html>
        <html lang="dv" dir="rtl">
        <head>
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thaana:wght@400;700&display=swap');
                @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');
                @font-face { font-family: 'Font1'; src: ${fontCSS1}; }
                @font-face { font-family: 'Font2'; src: ${fontCSS2}; }
                @font-face { font-family: 'Font3'; src: ${fontCSS3}; }
                :root { --theme-color: ${designStates[target].bdColor}; }
                body, h1, h2, div, span { font-family: 'Font1'; }
                /* (keep existing styles) */
                #banners { position: absolute; bottom: 0; width: 100%; display: flex; justify-content: center; gap: ${designStates[target].logosGap}px; z-index: 20; }
                #star { display: none; animation: rotate 2s linear infinite; position: absolute; }
                @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                #trophy { display: none; position: absolute; left: ${designStates[target].trophyX}px; top: ${designStates[target].trophyY}px; width: ${designStates[target].trophySize}px; z-index: 15; }
                .bottom-card { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.5); padding: 20px; display: flex; align-items: center; color: white; }
                .bottom-card img { height: 100px; border-radius: 50%; margin-right: 20px; }
                .bottom-card h2 { margin: 0; }
                .bottom-card p { margin: 0; }
            </style>
            <script>
                function goFS(btn){document.documentElement.requestFullscreen(); btn.style.display='none';}
                window.addEventListener('message', (m) => {
                    if(m.data.type === 'playVideo') {
                        const vl = document.getElementById('videoLayer');
                        vl.style.display = 'flex';
                        vl.innerHTML = \`<video id="awardVid" src="\${m.data.url}" autoplay></video>\`;
                        const v = document.getElementById('awardVid');
                        const card = document.createElement('div');
                        card.classList.add('bottom-card');
                        card.innerHTML = \`<img src="\${m.data.student.photo}" ><div><h2>\${m.data.student.nD}</h2><p>\${m.data.student.info}</p></div>\`;
                        vl.appendChild(card);
                        v.onended = () => {
                            vl.innerHTML = '';
                            opener.postMessage({type: 'videoEnded'});
                        };
                        v.play();
                    }
                });
            <\/script>
        </head>
        <body>
            <div id="activateOverlay" onclick="this.style.display='none'">
                <h1 style="font-size:50px;">CLICK HERE TO ACTIVATE SCREEN</h1>
                <p>This is required for Audio/Video to play automatically.</p>
            </div>
            <button id="fsBtn" onclick="goFS(this)">‚õ∂ FULL SCREEN</button>
            <div id="videoLayer"></div>
            <div id="bgLayer" class="${designStates[target].bgPreset}"></div>
            <div id="logoWrap"><img id="logoImg" class="logo-${designStates[target].lShape}" src="https://via.placeholder.com/180x180/00281c/d4af37?text=LOGO"></div>
            <div id="jalsaContent">
                <div id="titleContainer" style="margin-top:${designStates[target].mtY}px;">
                    <div id="mainTitleWrap"><div id="jt1" class="main-title jalsa-text"></div></div>
                    <div id="subTitleWrap">
                        <div id="jt2" class="sub-title jalsa-text"></div>
                        <div id="jt3" class="sub-title jalsa-text"></div>
                        <div id="jt4" class="sub-title jalsa-text"></div>
                    </div>
                </div>
            </div>
            <div id="card" class="${designStates[target].cBorder}">
                <div class="photo-col"><img id="stuImg" src=""></div>
                <div class="text-col">
                    <h1 id="tnD" class="font-dv"></h1><h2 id="tnE" class="font-en"></h2>
                    <div id="tfD" class="fac-dv font-dv"></div><div id="tfE" class="fac-en font-en"></div>
                    <div id="tcD" class="crs-dv font-dv"></div><div id="tcE" class="crs-en font-en"></div>
                    <div id="tcm" class="comm font-dv"></div>
                </div>
            </div>
            <div id="banners"></div>
            <img id="star" src="">
            <img id="trophy" src="">
            <div class="copyright">¬© Ali Ibrahim Didi (7791550)</div>
        </body>
        </html>`;
        screens[target].document.write(html);
        screens[target].document.close();
        sendStateToScreen(target);
        updateConnStatus(target, true);
    }
    function updateConnStatus(target, connected) {
        const statusId = 'connStatus' + target.charAt(0).toUpperCase() + target.slice(1);
        const status = document.getElementById(statusId);
        if(connected) {
            status.innerText = target.toUpperCase() + ": ‚úÖ ONLINE";
            status.style.color = "#00e676";
            status.style.background = "rgba(0,0,0,0.8)";
        } else {
            status.innerText = target.toUpperCase() + ": ﬁÜﬁ¶ﬁÇﬁ¨ﬁÜﬁ∞ﬁìﬁ∞ ﬁÇﬁ™ﬁàﬁ≠";
            status.style.color = "red";
            status.style.background = "#ffebee";
        }
    }
    function toggleScreen(target) {
        if(screens[target] && !screens[target].closed) {
            screens[target].close();
            updateConnStatus(target, false);
        } else {
            openScreen(target);
        }
    }
    function rescueMain() {
        toggleScreen('main');
        setTimeout(() => {
            openScreen('main');
        }, 500);
    }
    function shiftToMain(from) {
        designStates.main = { ...designStates[from] };
        sendStateToScreen('main');
    }
    function sendStateToScreen(target) {
        const win = screens[target];
        if(!win || win.closed) return;
        for (const key in designStates[target]) {
            liveUpdate(key, designStates[target][key]);
        }
        // Also send logos, etc.
        const banners = win.document.getElementById('banners');
        banners.innerHTML = designStates[target].logos.map(d => `<img src="${d}" style="height:${designStates[target].logosSize}px">`).join('');
        if(starData) win.document.getElementById('star').src = starData;
        if(trophyData) win.document.getElementById('trophy').src = trophyData;
        if(currentLogoData) win.document.getElementById('logoImg').src = currentLogoData;
        updateJalsaBackground(target);
        updateJalsaText(target);
    }
    function updateJalsaBackground(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed || !currentJalsaBgData) return;
        const bgDiv = win.document.getElementById('bgLayer');
        if(currentJalsaBgType === 'video') {
            bgDiv.innerHTML = `<video id="bgVid" src="${currentJalsaBgData}" autoplay loop muted style="width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:-1;"></video>`;
            setTimeout(() => { const v = win.document.getElementById('bgVid'); if(v) v.play().catch(e=>{}); }, 500);
        } else if (currentJalsaBgType === 'image') {
            bgDiv.innerHTML = `<img src="${currentJalsaBgData}" style="width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:-1;">`;
        }
    }
    function updateJalsaText(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) return;
        const doc = win.document;
        doc.getElementById('jt1').innerText = document.getElementById('jLine1').value;
        doc.getElementById('jt2').innerText = document.getElementById('jLine2').value;
        doc.getElementById('jt3').innerText = document.getElementById('jLine3').value;
        doc.getElementById('jt4').innerText = document.getElementById('jLine4').value;
        // Apply fonts
        doc.getElementById('jt1').style.fontFamily = customFonts[designStates[target].row1Font];
        doc.getElementById('jt2').style.fontFamily = customFonts[designStates[target].row2Font];
        doc.getElementById('jt3').style.fontFamily = customFonts[designStates[target].row3Font];
        doc.getElementById('jt4').style.fontFamily = customFonts[designStates[target].row1Font];
    }
    function showJalsaScreen(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) return;
        win.document.getElementById('card').classList.remove('active');
        win.document.getElementById('jalsaContent').classList.remove('hidden');
        const logo = win.document.getElementById('logoWrap');
        logo.style.display = (designStates[target].lVis === 'show') ? 'block' : 'none';
        document.getElementById('statusMsg').innerText = "MODE: Jalsa Titles on " + target;
        lastActiveState = 'title';
    }
    function updateTV(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) { alert(target + " Closed!"); return; }
        win.document.getElementById('jalsaContent').classList.add('hidden');
        
        const logo = win.document.getElementById('logoWrap');
        logo.style.display = (designStates[target].lVis === 'show') ? 'block' : 'none';
        const doc = win.document;
        doc.getElementById('tnD').textContent = document.getElementById('nD').value;
        doc.getElementById('tnE').textContent = document.getElementById('nE').value;
        doc.getElementById('tfD').textContent = document.getElementById('fD').value;
        doc.getElementById('tfE').textContent = document.getElementById('fE').value;
        doc.getElementById('tcD').textContent = document.getElementById('cD').value;
        doc.getElementById('tcE').textContent = document.getElementById('cE').value;
        
        const cmText = document.getElementById('cm').value;
        const commBox = doc.getElementById('tcm');
        if(!cmText || cmText.trim() === "") {
            commBox.textContent = "";
            commBox.classList.add('comm-tiny');
        } else {
            commBox.textContent = cmText;
            commBox.classList.remove('comm-tiny');
        }
        const img = doc.getElementById('stuImg');
        const pCol = doc.querySelector('.photo-col');
        
        if(currentPhotoData) {
            img.src = currentPhotoData;
            img.style.display='block';
            pCol.classList.remove('shrink-photo');
        } else {
            img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
            pCol.classList.add('shrink-photo');
        }
        // Apply fonts
        doc.getElementById('tnD').style.fontFamily = customFonts[designStates[target].row1Font];
        doc.getElementById('tfD').style.fontFamily = customFonts[designStates[target].row2Font];
        doc.getElementById('tcD').style.fontFamily = customFonts[designStates[target].row3Font];
        doc.getElementById('tcm').style.fontFamily = customFonts[designStates[target].row3Font];
        // Star and trophy
        const currentS = students[document.getElementById('stuList').value];
        const star = doc.getElementById('star');
        const trophy = doc.getElementById('trophy');
        if(currentS && currentS.rank === 1) {
            star.style.display = 'block';
            star.style.left = (doc.getElementById('tnD').offsetLeft - 50) + 'px';
            star.style.top = doc.getElementById('tnD').offsetTop + 'px';
        } else {
            star.style.display = 'none';
        }
        if(currentS && currentS.rank) {
            trophy.style.display = 'block';
        } else {
            trophy.style.display = 'none';
        }
        setTimeout(() => doc.getElementById('card').classList.add('active'), 300);
        stopVideo(target);
        document.getElementById('statusMsg').innerText = "LIVE: " + document.getElementById('nE').value + " on " + target;
        lastActiveState = 'card';
    }
    function clearTV(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) return;
        showJalsaScreen(target);
        stopVideo(target);
        document.getElementById('statusMsg').innerText = "CLEARED on " + target;
    }
    function playLocalVideo(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) { alert(target + " Closed!"); return; }
        win.document.getElementById('jalsaContent').classList.add('hidden');
        win.document.getElementById('card').classList.remove('active');
        const file = document.getElementById('videoLocal').files[0];
        if(!file) { alert("Select video!"); return; }
        const url = URL.createObjectURL(file);
        
        const vl = win.document.getElementById('videoLayer');
        vl.innerHTML = `<video id="mainVid" src="${url}" autoplay controls style="width:100%;height:100%;"></video>`;
        vl.style.display = 'flex';
        setTimeout(() => { const v = win.document.getElementById('mainVid'); if(v) v.play().catch(e => { alert("Click TV screen to enable audio."); }); }, 100);
        document.getElementById('statusMsg').innerText = "VIDEO PLAYING on " + target;
    }
    function playYoutube(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) { alert(target + " Closed!"); return; }
        win.document.getElementById('jalsaContent').classList.add('hidden');
        win.document.getElementById('card').classList.remove('active');
        const url = document.getElementById('ytLink').value;
        if(!url) return;
        
        let videoId = null;
        try {
            let splitUrl = url.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);
            if(splitUrl[2] !== undefined) {
                videoId = splitUrl[2].split(/[^0-9a-z_\-]/i)[0];
            } else {
                videoId = url;
            }
        } catch(e) { videoId = null; }
        
        if(!videoId || videoId.length < 10) { alert("Invalid YouTube Link!"); return; }
        const vl = win.document.getElementById('videoLayer');
        vl.innerHTML = `<iframe id="ytFrame" src="https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="width:100%;height:100%;"></iframe>`;
        vl.style.display = 'flex';
        document.getElementById('statusMsg').innerText = "YOUTUBE PLAYING on " + target;
    }
    
    function openYTPopup() {
        const url = document.getElementById('ytLink').value;
        if(url) window.open(url, '_blank', 'width=1280,height=720');
    }
    function stopVideo(target = currentTarget) {
        const win = screens[target];
        if(!win || win.closed) return;
        const vl = win.document.getElementById('videoLayer');
        vl.innerHTML = ''; vl.style.display = 'none';
        
        if(lastActiveState === 'title') {
            showJalsaScreen(target);
        } else if (lastActiveState === 'card') {
            win.document.getElementById('card').classList.add('active');
            win.document.getElementById('jalsaContent').classList.add('hidden');
        }
    }
    // --- FILE HANDLERS ---
    // (keep existing, add new)
    document.getElementById('videoFolder').onchange = e => {
        videoFiles = {};
        for(let f of e.target.files) {
            let name = f.name.toLowerCase();
            videoFiles[name] = f;
        }
        alert("Videos: " + e.target.files.length);
    };
    document.getElementById('logosFiles').onchange = e => {
        designStates[currentTarget].logos = [];
        Array.from(e.target.files).forEach(f => {
            const r = new FileReader();
            r.onload = evt => {
                designStates[currentTarget].logos.push(evt.target.result);
                liveUpdate('logos', designStates[currentTarget].logos);
            };
            r.readAsDataURL(f);
        });
    };
    document.getElementById('starFile').onchange = e => {
        const r = new FileReader();
        r.onload = evt => {
            starData = evt.target.result;
            Object.keys(screens).forEach(t => {
                if(screens[t] && !screens[t].closed) screens[t].document.getElementById('star').src = starData;
            });
        };
        r.readAsDataURL(e.target.files[0]);
    };
    document.getElementById('trophyFile').onchange = e => {
        const r = new FileReader();
        r.onload = evt => {
            trophyData = evt.target.result;
            Object.keys(screens).forEach(t => {
                if(screens[t] && !screens[t].closed) screens[t].document.getElementById('trophy').src = trophyData;
            });
        };
        r.readAsDataURL(e.target.files[0]);
    };
    document.getElementById('fontFile1').onchange = e => loadFont('font1', e.target.files[0]);
    document.getElementById('fontFile2').onchange = e => loadFont('font2', e.target.files[0]);
    document.getElementById('fontFile3').onchange = e => loadFont('font3', e.target.files[0]);
    function loadFont(name, file) {
        if(!file) return;
        const r = new FileReader();
        r.onload = evt => {
            customFontsData[name] = evt.target.result;
            customFonts[name] = name.toUpperCase();
            const fontFace = new FontFace(customFonts[name], `url(${customFontsData[name]})`);
            fontFace.load().then(f => {
                document.fonts.add(f);
                // Apply to all open screens
                Object.keys(screens).forEach(t => {
                    if(screens[t] && !screens[t].closed) {
                        const style = screens[t].document.createElement('style');
                        style.innerHTML = `@font-face { font-family: '${customFonts[name]}'; src: url('${customFontsData[name]}') format('truetype'); }`;
                        screens[t].document.head.appendChild(style);
                    }
                });
            });
        };
        r.readAsDataURL(file);
    }
    document.getElementById('csvFile').onchange = e => {
        const r = new FileReader();
        r.onload = ev => {
            let txt = ev.target.result; if(txt.charCodeAt(0)===0xFEFF) txt=txt.substr(1);
            let lines = txt.split('\n');
            students = [];
            categories = new Set();
            lines.forEach(l => {
                let c = l.split(',');
                if(c.length>1) {
                    let s = {
                        nD: c[0]?.trim(), nE: c[1]?.trim(), cD: c[2]?.trim(), cE: c[3]?.trim(),
                        fD: c[4]?.trim(), fE: c[5]?.trim(), cm: c[6]?.trim(), ph: c[7]?.trim(),
                        rank: parseInt(c[8]) || 999,
                        category: c[2]?.trim() // assume cD is category
                    };
                    students.push(s);
                    categories.add(s.category);
                }
            });
            const catSel = document.getElementById('categorySel');
            catSel.innerHTML = '';
            categories.forEach(cat => {
                let o = document.createElement('option');
                o.value = cat;
                o.text = cat;
                catSel.add(o);
            });
            filterList(); alert("Loaded: " + students.length);
        }; r.readAsText(e.target.files[0]);
    };
    // (keep other file handlers)
    async function playTopVideos() {
        let cat = document.getElementById('categorySel').value;
        let n = parseInt(document.getElementById('topN').value);
        let target = document.getElementById('awardTarget').value;
        let win = screens[target];
        if(!win || win.closed) { alert("Screen not open!"); return; }
        let top = students.filter(s => s.category === cat).sort((a,b) => a.rank - b.rank).slice(0, n);
        for (let s of top) {
            // Load student
            document.getElementById('nD').value = s.nD;
            document.getElementById('nE').value = s.nE;
            document.getElementById('fD').value = s.fD;
            document.getElementById('fE').value = s.fE;
            document.getElementById('cD').value = s.cD;
            document.getElementById('cE').value = s.cE;
            document.getElementById('cm').value = s.cm;
            let photoName = s.ph ? s.ph.trim().toLowerCase() : "";
            let photoFile = photoFiles[photoName];
            if(photoFile) {
                const reader = new FileReader();
                currentPhotoData = await new Promise(resolve => {
                    reader.onload = e => resolve(e.target.result);
                    reader.readAsDataURL(photoFile);
                });
            } else {
                currentPhotoData = null;
            }
            updateTV(target);
            let videoName = s.ph ? s.ph.trim().toLowerCase() + '.mp4' : "";
            let videoFile = videoFiles[videoName];
            if(videoFile) {
                const url = URL.createObjectURL(videoFile);
                win.postMessage({
                    type: 'playVideo',
                    url: url,
                    student: {
                        nD: s.nD,
                        photo: currentPhotoData,
                        info: s.cm
                    }
                }, '*');
                await new Promise(resolve => {
                    const listener = (m) => {
                        if(m.data.type === 'videoEnded') {
                            window.removeEventListener('message', listener);
                            resolve();
                        }
                    };
                    window.addEventListener('message', listener);
                });
            } else {
                await new Promise(r => setTimeout(r, 5000));
            }
        }
    }
    // (keep other functions, adapting to currentTarget and screens)
</script>
</body>
</html>
```
