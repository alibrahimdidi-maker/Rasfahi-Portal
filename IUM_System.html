<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Royal Graduation System (IUM Edition)</title>
    <style>
        body { -webkit-user-select: none; user-select: none; margin: 0; padding: 0; background: #001a12; font-family: 'Faruuma', 'Times New Roman', serif; overflow: hidden; height: 100vh; width: 100vw; }
        @font-face { font-family: 'Faruuma'; src: local('Faruuma'), local('Faruumaa'), url('Fonts/faruuma.ttf') format('truetype'); }
        .watermark { position: fixed; bottom: 5px; right: 10px; font-size: 10px; color: rgba(255, 255, 255, 0.15); z-index: 9999; pointer-events: none; font-family: sans-serif; font-weight: bold; }
        #securityOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #d4af37; }
        .sec-box { background: rgba(20, 20, 20, 0.95); padding: 50px; border-radius: 15px; border: 2px solid #d4af37; text-align: center; box-shadow: 0 0 50px rgba(212,175,55,0.2); }
        .sec-input { padding: 15px; font-size: 16px; border-radius: 5px; border: 1px solid #d4af37; text-align: center; width: 350px; margin-top: 20px; font-family: sans-serif; background: #333; color: #fff; }
        .sec-btn { margin-top: 20px; padding: 12px 40px; font-size: 18px; cursor: pointer; background: #d4af37; border: none; border-radius: 5px; font-weight: bold; color: #00281c; }
        .sec-note { font-size: 12px; color: #aaa; margin-top: 10px; font-family: sans-serif; }
        .main-layout { display: none; gap: 8px; height: 100vh; width: 100vw; padding: 8px; box-sizing: border-box; background: #00281c; }
        .sidebar { flex: 0 0 300px; background: #f1f8e9; padding: 10px; border-radius: 8px; display: flex; flex-direction: column; height: 100%; overflow: hidden; border-right: 4px solid #d4af37; }
        .editor { flex: 1; background: #ffffff; padding: 10px; border-radius: 8px; display: flex; flex-direction: column; height: 100%; overflow-y: auto; position: relative; border-left: 4px solid #d4af37; }
        .locked-zone { pointer-events: none; opacity: 0.4; filter: grayscale(1); position: relative; }
        .design-panel { background: #fff8e1; border: 1px solid #ffb300; border-radius: 5px; padding: 8px; margin-bottom: 8px; transition: opacity 0.3s; }
        .design-row { display: flex; gap: 10px; margin-bottom: 5px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .design-col { flex: 1; }
        .d-label { font-size: 11px; font-weight: bold; color: #e65100; display: block; margin-bottom: 2px; }
        input[type=range] { width: 100%; cursor: pointer; height: 10px; }
        input[type=color] { width: 30px; height: 20px; border: none; padding: 0; cursor: pointer; vertical-align: middle; }
        h2, h3 { margin: 5px 0; color: #004d40; font-family: 'Faruuma'; }
        label { display: block; font-weight: bold; font-size: 11px; margin-bottom: 1px; color: #333; }
        input[type="text"], textarea, select { width: 98%; padding: 3px; border: 1px solid #aaa; border-radius: 3px; font-size: 12px; margin-bottom: 2px; font-family: 'Faruuma', 'Times New Roman'; }
        .file-box { background: #e0e0e0; padding: 5px; border-radius: 5px; margin-bottom: 5px; border: 1px solid #bbb; overflow-y: auto; max-height: 100px; flex-shrink: 0; }
        input[type="file"] { width: 100%; font-size: 10px; margin-bottom: 2px; }
        .row { display: flex; gap: 5px; margin-bottom: 2px; align-items: flex-end; }
        .col { flex: 1; }
        .dhi { direction: rtl; text-align: right; }
        .eng { direction: ltr; text-align: left; font-family: 'Times New Roman', serif; font-weight: bold; }
        button { cursor: pointer; font-family: 'Faruuma'; font-weight: bold; }
        .fs-btn { background: #004d40; color: white; padding: 5px; width: 100%; border: 1px solid #d4af37; border-radius: 4px; margin-bottom: 5px; font-size: 11px; flex-shrink: 0; }
        .launch-btn { background: #c62828; color: white; padding: 8px; width: 100%; border: none; border-radius: 4px; margin-bottom: 5px; font-size: 14px; flex-shrink: 0; }
        .launch-btn-sub { background: #1565c0; margin-bottom: 2px; }
        .config-btn-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .conf-btn { flex: 1; padding: 5px; font-size: 11px; border-radius: 4px; border: 1px solid #aaa; color: white; }
        .btn-down { background: #1565c0; }
        .btn-up { background: #ef6c00; }
        .btn-lock { background: #37474f; width: 100%; padding: 8px; margin-bottom: 8px; color: #fff; border: 2px solid #cfd8dc; font-size: 13px; }
        .btn-lock.active { background: #2e7d32; border-color: #4caf50; font-weight: bold; box-shadow: inset 0 0 10px #1b5e20; }
        #stuList { flex-grow: 1; min-height: 0; margin-bottom: 5px; }
        .btn-vid { font-size: 12px; padding: 4px; margin-top: 2px; border:none; border-radius:3px; color:white; width: 100%; }
        .controls { display: flex; gap: 5px; margin-top: 5px; flex-shrink: 0; }
        button.action { flex: 1; padding: 8px; font-size: 14px; border: none; border-radius: 4px; color: white; transition: 0.2s; }
        .btn-live { background: #004d40; flex: 2; border: 2px solid #ffd700; color: #ffd700; }
        .btn-nav { background: #455a64; }
        .btn-clear { background: #b71c1c; flex: 0.5; }
        .preview-container { display: flex; gap: 10px; align-items: center; justify-content: center; background: #fff8e1; padding: 4px; border: 1px solid #ffb300; border-radius: 4px; margin-top: 5px; flex-shrink: 0; }
        #previewImg { height: 50px; width: 50px; object-fit: cover; border-radius: 50%; border: 2px solid #d4af37; background: #ddd; }
        #logoPreview { height: 30px; object-fit: contain; }
        .video-panel { background: #e3f2fd; padding: 5px; border-radius: 5px; margin-top: 5px; flex-shrink: 0; }
        #statusMsg { text-align: center; margin-top: 5px; font-weight: bold; color: green; font-size: 12px; background: #e8f5e9; padding: 2px; border-radius: 4px; flex-shrink: 0; }
        .copyright-text { text-align: center; font-size: 10px; color: #d4af37; background: #00281c; margin-top: auto; padding: 5px; border-radius: 4px; flex-shrink: 0; font-family: sans-serif; font-weight: bold; }
    </style>
</head>
<body oncontextmenu="return false;">
    <div class="watermark">AIDD(7791550)</div>
    <div id="securityOverlay">
        <div class="sec-box">
            <h1 style="color:#d4af37; font-family:'Faruuma'; font-size:30px;">Royal Graduation V10.3</h1>
            <p style="color:#fff; font-size:14px; margin-bottom:20px;">üîí Protected Software. Enter License Key:</p>
            <input type="password" id="licenseKey" class="sec-input" placeholder="Paste Generated Key">
            <button class="sec-btn" onclick="verifyLicense()">UNLOCK</button>
            <p class="sec-note">Verification: Offline Secure</p>
            <p id="secMsg" style="color:#ff5252; font-size:13px; margin-top:15px; font-weight:bold;"></p>
        </div>
    </div>
    <div class="main-layout" id="mainApp">
        <div class="sidebar">
            <button class="fs-btn" onclick="toggleControlFS()">‚õ∂ Fullscreen</button>
            <div id="licenseStatus" style="font-size:10px; color:green; text-align:center; margin-bottom:5px;"></div>
            <div class="config-btn-row">
                <button class="conf-btn btn-down" onclick="downloadConfig()">‚¨á Save Config</button>
                <button class="conf-btn btn-up" onclick="document.getElementById('confInput').click()">‚¨Ü Load Config</button>
                <input type="file" id="confInput" accept=".json" style="display:none" onchange="loadConfig(this)">
            </div>
            <button class="launch-btn" onclick="openTV()">üñ•Ô∏è 1. Open TV</button>
            <div id="connStatus" style="font-size:11px; color:red; text-align:center;">Not Connected</div>
            <div class="file-box" id="sidebarFiles">
                <label>1. CSV List:</label><input type="file" id="csvFile" accept=".csv">
                <label>2. Photos:</label><input type="file" id="photoFolder" webkitdirectory directory multiple>
                <label>3. Logo:</label><input type="file" id="logoFile" accept="image/*">
                <label>4. Font:</label><input type="file" id="fontFile" accept=".ttf, .otf">
                <label>5. Titles:</label><input type="file" id="jalsaCsvFile" accept=".csv">
                <label style="color:#e65100;">6. Custom Frame:</label><input type="file" id="customBorderFile" accept="image/*">
            </div>
            <label>Search:</label>
            <input type="text" id="search" placeholder="..." onkeyup="filterList()">
            <select id="stuList" size="2" style="flex-grow:1;" onchange="loadStudent()"></select>
            <div class="copyright-text">&copy; Ali Ibrahim Didi (7791550)</div>
        </div>
        <div class="editor" id="editorPanel">
            <button id="lockBtn" class="btn-lock" onclick="toggleLock()">üîì Lock Settings (For Live)</button>
            <div class="design-panel" id="designPanel">
                <h3 style="margin-top:0; border:none; font-size:14px;">üé® Live Design Controls (V10.3)</h3>
                <div class="design-row">
                    <div class="design-col">
                        <span class="d-label">Main Title (Position & Align):</span>
                        <div style="display:flex; gap:2px;">
                            <input type="range" id="mtSizeRange" min="2" max="10" step="0.1" value="5.6" oninput="liveUpdate('mtSize', this.value)" title="Size">
                            <input type="color" id="mtColorPick" value="#d4af37" oninput="liveUpdate('mtColor', this.value)" title="Color">
                        </div>
                        <div style="display:flex; gap:2px; margin-top:2px;">
                            <select id="mtAlignSel" onchange="liveUpdate('mtAlign', this.value)" style="width:50%; background:#c8e6c9;">
                                <option value="center">Center</option><option value="right">Right</option><option value="left">Left</option>
                            </select>
                            <select id="tLineSel" onchange="liveUpdate('tLine', this.value)" style="width:50%; background:#c8e6c9;">
                                <option value="show">Line: ON</option><option value="hide">Line: OFF</option>
                            </select>
                        </div>
                        <div style="display:flex; gap:2px; margin-top:2px;">
                            <input type="range" id="mtYRange" min="0" max="500" value="210" oninput="liveUpdate('mtY', this.value)" title="Y Pos">
                            <input type="range" id="mtXRange" min="-600" max="600" value="0" oninput="liveUpdate('mtX', this.value)" title="X Pos">
                        </div>
                    </div>
                    <div class="design-col">
                        <span class="d-label">Sub Titles:</span>
                        <div style="display:flex; gap:2px;">
                            <input type="range" id="stSizeRange" min="1" max="6" step="0.1" value="2.6" oninput="liveUpdate('stSize', this.value)" title="Sub Size">
                            <input type="color" id="stColorPick" value="#ffffff" oninput="liveUpdate('stColor', this.value)" title="Sub Color">
                        </div>
                        <div style="display:flex; gap:2px; margin-top:2px;">
                            <select id="stAlignSel" onchange="liveUpdate('stAlign', this.value)" style="width:100%; background:#b3e5fc;">
                                <option value="center">Align: Center</option><option value="right">Align: Right</option><option value="left">Align: Left</option>
                            </select>
                        </div>
                        <div style="display:flex; gap:2px; margin-top:2px;">
                            <input type="range" id="stYRange" min="0" max="100" value="0" title="Sub Y" oninput="liveUpdate('stY', this.value)">
                        </div>
                    </div>
                </div>
                <div class="design-row">
                    <div class="design-col">
                        <span class="d-label">50 Wall Themes:</span>
                        <select id="bgPresetSel" onchange="liveUpdate('bgPreset', this.value)" style="width:100%; background:#e1bee7;">
                             <script> for(let i=1; i<=50; i++) document.write(`<option value="bg${i}">Theme ${i} (Royal)</option>`); </script>
                        </select>
                        <span class="d-label" style="margin-top:3px;">50 Card Designs:</span>
                        <select id="cBorderSel" onchange="liveUpdate('cBorder', this.value)" style="width:100%; background:#fff9c4;">
                            <option value="custom">üñºÔ∏è Custom Image</option>
                            <script> for(let i=1; i<=50; i++) document.write(`<option value="b${i}">Card Theme ${i}</option>`); </script>
                            <option value="b0">üö´ No Border</option>
                        </select>
                         <div style="display:flex; gap:2px; margin-top:2px;">
                            <span style="font-size:10px;">Thm:</span><input type="color" id="bdColorPick" value="#d4af37" oninput="liveUpdate('bdColor', this.value)" title="Border/Theme Color">
                        </div>
                    </div>
                </div>
                <div class="design-row" style="background:#e0f7fa; padding:5px; border-radius:5px;">
                    <div class="design-col">
                        <span class="d-label" style="color:#006064;">üìù Individual Text Control:</span>
                        <div style="display:flex; gap:2px; margin-top:2px; align-items:center;"><span style="font-size:9px; width:40px;">Name Dv:</span><input type="range" min="1" max="8" step="0.1" value="5" oninput="liveUpdate('tnDSize', this.value)" style="flex:1;"><input type="color" value="#ffffff" oninput="liveUpdate('tnDColor', this.value)"></div>
                        <div style="display:flex; gap:2px; margin-top:2px; align-items:center;"><span style="font-size:9px; width:40px;">Name En:</span><input type="range" min="1" max="6" step="0.1" value="3" oninput="liveUpdate('tnESize', this.value)" style="flex:1;"><input type="color" value="#ffffff" oninput="liveUpdate('tnEColor', this.value)"></div>
                        <div style="display:flex; gap:2px; margin-top:2px; align-items:center;"><span style="font-size:9px; width:40px;">Det 1:</span><input type="range" min="1" max="5" step="0.1" value="2" oninput="liveUpdate('tfDSize', this.value)" style="flex:1;"><input type="color" value="#fff9c4" oninput="liveUpdate('tfDColor', this.value)"></div>
                        <div style="display:flex; gap:2px; margin-top:2px; align-items:center;"><span style="font-size:9px; width:40px;">Det 2:</span><input type="range" min="1" max="5" step="0.1" value="2.5" oninput="liveUpdate('tcDSize', this.value)" style="flex:1;"><input type="color" value="#fff9c4" oninput="liveUpdate('tcDColor', this.value)"></div>
                    </div>
                </div>
                <div class="design-row">
                    <div class="design-col">
                        <span class="d-label">Card & Text Align:</span>
                        <select id="layoutDirSel" onchange="liveUpdate('layoutDir', this.value)" style="width:100%; background:#bbdefb; padding:5px;"><option value="rtl">‚ñ∂ Right to Left (Photo Right)</option><option value="ltr">‚óÄ Left to Right (Photo Left)</option></select>
                        <select id="textAlignSel" onchange="liveUpdate('textAlign', this.value)" style="width:100%; background:#bbdefb; margin-top:2px;"><option value="right">Text: Right</option><option value="center">Text: Center</option><option value="left">Text: Left</option></select>
                        <select id="nLineSel" onchange="liveUpdate('nLine', this.value)" style="width:100%; background:#ffccbc; margin-top:2px;"><option value="show">Name Line: SHOW</option><option value="hide">Name Line: HIDE</option></select>
                    </div>
                </div>
                <div class="design-row">
                    <div class="design-col">
                        <span class="d-label">Logo Control (Move Anywhere):</span>
                        <div style="display:flex; gap:2px;">
                            <select id="lShapeSel" onchange="liveUpdate('lShape', this.value)" style="width:50%;"><option value="square">Square</option><option value="rounded">Rounded</option><option value="circle">Circle</option><option value="egg">Oval/Egg</option></select>
                            <select id="lVisSel" onchange="liveUpdate('lVis', this.value)" style="width:50%; background:#ffe0b2;"><option value="show">Show</option><option value="hide">Hide</option></select>
                        </div>
                        <div style="display:flex; gap:2px; margin-top:2px;"><span style="font-size:9px;">X Pos:</span><input type="range" id="logoXRange" min="-1200" max="1200" value="0" oninput="liveUpdate('logoX', this.value)"></div>
                        <div style="display:flex; gap:2px; margin-top:2px;"><span style="font-size:9px;">Y Pos:</span><input type="range" id="logoYRange" min="0" max="900" value="40" oninput="liveUpdate('logoY', this.value)"></div>
                        <div style="display:flex; gap:2px; margin-top:2px;"><span style="font-size:9px;">Size:</span><input type="range" id="lSizeRange" min="50" max="500" value="145" oninput="liveUpdate('lSize', this.value)"></div>
                    </div>
                </div>
                <div class="design-row" style="margin-bottom:0; border:none;">
                    <div class="design-col">
                        <span class="d-label">Photo (Move & Resize):</span>
                        <div style="display:flex; gap:2px;">
                            <select id="pShapeSel" onchange="liveUpdate('pShape', this.value)" style="width:50%;"><option value="50%">Circle</option><option value="15px">Square</option><option value="portrait">Full Body (Side)</option></select>
                            <select id="pVisSel" onchange="liveUpdate('pVis', this.value)" style="width:50%; background:#ffe0b2;"><option value="show">Show</option><option value="hide">Hide</option></select>
                        </div>
                    </div>
                    <div class="design-col">
                        <span class="d-label">Size/Pos:</span>
                        <input type="range" id="pSizeRange" min="150" max="800" value="260" title="Size" oninput="liveUpdate('pSize', this.value)">
                        <div style="display:flex; gap:2px; margin-top:2px;">
                            <input type="range" id="pYRange" min="-400" max="400" value="0" title="Y" oninput="liveUpdate('pY', this.value)">
                            <input type="range" id="pXRange" min="-600" max="600" value="0" title="X" oninput="liveUpdate('pX', this.value)">
                        </div>
                    </div>
                </div>
            </div>
            <div id="globalTitles">
                <div style="display:flex; gap:5px; margin-bottom:5px;">
                    <input type="file" id="jalsaBgFile" accept="video/*, image/*" style="width:33%">
                    <select id="bgLoopSel" onchange="liveUpdate('bgLoop', this.value)" style="width:33%; background:#c8e6c9;"><option value="on">Loop: ON</option><option value="off">Loop: OFF</option></select>
                    <button class="btn-vid" style="background:#1b5e20; width:33%; margin:0;" onclick="showJalsaScreen()">üñºÔ∏è Title Screen</button>
                </div>
                <div style="display:flex; gap:5px; margin-bottom:2px;"><button class="btn-vid" style="background:#2e7d32; width:100%; margin:0;" onclick="updateJalsaText()">Update Titles</button></div>
                <input type="text" id="jLine1" placeholder="Main Title" class="font-dv" style="font-weight:bold; color:#00281c;">
                <input type="text" id="jLine2" placeholder="Sub 1" class="font-dv">
                <input type="text" id="jLine3" placeholder="Sub 2" class="font-dv">
                <input type="text" id="jLine4" placeholder="Sub 3" class="font-dv">
            </div>
            <hr style="margin:5px 0; border:1px solid #ddd;">
            <h3 style="margin-top:5px;">üéì Student Info</h3>
            <div class="row"><div class="col"><input id="nD" class="font-dv" placeholder="Name Dv"></div><div class="col"><input id="nE" class="eng" placeholder="Name En"></div></div>
            <div class="row"><div class="col"><input id="fD" class="font-dv" placeholder="Detail 1 Dv"></div><div class="col"><input id="fE" class="eng" placeholder="Detail 1 En"></div></div>
            <div class="row"><div class="col"><input id="cD" class="font-dv" placeholder="Detail 2 Dv"></div><div class="col"><input id="cE" class="eng" placeholder="Detail 2 En"></div></div>
            <textarea id="cm" rows="1" class="font-dv" placeholder="Comment" style="text-align:center;"></textarea>
            <div class="preview-container">
                <div><img id="logoPreview" alt="-"></div>
                <div style="text-align:center;"><span id="pStat" style="font-size:10px;">No Photo</span><img id="previewImg" src="https://via.placeholder.com/150"><button class="manual-btn" onclick="document.getElementById('singlePhoto').click()">üì∑</button><input type="file" id="singlePhoto" accept="image/*" style="display:none" onchange="manualPhoto(this)"></div>
            </div>
            <div class="controls">
                <button class="action btn-nav" onclick="move(-1)">‚óÄ</button><button class="action btn-live" onclick="updateTV()">üì∫ LIVE</button><button class="action btn-nav" onclick="move(1)">‚ñ∂</button><button class="action btn-clear" onclick="clearTV()">X</button>
            </div>
            <div class="video-panel">
                <div style="display:flex; gap:5px;"><input type="file" id="videoLocal" accept="video/*" style="width:70%"><button class="btn-vid" style="background:#e65100; width:30%;" onclick="playLocalVideo()">‚ñ∂ Local</button></div>
                <div style="display:flex; gap:5px; margin-top:2px;"><input type="text" id="ytLink" placeholder="YouTube Link..." style="width:70%; text-align:left;" class="font-en"><button class="btn-vid" style="background:#c62828; width:30%;" onclick="playYoutube()">‚ñ∂ YT</button></div>
                <button class="btn-vid" style="background:#333; margin-top:2px;" onclick="stopVideo()">‚èπ STOP VIDEO</button>
            </div>
            <div id="statusMsg">Ready</div>
        </div>
    </div>
<script>
window.ACCESS_DB={"ROYAL_ADMIN":"2030-12-31","IUM_ALI1550779":"2026-12-31"};document.addEventListener("contextmenu",function(e){e.preventDefault()});document.onkeydown=function(e){if(e.keyCode==123)return!1;if(e.ctrlKey&&e.shiftKey&&(e.keyCode=='I'.charCodeAt(0)||e.keyCode=='C'.charCodeAt(0)||e.keyCode=='J'.charCodeAt(0)))return!1;if(e.ctrlKey&&e.keyCode=='U'.charCodeAt(0))return!1};window.verifyLicense=function(){var e=document.getElementById("licenseKey").value.trim(),t=document.getElementById("secMsg"),n=document.querySelector(".sec-btn");if(!e){t.innerText="Please enter a key.";return}n.innerText="CHECKING DATE...",setTimeout(function(){if(window.ACCESS_DB.hasOwnProperty(e)){var a=new Date(window.ACCESS_DB[e]);new Date>a?(t.innerText="‚ö†Ô∏è EXPIRED: This key ended on "+window.ACCESS_DB[e],t.style.color="orange",n.innerText="RENEW KEY"):(document.getElementById("securityOverlay").style.display="none",document.getElementById("mainApp").style.display="flex",document.getElementById("licenseStatus").innerText="‚úÖ Unlocked (Valid until: "+window.ACCESS_DB[e]+")")}else t.innerText="‚ùå WRONG KEY",t.style.color="#ff5252",n.innerText="UNLOCK";document.getElementById("licenseKey").value=""},800)};document.getElementById("licenseKey").addEventListener("keyup",function(e){"Enter"===e.key&&window.verifyLicense()});window.toggleControlFS=function(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(function(e){console.log(e)})};var tvWindow=null,students=[],photoFiles={},currentPhotoData=null,currentLogoData=null,currentFontData=null,currentJalsaBgData=null,currentJalsaBgType="none",customBorderData=null,isLocked=!1,designState={mtY:210,mtX:0,mtSize:5.6,mtColor:"#d4af37",tLine:"show",mtAlign:"center",stY:0,stX:0,stSize:2.6,stColor:"#ffffff",stAlign:"center",logoY:40,logoX:0,lVis:"show",lShape:"square",lSize:145,pShape:"50%",pSize:260,pBorder:"on",pX:0,pY:0,pVis:"show",cBorder:"b1",bdColor:"#d4af37",bgPreset:"bg1",layoutDir:"rtl",textAlign:"right",bgLoop:"on",txtX:0,txtY:0,nLine:"show",nameColor:"#ffffff",detColor:"#fff9c4",commColor:"#ffffff",tnDSize:5,tnDColor:"#ffffff",tnESize:3,tnEColor:"#ffffff",tfDSize:2,tfDColor:"#fff9c4",tcDSize:2.5,tcDColor:"#fff9c4"};window.toggleLock=function(){isLocked=!isLocked;var e=document.getElementById("lockBtn"),t=[document.getElementById("designPanel"),document.getElementById("sidebarFiles"),document.getElementById("globalTitles")];isLocked?(e.innerHTML="üîí LIVE SAFE MODE ON",e.classList.add("active"),t.forEach(function(e){e.classList.add("locked-zone")})):(e.innerHTML="üîì Lock Settings",e.classList.remove("active"),t.forEach(function(e){e.classList.remove("locked-zone")}))};window.downloadConfig=function(){var e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(designState)),t=document.createElement("a");t.href=e,t.download="royal_config_v10.json",document.body.appendChild(t),t.click(),t.remove()};window.loadConfig=function(e){var t=e.files[0];if(t){var n=new FileReader;n.onload=function(e){try{designState=JSON.parse(e.target.result),setVal("mtSizeRange",designState.mtSize),setVal("mtColorPick",designState.mtColor),setVal("mtYRange",designState.mtY),setVal("mtXRange",designState.mtX||0),setVal("mtAlignSel",designState.mtAlign),setVal("stSizeRange",designState.stSize),setVal("stColorPick",designState.stColor),setVal("stYRange",designState.stY),setVal("stAlignSel",designState.stAlign),setVal("tLineSel",designState.tLine),setVal("layoutDirSel",designState.layoutDir),setVal("textAlignSel",designState.textAlign),setVal("lVisSel",designState.lVis),setVal("lShapeSel",designState.lShape),setVal("lSizeRange",designState.lSize),setVal("logoYRange",designState.logoY),setVal("logoXRange",designState.logoX),setVal("bgPresetSel",designState.bgPreset),setVal("cBorderSel",designState.cBorder),setVal("bdColorPick",designState.bdColor),setVal("pShapeSel",designState.pShape),setVal("pBorderSel",designState.pBorder),setVal("pVisSel",designState.pVis),setVal("pSizeRange",designState.pSize),setVal("pYRange",designState.pY),setVal("pXRange",designState.pX),setVal("bgLoopSel",designState.bgLoop),setVal("nameColorPick",designState.nameColor),setVal("detColorPick",designState.detColor),setVal("commColorPick",designState.commColor),setVal("nLineSel",designState.nLine),tvWindow&&!tvWindow.closed&&Object.keys(designState).forEach(function(e){window.liveUpdate(e,designState[e])}),alert("Settings Loaded Successfully!")}catch(e){alert("Invalid Config File")}},n.readAsText(t)}};window.setVal=function(e,t){var n=document.getElementById(e);n&&(n.value=t)};window.liveUpdate=function(e,t){if(!isLocked&&(designState[e]=t,tvWindow&&!tvWindow.closed)){var n=tvWindow.document;if("pVis"===e){var a=n.querySelector(".photo-col");a&&("show"===t?(a.style.visibility="visible",a.style.opacity="1"):(a.style.visibility="hidden",a.style.opacity="0"))}"lVis"===e&&(n.getElementById("logoWrap").style.display="show"===t?"block":"none"),("logoX"===e||"logoY"===e)&&n.getElementById("logoWrap").style.transform="translate(calc(-50% + "+designState.logoX+"px), "+designState.logoY+"px)","lSize"===e&&(n.getElementById("logoImg").style.height=t+"px"),"lShape"===e&&(n.getElementById("logoImg").className="logo-"+t),"bgLoop"===e&&(n.getElementById("bgVid").style.display="on"===t?"block":"none"),"layoutDir"===e&&(n.getElementById("card").style.flexDirection="rtl"===t?"row-reverse":"row"),"textAlign"===e&&(n.querySelector(".text-col").style.textAlign=t),"bgPreset"===e&&(n.getElementById("bgLayer").className=t),"bdColor"===e&&n.documentElement.style.setProperty("--theme-color",t),("mtY"===e||"mtX"===e)&&(n.getElementById("titleContainer").style.transform="translate("+designState.mtX+"px, "+designState.mtY+"px)"),"mtSize"===e&&(n.getElementById("jt1").style.fontSize=t+"em"),"mtColor"===e&&(n.getElementById("jt1").style.color=t,"show"===designState.tLine&&(n.getElementById("jt1").style.borderBottomColor=t)),"tLine"===e&&(n.getElementById("jt1").style.borderBottom="show"===t?"3px solid "+designState.mtColor:"none"),"mtAlign"===e&&(n.getElementById("mainTitleWrap").style.textAlign=t,n.getElementById("jt1").style.textAlign=t),"stY"===e&&(n.getElementById("subTitleWrap").style.marginTop=t+"px"),"stSize"===e&&n.querySelectorAll(".sub-title").forEach(function(e){e.style.fontSize=t+"em"}),"stColor"===e&&n.querySelectorAll(".sub-title").forEach(function(e){e.style.color=t}),"stAlign"===e&&(n.getElementById("subTitleWrap").style.textAlign=t),"nameColor"===e&&(n.getElementById("tnD").style.color=t,n.getElementById("tnE").style.color=t),"detColor"===e&&n.querySelectorAll(".fac-dv, .fac-en, .crs-dv, .crs-en").forEach(function(e){e.style.color=t}),"commColor"===e&&(n.getElementById("tcm").style.color=t),"nLine"===e&&(n.getElementById("tnE").style.borderBottom="show"===t?"2px solid "+designState.bdColor:"none"),"tnDSize"===e&&(n.getElementById("tnD").style.fontSize=t+"em"),"tnDColor"===e&&(n.getElementById("tnD").style.color=t),"tnESize"===e&&(n.getElementById("tnE").style.fontSize=t+"em"),"tnEColor"===e&&(n.getElementById("tnE").style.color=t),"tfDSize"===e&&(n.getElementById("tfD").style.fontSize=t+"em",n.getElementById("tfE").style.fontSize=.8*t+"em"),"tfDColor"===e&&(n.getElementById("tfD").style.color=t,n.getElementById("tfE").style.color=t),"tcDSize"===e&&(n.getElementById("tcD").style.fontSize=t+"em",n.getElementById("tcE").style.fontSize=.8*t+"em"),"tcDColor"===e&&(n.getElementById("tcD").style.color=t,n.getElementById("tcE").style.color=t),"pShape"===e&&(n.getElementById("stuImg").style.borderRadius="portrait"===t?"10px":t,"portrait"===t?n.getElementById("stuImg").classList.add("portrait-mode"):n.getElementById("stuImg").classList.remove("portrait-mode")),"pSize"===e&&("portrait"!==designState.pShape?(n.getElementById("stuImg").style.width=t+"px",n.getElementById("stuImg").style.height=t+"px"):(n.getElementById("stuImg").style.height=1.5*t+"px",n.getElementById("stuImg").style.width="auto")),("pX"===e||"pY"===e)&&(n.querySelector(".photo-col").style.transform="translate("+designState.pX+"px, "+designState.pY+"px)"),"pBorder"===e&&("off"===t?(n.getElementById("stuImg").style.border="none",n.getElementById("stuImg").style.boxShadow="none"):(n.getElementById("stuImg").style.border="5px solid "+designState.bdColor,n.getElementById("stuImg").style.boxShadow="0 15px 40px rgba(0,0,0,0.8)")),"cBorder"===e&&(n.getElementById("card").className=t,"custom"===t?customBorderData?(n.getElementById("card").style.backgroundImage="url("+customBorderData+")",n.getElementById("card").style.backgroundSize="100% 100%",n.getElementById("card").style.border="none",n.getElementById("card").style.boxShadow="none"):alert("Please upload a Custom Frame file in Sidebar first!"):n.getElementById("card").style.backgroundImage="none","b1"!==t&&"b0"!==t&&n.getElementById("card").classList.add("active"),("b0"===t||"custom"===t)&&n.getElementById("card").classList.add("active"))}};window.openTV=function(){if(tvWindow=window.open("","GradTV","width=1280,height=720,menubar=no,toolbar=no"),!tvWindow)return alert("Enable Popups!");var e="url('Fonts/faruuma.ttf') format('truetype')";currentFontData&&(e="url('"+currentFontData+"') format('truetype')");for(var t="",n=["radial-gradient(circle, #004d40 0%, #001a12 100%)","radial-gradient(circle, #0d47a1 0%, #000022 100%)","radial-gradient(circle, #b71c1c 0%, #220000 100%)","linear-gradient(135deg, #000 0%, #333 50%, #000 100%)","radial-gradient(circle, #4a148c 0%, #1a0033 100%)","#010b14","conic-gradient(from 180deg at 50% 50%, #004d40 0deg, #00281c 360deg)","radial-gradient(circle at 50% 100%, #880e4f, #000)","repeating-linear-gradient(45deg, #111, #111 10px, #222 10px, #222 20px)","#000","linear-gradient(to right, #0f2027, #203a43, #2c5364)","linear-gradient(to right, #373b44, #4286f4)","linear-gradient(to right, #8e2de2, #4a00e0)","radial-gradient(circle at center, #665c00, #000)","radial-gradient(circle at center, #003300, #000)","linear-gradient(120deg, #fdfbfb 0%, #ebedee 100%)","linear-gradient(to top, #30cfd0 0%, #330867 100%)","linear-gradient(to top, #c471f5 0%, #fa71cd 100%)","linear-gradient(to right, #f83600 0%, #f9d423 100%)","radial-gradient(circle, #555, #000)","linear-gradient(to right, #43e97b 0%, #38f9d7 100%)","linear-gradient(to top, #09203f 0%, #537895 100%)","linear-gradient(-20deg, #b721ff 0%, #21d4fd 100%)","linear-gradient(to top, #1e3c72 0%, #2a5298 100%)","linear-gradient(to right, #243949 0%, #517fa4 100%)","radial-gradient(circle, #d4af37, #000)","linear-gradient(to right, #868f96 0%, #596164 100%)","radial-gradient(circle at bottom, #1b2735 0%, #090a0f 100%)","linear-gradient(to top, #000000 0%, #434343 74%)","linear-gradient(to right, #92fe9d 0%, #00c9ff 100%)","linear-gradient(45deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%)","linear-gradient(to top, #fbc2eb 0%, #a6c1ee 100%)","linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%)","linear-gradient(to top, #5f72bd 0%, #9b23ea 100%)","radial-gradient(circle, #330000, #000)","radial-gradient(circle, #000033, #000)","conic-gradient(#d4af37, #f0e68c, #d4af37)","linear-gradient(to bottom, #323232 0%, #3f3f3f 40%, #1c1c1c 150%), linear-gradient(to top, rgba(255,255,255,0.40) 0%, rgba(0,0,0,0.25) 200%)","radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%)","linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%)","linear-gradient(to right, #4facfe 0%, #00f2fe 100%)","linear-gradient(to top, #fff1eb 0%, #ace0f9 100%)","linear-gradient(to right, #fa709a 0%, #fee140 100%)","linear-gradient(to top, #c1dfc4 0%, #deecdd 100%)","linear-gradient(to top, #96fbc4 0%, #f9f586 100%)","linear-gradient(to top, #e6e9f0 0%, #eef1f5 100%)","linear-gradient(to top, #accbee 0%, #e7f0fd 100%)","linear-gradient(-225deg, #2CD8D5 0%, #C5C1FF 56%, #FFBAC3 100%)","linear-gradient(to right, #b2fefa 0%, #0ed2f7 100%)","linear-gradient(to right, #000000, #434343)"],a=0;a<50;a++)t+=".bg"+(a+1)+" { background: "+n[a%n.length]+"; }\n";var l=["border:none; box-shadow:0 0 100px #000;","border: 4px dashed var(--theme-color); box-shadow: 0 0 20px var(--theme-color); border-radius: 20px;","border: 15px solid var(--theme-color); border-radius: 10px; box-shadow: inset 0 0 40px #000;","border: 8px solid transparent; border-image: linear-gradient(45deg, var(--theme-color), #fff, var(--theme-color)) 1;","outline: 4px solid var(--theme-color); outline-offset: 10px; border: 2px solid var(--theme-color); margin: 15px;","border-top: 5px double var(--theme-color); border-bottom: 5px double var(--theme-color);","box-shadow: 0 20px 50px rgba(0,0,0,0.8); border: 1px solid rgba(255,255,255,0.1);","border: 20px solid #111; outline: 2px solid var(--theme-color); outline-offset: -10px;","border: 1px solid var(--theme-color); padding: 5px; outline: 1px solid var(--theme-color);","border-bottom: 3px solid var(--theme-color); border-top: 3px solid var(--theme-color); border-left: 1px solid var(--theme-color); border-right: 1px solid var(--theme-color);","background: radial-gradient(circle at top left, transparent 30px, rgba(0,20,15,0.92) 31px); border: 2px solid var(--theme-color);","border: 4px solid var(--theme-color); border-radius: 15px 0 15px 0;","border: 2px solid #fff; box-shadow: 0 0 10px var(--theme-color), 0 0 20px var(--theme-color), inset 0 0 20px var(--theme-color);","border: 30px solid rgba(255,255,255,0.05);","border: 10px ridge var(--theme-color);","border: 10px groove var(--theme-color);","border-top: 10px solid var(--theme-color); border-bottom: 10px solid var(--theme-color);","border-left: 20px solid var(--theme-color); border-right: 20px solid var(--theme-color);","transform: perspective(1000px) rotateX(2deg); border-bottom: 5px solid var(--theme-color);","background: rgba(255,255,255,0.1) !important; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);","border: 5px dotted var(--theme-color); border-radius: 30px;","box-shadow: inset 0 0 50px var(--theme-color); border: 2px solid var(--theme-color);","border-image: linear-gradient(to right, var(--theme-color), transparent) 1; border-bottom: 5px solid;","background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.5)); border: 1px solid var(--theme-color);","border: 3px solid var(--theme-color); border-radius: 50px 0 50px 0;","border-left: 15px solid var(--theme-color); background: rgba(0,0,0,0.3);","border: 1px solid var(--theme-color); box-shadow: 10px 10px 0 var(--theme-color);","border: 2px solid var(--theme-color); outline: 2px dashed #fff; outline-offset: -10px;","background: rgba(0,0,0,0.8); border: 1px solid #444; box-shadow: 0 0 20px #000;","border-top: 2px solid var(--theme-color); border-bottom: 2px solid var(--theme-color); background: linear-gradient(to right, transparent, rgba(255,255,255,0.05), transparent);","border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(5px); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);","border: 8px solid var(--theme-color); border-radius: 0 40px 0 40px;","border: 5px double #fff; outline: 2px solid var(--theme-color);","box-shadow: 0 0 15px var(--theme-color), inset 0 0 15px var(--theme-color); border-radius: 10px;","border-right: 10px solid var(--theme-color); border-bottom: 10px solid var(--theme-color); border-radius: 0 0 20px 0;","border: 1px solid var(--theme-color); background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.05) 10px, rgba(255,255,255,0.05) 20px);","border: 10px inset var(--theme-color);","border: 10px outset var(--theme-color);","border-top: 20px solid var(--theme-color); border-radius: 20px 20px 0 0;","border-bottom: 20px solid var(--theme-color); border-radius: 0 0 20px 20px;","border: 2px solid var(--theme-color); box-shadow: 5px 5px 0 #fff, 10px 10px 0 var(--theme-color);","background: linear-gradient(to bottom right, rgba(255,255,255,0.2), rgba(255,255,255,0.05)); border: 1px solid rgba(255,255,255,0.3); border-radius: 15px;","border-left: 5px solid var(--theme-color); border-right: 5px solid var(--theme-color); transform: skew(-10deg);","border: 3px dashed #fff; border-radius: 50%; width: 80vh; height: 80vh;","border: 20px solid transparent; border-image: url('https://via.placeholder.com/50') 30 stretch;","box-shadow: 0 -10px 20px rgba(0,0,0,0.5); border-top: 2px solid var(--theme-color);","border: 1px solid var(--theme-color); outline: 1px solid var(--theme-color); outline-offset: 5px;","background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.8) 100%); border: 1px solid #555;","border: 6px solid var(--theme-color); border-radius: 20px; box-shadow: 0 0 0 5px #000, 0 0 0 10px var(--theme-color);","border: none; background: linear-gradient(to right, transparent, rgba(212,175,55,0.2), transparent);"];for(a=0;a<50;a++)t+=".b"+(a+1)+" { "+(l[a]||l[0])+" }\n";var o=`\n        <!DOCTYPE html>\n        <html lang="dv" dir="rtl">\n        <head>\n            <style>\n                @font-face { font-family: 'Faruuma'; src: ${e}; }\n                @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');\n                :root { --theme-color: ${designState.bdColor}; }\n                body { margin:0; overflow:hidden; background:#000; font-family:'Faruuma', serif; user-select:none; }\n                #fsBtn { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); z-index:9999; padding:20px; font-size:20px; cursor:pointer; background:var(--theme-color); border:2px solid #fff; }\n                \n                #bgLayer { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; transition: background 0.5s ease; }\n                /* GENERATED CSS */\n                ${t}\n\n                /* --- WATERMARK STYLE --- */\n                .watermark {\n                    position: fixed;\n                    bottom: 5px;\n                    right: 10px;\n                    font-size: 10px; \n                    color: rgba(255, 255, 255, 0.2); \n                    z-index: 9999;\n                    pointer-events: none;\n                    font-family: sans-serif;\n                    font-weight: bold;\n                }\n\n                #jalsaContent { position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:10; transition: opacity 0.8s ease; opacity:1; }\n                #jalsaContent.hidden { opacity: 0; pointer-events:none; }\n                \n                #titleContainer { width: 90%; max-width: 1600px; text-align: center; } /* ADDED WIDTH FIX */\n                #mainTitleWrap { width: 100%; text-align: ${designState.mtAlign}; } /* ADDED WIDTH FIX */\n                #subTitleWrap { width: 100%; text-align: ${designState.stAlign}; } /* ADDED WIDTH FIX */\n\n                .jalsa-text { font-family: 'Faruuma', 'Amiri', serif; direction: rtl; display:block; width:100%; }\n                .main-title { font-size: ${designState.mtSize}em; color: ${designState.mtColor}; text-shadow: 2px 2px 10px black; margin-bottom: 20px; border-bottom: 3px solid ${designState.mtColor}; padding-bottom:10px; }\n                .sub-title { font-size: ${designState.stSize}em; color: ${designState.stColor}; text-shadow: 1px 1px 5px black; margin: 8px 0; }\n\n                #logoWrap { position:absolute; top:0; left:50%; transform:translate(calc(-50% + ${designState.logoX}px), ${designState.logoY}px); z-index:20; transition: all 0.3s ease; }\n                #logoImg { height:${designState.lSize}px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5)); transition:all 0.3s ease; }\n                \n                .logo-square { border-radius: 0; }\n                .logo-rounded { border-radius: 15px; }\n                .logo-circle { border-radius: 50%; }\n                .logo-egg { border-radius: 50% / 60% 40% 40% 60%; }\n\n                #card { position:absolute; top:54%; left:50%; transform:translate(-50%,-50%); width:90vw; max-width:1500px; height:80vh; display:flex; flex-direction:${designState.layoutDir==="rtl"?"row-reverse":"row"}; align-items:center; background:rgba(0,20,15,0.92); padding:3vh; box-sizing:border-box; opacity:0; transition:opacity 0.5s ease; z-index:15; }\n                #card.active { opacity:1; }\n\n                .b0 { border: none; background: transparent !important; box-shadow: none; }\n                .custom { border: none !important; box-shadow: none !important; }\n\n                .font-dv { font-family: 'Faruuma', 'Amiri', serif; }\n                .font-en { font-family: 'Times New Roman', serif; direction:ltr; }\n                h1 { font-size: 5em; margin:0; color:#fff; line-height:1.1; }\n                h2 { font-size: 3em; margin:10px 0; color:var(--theme-color); text-transform:uppercase; border-bottom:2px solid var(--theme-color); display:inline-block; width:100%; text-align:inherit; }\n                .fac-dv { font-size: 2em; color:#fff9c4; margin-top:10px; }\n                .fac-en { font-size: 1.6em; color:#fff9c4; font-weight:bold; margin-bottom:5px; text-align:inherit; }\n                .crs-dv { font-size: 2.5em; color:#fff9c4; font-weight:bold; }\n                .crs-en { font-size: 2em; color:#fff9c4; font-style:italic; margin-bottom:20px; text-align:inherit; }\n                .comm { background:rgba(212,175,55,0.15); border:2px solid var(--theme-color); padding:20px; font-size:2.2em; color:white; border-radius:10px; text-align:center; width:100%; box-sizing:border-box; transition: all 0.3s ease; }\n                \n                /* TINY COMMENT LINE STYLE */\n                .comm-tiny { padding: 0 !important; height: 3px !important; min-height: 0 !important; overflow: hidden; border:none !important; background: var(--theme-color); opacity: 0.6; margin-top:20px; }\n\n                .photo-col { flex:0 0 auto; min-width: 200px; display:flex; justify-content:center; align-items:center; transform:translate(${designState.pX}px, ${designState.pY}px); transition: transform 0.2s ease; height: 100%; }\n                \n                /* TINY PHOTO DOT STYLE */\n                .shrink-photo img { width: 8px !important; height: 8px !important; min-width: 0 !important; min-height: 0 !important; border-radius: 50% !important; border: none !important; box-shadow: 0 0 5px var(--theme-color) !important; background: var(--theme-color); padding: 0 !important; }\n                \n                #stuImg { width:${designState.pSize}px; height:${designState.pSize}px; object-fit:cover; border-radius:${designState.pShape}; border:5px solid var(--theme-color); background:#000; box-shadow:0 15px 40px rgba(0,0,0,0.8); transition: all 0.3s ease; }\n                #stuImg.portrait-mode { height: 95% !important; width: auto !important; max-width: 100%; object-fit: contain; border-radius: 10px; }\n\n                .text-col { flex:1; text-align:${designState.textAlign}; padding:0 30px; color:white; display:flex; flex-direction:column; justify-content:center; }\n                #videoLayer { position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:5000; display:none; justify-content:center; align-items:center; }\n                #videoLayer video, #videoLayer iframe { width:100%; height:100%; border:none; }\n                .copyright { position:absolute; bottom:10px; right:10px; font-size:10px; color:rgba(255,255,255,0.3); font-family:sans-serif; z-index:900; }\n            </style>\n            <script>function goFS(btn){document.documentElement.requestFullscreen(); btn.style.display='none';}<\/script>\n        </head>\n        <body>\n            <div class="watermark">AIDD(7791550)</div> \n            <button id="fsBtn" onclick="goFS(this)">‚õ∂ FULL SCREEN</button>\n            <div id="videoLayer"></div>\n            <div id="bgLayer" class="${designState.bgPreset}"></div>\n            <div id="logoWrap"><img id="logoImg" class="logo-${designState.lShape}" src="https://via.placeholder.com/180x180/00281c/d4af37?text=LOGO"></div>\n\n            <div id="jalsaContent">\n                <div id="titleContainer" style="margin-top:${designState.mtY}px;"> \n                    <div id="mainTitleWrap"><div id="jt1" class="main-title jalsa-text"></div></div>\n                    <div id="subTitleWrap">\n                        <div id="jt2" class="sub-title jalsa-text"></div>\n                        <div id="jt3" class="sub-title jalsa-text"></div>\n                        <div id="jt4" class="sub-title jalsa-text"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div id="card" class="${designState.cBorder}">\n                <div class="photo-col"><img id="stuImg" src=""></div>\n                <div class="text-col">\n                    <h1 id="tnD" class="font-dv"></h1><h2 id="tnE" class="font-en"></h2>\n                    <div id="tfD" class="fac-dv font-dv"></div><div id="tfE" class="fac-en font-en"></div>\n                    <div id="tcD" class="crs-dv font-dv"></div><div id="tcE" class="crs-en font-en"></div>\n                    <div id="tcm" class="comm font-dv"></div>\n                </div>\n            </div>\n            <div class="copyright">¬© Ali Ibrahim Didi (7791550)</div>\n        </body>\n        </html>`;tvWindow.document.write(o),tvWindow.document.close(),currentLogoData&&(tvWindow.document.getElementById("logoImg").src=currentLogoData),window.updateJalsaBackground(),window.updateJalsaText(),window.liveUpdate("pShape",designState.pShape),window.liveUpdate("pVis",designState.pVis),window.liveUpdate("lVis",designState.lVis),window.liveUpdate("lShape",designState.lShape),window.liveUpdate("bgLoop",designState.bgLoop),window.liveUpdate("tLine",designState.tLine),window.liveUpdate("nameColor",designState.nameColor),window.liveUpdate("detColor",designState.detColor),window.liveUpdate("commColor",designState.commColor),window.liveUpdate("mtX",designState.mtX),window.liveUpdate("layoutDir",designState.layoutDir),window.liveUpdate("nLine",designState.nLine),window.liveUpdate("mtAlign",designState.mtAlign),window.liveUpdate("stAlign",designState.stAlign),window.liveUpdate("stSize",designState.stSize),window.liveUpdate("stColor",designState.stColor),window.liveUpdate("tnDSize",designState.tnDSize),window.liveUpdate("tnDColor",designState.tnDColor),window.liveUpdate("tnESize",designState.tnESize),window.liveUpdate("tnEColor",designState.tnEColor),window.liveUpdate("tfDSize",designState.tfDSize),window.liveUpdate("tfDColor",designState.tfDColor),window.liveUpdate("tcDSize",designState.tcDSize),window.liveUpdate("tcDColor",designState.tcDColor),"custom"===designState.cBorder&&customBorderData&&window.liveUpdate("cBorder","custom"),document.getElementById("connStatus").innerText="‚úÖ Connected",document.getElementById("connStatus").style.color="green"};window.updateJalsaBackground=function(){if(tvWindow&&!tvWindow.closed&&currentJalsaBgData){var e=tvWindow.document.getElementById("bgLayer");"video"===currentJalsaBgType?(e.innerHTML="<video id='bgVid' src='"+currentJalsaBgData+"' autoplay loop muted style='width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:-1;'></video>",setTimeout(function(){var e=tvWindow.document.getElementById("bgVid");e&&e.play().catch(function(e){})},500)):"image"===currentJalsaBgType&&(e.innerHTML="<img src='"+currentJalsaBgData+"' style='width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; z-index:-1;'>")}};window.updateJalsaText=function(){if(tvWindow&&!tvWindow.closed){var e=tvWindow.document;if(e.getElementById("jt1").innerText=document.getElementById("jLine1").value,e.getElementById("jt2").innerText=document.getElementById("jLine2").value,e.getElementById("jt3").innerText=document.getElementById("jLine3").value,e.getElementById("jt4").innerText=document.getElementById("jLine4").value,currentFontData){var t=e.createElement("style");t.innerHTML="@font-face { font-family: 'Faruuma'; src: url('"+currentFontData+"') format('truetype'); } .jalsa-text, .font-dv { font-family: 'Faruuma', 'Amiri', serif !important; }",e.head.appendChild(t)}}};window.showJalsaScreen=function(){if(tvWindow&&!tvWindow.closed){tvWindow.document.getElementById("card").classList.remove("active"),tvWindow.document.getElementById("jalsaContent").classList.remove("hidden");var e=tvWindow.document.getElementById("logoWrap");e.style.display="show"===designState.lVis?"block":"none",document.getElementById("statusMsg").innerText="Mode: Jalsa"}};window.updateTV=function(){if(!tvWindow||tvWindow.closed)return alert("TV Closed!");tvWindow.document.getElementById("jalsaContent").classList.add("hidden");var e=tvWindow.document.getElementById("logoWrap");e.style.display="show"===designState.lVis?"block":"none";var t=tvWindow.document;t.getElementById("tnD").textContent=document.getElementById("nD").value,t.getElementById("tnE").textContent=document.getElementById("nE").value,t.getElementById("tfD").textContent=document.getElementById("fD").value,t.getElementById("tfE").textContent=document.getElementById("fE").value,t.getElementById("tcD").textContent=document.getElementById("cD").value,t.getElementById("tcE").textContent=document.getElementById("cE").value;var n=document.getElementById("cm").value,a=t.getElementById("tcm");n&&""!==n.trim()?(a.textContent=n,a.classList.remove("comm-tiny")):(a.textContent="",a.classList.add("comm-tiny"));var l=t.getElementById("stuImg"),o=t.querySelector(".photo-col");currentPhotoData?(l.src=currentPhotoData,l.style.display="block",o.classList.remove("shrink-photo")):(l.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",o.classList.add("shrink-photo")),setTimeout(function(){t.getElementById("card").classList.add("active")},300),window.stopVideo(),document.getElementById("statusMsg").innerText="On Air: "+document.getElementById("nE").value};window.clearTV=function(){tvWindow&&!tvWindow.closed&&(window.showJalsaScreen(),window.stopVideo(),document.getElementById("statusMsg").innerText="Screen Cleared")};window.playLocalVideo=function(){if(!tvWindow||tvWindow.closed)return alert("TV Closed!");tvWindow.document.getElementById("jalsaContent").classList.add("hidden");var e=document.getElementById("videoLocal").files[0];if(!e)return alert("Select video!");var t=URL.createObjectURL(e),n=tvWindow.document.getElementById("videoLayer");n.innerHTML="<video id='mainVid' src='"+t+"' autoplay controls style='width:100%;height:100%;'></video>",n.style.display="flex",setTimeout(function(){var e=tvWindow.document.getElementById("mainVid");e&&e.play().catch(function(e){alert("Click TV screen to enable audio.")})},100),document.getElementById("statusMsg").innerText="Playing Video..."};window.playYoutube=function(){if(!tvWindow||tvWindow.closed)return alert("TV Closed!");tvWindow.document.getElementById("jalsaContent").classList.add("hidden");var e=document.getElementById("ytLink").value;if(e){var t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/),n=t&&11===t[2].length?t[2]:null;if(n){var a=tvWindow.document.getElementById("videoLayer");a.innerHTML="<iframe src='https://www.youtube.com/embed/"+n+"?autoplay=1&mute=0' allow='autoplay; encrypted-media' style='width:100%;height:100%;border:none;'></iframe>",a.style.display="flex",document.getElementById("statusMsg").innerText="Playing YouTube..."}}};window.stopVideo=function(){if(tvWindow&&!tvWindow.closed){var e=tvWindow.document.getElementById("videoLayer");e.innerHTML="",e.style.display="none",tvWindow.document.getElementById("card").classList.contains("active")||window.showJalsaScreen()}};document.getElementById("jalsaCsvFile").onchange=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){var t=e.target.result.split("\n");if(t.length>0){var n=t[0].split(",");n[0]&&(document.getElementById("jLine1").value=n[0].trim()),n[1]&&(document.getElementById("jLine2").value=n[1].trim()),n[2]&&(document.getElementById("jLine3").value=n[2].trim()),n[3]&&(document.getElementById("jLine4").value=n[3].trim()),window.updateJalsaText(),alert("Titles Loaded!")}},n.readAsText(t)}};document.getElementById("fontFile").onchange=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){currentFontData=e.target.result,new FontFace("Faruuma","url("+currentFontData+")").load().then(function(e){document.fonts.add(e),document.querySelectorAll(".font-dv, input, h2").forEach(function(e){e.style.fontFamily="'Faruuma', serif"}),alert("Font Loaded! Re-open TV.")})},n.readAsDataURL(t)}};document.getElementById("jalsaBgFile").onchange=function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){currentJalsaBgData=e.target.result,currentJalsaBgType=t.type.startsWith("video")?"video":"image",window.updateJalsaBackground(),alert("Background Set")},n.readAsDataURL(t)}};document.getElementById("logoFile").onchange=function(e){var t=new FileReader;t.onload=function(e){currentLogoData=e.target.result,tvWindow&&!tvWindow.closed&&(tvWindow.document.getElementById("logoImg").src=currentLogoData)},t.readAsDataURL(e.target.files[0])};document.getElementById("customBorderFile").onchange=function(e){var t=new FileReader;t.onload=function(e){customBorderData=e.target.result,"custom"===designState.cBorder&&window.liveUpdate("cBorder","custom"),alert("Custom Border Loaded!")},t.readAsDataURL(e.target.files[0])};document.getElementById("csvFile").onchange=function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;65279===t.charCodeAt(0)&&(t=t.substr(1));var n=t.split("\n");students=[],n.forEach(function(e){var t=e.split(",");t.length>1&&students.push({nD:t[0]?t[0].trim():"",nE:t[1]?t[1].trim():"",cD:t[2]?t[2].trim():"",cE:t[3]?t[3].trim():"",fD:t[4]?t[4].trim():"",fE:t[5]?t[5].trim():"",cm:t[6]?t[6].trim():"",ph:t[7]?t[7].trim():""})}),window.filterList(),alert("Loaded: "+students.length)},t.readAsText(e.target.files[0])};document.getElementById("photoFolder").onchange=function(e){photoFiles={};for(var t=0;t<e.target.files.length;t++){var n=e.target.files[t],a=n.name.toLowerCase();photoFiles[a]=n;var l=a.split(".").slice(0,-1).join(".");l&&(photoFiles[l]=n)}alert("Photos: "+e.target.files.length)};window.processPhoto=function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsDataURL(e)};window.manualPhoto=function(e){e.files&&e.files[0]&&window.processPhoto(e.files[0],function(e){currentPhotoData=e,document.getElementById("previewImg").src=e,document.getElementById("pStat").innerText="Manual",document.getElementById("pStat").style.color="blue"})};window.filterList=function(){var e=document.getElementById("search").value.toLowerCase(),t=document.getElementById("stuList");t.innerHTML="",students.forEach(function(n,a){if((n.nD+n.nE).toLowerCase().includes(e)){var l=document.createElement("option");l.value=a,l.text=a+1+". "+n.nD,t.add(l)}})};window.loadStudent=function(){var e=document.getElementById("stuList").value,t=students[e];document.getElementById("nD").value=t.nD||"",document.getElementById("nE").value=t.nE||"",document.getElementById("fD").value=t.fD||"",document.getElementById("fE").value=t.fE||"",document.getElementById("cD").value=t.cD||"",document.getElementById("cE").value=t.cE||"",document.getElementById("cm").value=t.cm||"";var n=t.ph?t.ph.trim().toLowerCase():"",a=document.getElementById("previewImg"),l=document.getElementById("pStat"),o=photoFiles[n];o?(l.innerText="Loading...",window.processPhoto(o,function(e){currentPhotoData=e,a.src=e,l.innerText="‚úÖ Found",l.style.color="green"})):(currentPhotoData=null,a.src="https://via.placeholder.com/150",l.innerText="‚ùå Missing",l.style.color="red")};window.move=function(e){var t=document.getElementById("stuList");t.options.length&&(t.selectedIndex=Math.min(Math.max(t.selectedIndex+e,0),t.options.length-1),window.loadStudent())};
</script>
</body>
</html>
