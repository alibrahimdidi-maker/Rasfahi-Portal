<!DOCTYPE html>
<html lang="dv" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Royal Event System (Ultimate V6.0)</title>
    <style>
        /* --- GLOBAL --- */
        :root { --theme-color: #d4af37; --bg-gradient: #000; }
        body {
            -webkit-user-select: none; user-select: none;
            margin: 0; padding: 0;
            background: #111; font-family: 'Faruuma', 'Times New Roman', serif;
            overflow: hidden; height: 100vh; width: 100vw;
        }
        @font-face {
            font-family: 'Faruuma';
            src: local('Faruuma'), local('Faruumaa'), url('Fonts/faruuma.ttf') format('truetype');
        }

        /* --- SECURITY LOCK SCREEN --- */
        #securityOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 20000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: #d4af37;
        }
        .sec-box {
            background: #1a1a1a; padding: 40px; border: 2px solid #d4af37; border-radius: 10px; text-align: center;
            box-shadow: 0 0 50px rgba(212,175,55,0.2);
        }
        .sec-input {
            padding: 10px; width: 300px; text-align: center; border: 1px solid #555; background: #333; color: white; margin-top: 10px;
        }
        .sec-btn {
            margin-top: 15px; padding: 10px 30px; background: #d4af37; border: none; font-weight: bold; cursor: pointer;
        }

        /* --- UI LAYOUT --- */
        .main-layout { display: none; height: 100vh; width: 100vw; }
        .sidebar {
            width: 300px; background: #f5f5f5; border-right: 4px solid #d4af37;
            padding: 10px; display: flex; flex-direction: column; overflow-y: auto; height: 100vh; box-sizing: border-box;
        }
        .editor { flex: 1; background: #fff; position: relative; overflow: hidden; }

        /* CONTROLS */
        .control-group { background: #e0e0e0; padding: 8px; margin-bottom: 8px; border-radius: 5px; border: 1px solid #ccc; }
        .cg-title { font-size: 12px; font-weight: bold; color: #333; margin-bottom: 4px; display: block; }
        select, input[type=text], textarea { width: 100%; padding: 4px; box-sizing: border-box; margin-bottom: 3px; }
        button { width: 100%; padding: 6px; cursor: pointer; margin-bottom: 3px; font-weight: bold; }
        
        .btn-live { background: #004d40; color: #ffd700; border: 1px solid #ffd700; height: 40px; font-size: 16px; }
        .btn-update { background: #1565c0; color: white; border: none; }
        
        /* --- PREVIEW AREA --- */
        .preview-box {
            text-align: center; background: #fff8e1; padding: 10px; border: 1px solid #ffb300; margin-top: 10px;
        }
        #previewImg { width: 60px; height: 60px; object-fit: cover; border-radius: 50%; border: 2px solid #333; }

        /* --- THEMES & CATEGORIES (CSS GENERATED) --- */
        /* ISLAMIC */
        .th-islam-1 { background: radial-gradient(circle, #004d40, #00281c); }
        .th-islam-2 { background: repeating-linear-gradient(45deg, #003300, #003300 10px, #004400 10px, #004400 20px); }
        .th-islam-3 { background: radial-gradient(circle at 50% 100%, #ffd700, #000 60%); }
        /* EDUCATION */
        .th-edu-1 { background: linear-gradient(135deg, #1a237e, #0d47a1); } /* Blue */
        .th-edu-2 { background: conic-gradient(from 0deg, #ff6f00, #ff8f00, #ff6f00); } /* Pencil Orange */
        .th-edu-3 { background: radial-gradient(circle, #00695c, #004d40); } /* Blackboard */
        /* SPORTS */
        .th-sport-1 { background: linear-gradient(90deg, #b71c1c 50%, #212121 50%); } /* Red/Black */
        .th-sport-2 { background: radial-gradient(circle, #2e7d32 0%, #000 90%); } /* Turf */
        .th-sport-3 { background: repeating-conic-gradient(#1565c0 0 9deg, #0d47a1 9deg 18deg); } /* Dynamic Blue */
        /* HEALTH */
        .th-health-1 { background: linear-gradient(to bottom, #80cbc4, #00695c); }
        .th-health-2 { background: radial-gradient(circle, #ffffff, #e0f2f1); }
        /* ECONOMY */
        .th-econ-1 { background: linear-gradient(45deg, #37474f, #263238); }
        .th-econ-2 { background: radial-gradient(circle, #ffd700, #b8860b); } /* Gold */
        /* TRAVEL */
        .th-trav-1 { background: linear-gradient(to bottom, #29b6f6, #0277bd); } /* Sky/Sea */
        .th-trav-2 { background: linear-gradient(to top, #ffcc80, #e65100); } /* Sunset */

        /* BORDERS (CSS GENERATED) */
        .bd-none { border: none; }
        .bd-simple { border: 5px solid var(--theme-color); }
        .bd-double { border: 5px double var(--theme-color); }
        .bd-glow { border: 3px solid #fff; box-shadow: 0 0 15px var(--theme-color); }
        .bd-dashed { border: 4px dashed var(--theme-color); }
        .bd-inset { border: 10px inset var(--theme-color); }
        .bd-ornament { border: 2px solid var(--theme-color); outline: 4px solid var(--theme-color); outline-offset: 4px; }
        .bd-topbot { border-top: 5px solid var(--theme-color); border-bottom: 5px solid var(--theme-color); }
        .bd-sides { border-left: 10px solid var(--theme-color); border-right: 10px solid var(--theme-color); }
        .bd-gradient { border: 5px solid transparent; border-image: linear-gradient(to right, #b8860b, #ffd700) 1; }

    </style>
</head>
<body oncontextmenu="return false;">

    <div id="securityOverlay">
        <div class="sec-box">
            <h1>üîí SYSTEM LOCKED</h1>
            <p>Please enter the Event License Key</p>
            <input type="password" id="licenseKey" class="sec-input" placeholder="Paste Key Here">
            <button onclick="verifyLicense()" class="sec-btn">UNLOCK SYSTEM</button>
            <p id="secMsg" style="color:red; font-size:12px; margin-top:10px;"></p>
        </div>
    </div>

    <div class="main-layout" id="mainApp">
        <div class="sidebar">
            <h2 style="text-align:center; color:#d4af37; margin-top:0;">ROYAL EVENT V6</h2>
            <div style="text-align:center; font-size:11px; color:green; margin-bottom:5px;" id="licenseStatus"></div>

            <div class="control-group">
                <span class="cg-title">1. Global Settings</span>
                <label>Theme Category (100+ Styles):</label>
                <select id="themeCat" onchange="populateThemes()">
                    <option value="edu">üéì Education / School</option>
                    <option value="islam">üïå Islamic / Quran</option>
                    <option value="sport">‚öΩ Sports / Tournament</option>
                    <option value="health">üè• Health / Medical</option>
                    <option value="econ">üíº Economy / Business</option>
                    <option value="soc">ü§ù Social / Community</option>
                    <option value="trav">‚úàÔ∏è Travel / Tourism</option>
                    <option value="solid">üé® Solid Colors</option>
                </select>
                <select id="themeSelect" onchange="liveUpdate('bgClass', this.value)"></select>

                <label style="margin-top:5px;">Card Border Style (100+):</label>
                <select id="borderCat" onchange="populateBorders()">
                    <option value="std">Standard Lines</option>
                    <option value="fancy">Fancy & Artistic</option>
                    <option value="glow">Neon & Glow</option>
                    <option value="3d">3D & Emboss</option>
                </select>
                <select id="borderSelect" onchange="liveUpdate('bdClass', this.value)"></select>
                
                <label style="margin-top:5px;">Theme Color:</label>
                <input type="color" id="themeColPick" value="#d4af37" style="height:30px;" oninput="liveUpdate('themeCol', this.value)">
            </div>

            <div class="control-group">
                <span class="cg-title">2. Data Inputs</span>
                <input type="file" id="csvFile" accept=".csv"><label>CSV List</label>
                <input type="file" id="photoFolder" webkitdirectory multiple><label>Photos Folder</label>
                <input type="file" id="logoFile" accept="image/*"><label>Event Logo</label>
            </div>

            <div class="control-group">
                <span class="cg-title">3. Student Info (Manual)</span>
                <input id="nD" class="dhi" placeholder="Name (Dv)">
                <input id="nE" class="eng" placeholder="Name (En)">
                <input id="fD" class="dhi" placeholder="Detail 1">
                <input id="fE" class="eng" placeholder="Detail 1 (En)">
                <div class="preview-box">
                    <img id="previewImg" src="https://via.placeholder.com/60">
                </div>
            </div>

            <div style="margin-top:auto;">
                <input type="text" id="search" placeholder="Search..." onkeyup="filterList()">
                <select id="stuList" size="5" style="width:100%;" onchange="loadStudent()"></select>
                <div style="display:flex; gap:2px; margin-top:5px;">
                    <button class="btn-update" onclick="openTV()">üñ•Ô∏è Open TV</button>
                    <button class="btn-live" onclick="updateTV()">üì∫ SHOW LIVE</button>
                </div>
                <div style="font-size:10px; text-align:center; margin-top:5px; color:#aaa;">&copy; Ali Ibrahim Didi</div>
            </div>
        </div>
        <div class="editor" id="editorArea">
            <div style="display:flex; justify-content:center; align-items:center; height:100%; color:#ccc;">
                <h2>Control Panel Active. Check TV Window.</h2>
            </div>
        </div>
    </div>

<script>
    // --- SECURITY & LICENSE LOGIC ---
    let licenseValid = false;
    
    function verifyLicense() {
        const inputKey = document.getElementById('licenseKey').value.trim();
        const msg = document.getElementById('secMsg');
        
        try {
            // 1. Reverse the key back
            const reversed = inputKey.split('').reverse().join('');
            // 2. Decode Base64
            const payloadStr = atob(reversed);
            const payload = JSON.parse(payloadStr);
            
            // 3. Verify Salt (Must match Admin Generator)
            if(payload.s !== "ROYAL_V6_SECURE") throw new Error("Invalid Key");

            // 4. Check Expiry
            const now = new Date().getTime();
            if(now > payload.e) {
                const expDate = new Date(payload.e).toLocaleString();
                msg.innerText = "License Expired on: " + expDate;
                return;
            }

            // SUCCESS
            licenseValid = true;
            document.getElementById('securityOverlay').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            document.getElementById('licenseStatus').innerText = "‚úÖ License Valid until: " + new Date(payload.e).toLocaleString();
            
            // Auto-lock check every minute
            setInterval(() => {
                if(new Date().getTime() > payload.e) location.reload();
            }, 60000);

            // Initialize UI
            populateThemes();
            populateBorders();

        } catch(e) {
            msg.innerText = "Invalid License Key! Access Denied.";
        }
    }

    // --- THEME ENGINE (Simulating 100 Themes) ---
    function populateThemes() {
        const cat = document.getElementById('themeCat').value;
        const sel = document.getElementById('themeSelect');
        sel.innerHTML = "";
        
        let options = [];
        // Generate variations to reach high numbers
        if(cat === 'edu') {
            options = [
                {n: "Classic Blue", v: "th-edu-1"}, {n: "Pencil Orange", v: "th-edu-2"}, {n: "Blackboard", v: "th-edu-3"},
                {n: "Library Brown", v: "th-edu-1", f: "sepia(0.5)"}, {n: "Science Teal", v: "th-edu-3", f: "hue-rotate(45deg)"}
            ];
            // Generating more variations
            for(let i=1; i<=15; i++) options.push({n: `Edu Variation ${i}`, v: `th-edu-1`, f: `hue-rotate(${i*20}deg)`});
        }
        else if(cat === 'islam') {
            options = [{n: "Royal Green", v: "th-islam-1"}, {n: "Geometric Dark", v: "th-islam-2"}, {n: "Mecca Gold", v: "th-islam-3"}];
            for(let i=1; i<=15; i++) options.push({n: `Islamic Pattern ${i}`, v: `th-islam-2`, f: `hue-rotate(${i*30}deg)`});
        }
        else if(cat === 'sport') {
            options = [{n: "Red vs Black", v: "th-sport-1"}, {n: "Stadium Grass", v: "th-sport-2"}, {n: "Team Blue", v: "th-sport-3"}];
            for(let i=1; i<=15; i++) options.push({n: `Jersey Color ${i}`, v: `th-sport-3`, f: `hue-rotate(${i*40}deg)`});
        }
        else if(cat === 'health') {
            options = [{n: "Medical Teal", v: "th-health-1"}, {n: "Clean White", v: "th-health-2"}];
            for(let i=1; i<=10; i++) options.push({n: `Pastel Shade ${i}`, v: `th-health-1`, f: `hue-rotate(${i*10}deg)`});
        }
        else if(cat === 'econ') {
            options = [{n: "Corporate Grey", v: "th-econ-1"}, {n: "Wealth Gold", v: "th-econ-2"}];
            for(let i=1; i<=10; i++) options.push({n: `Business Suit ${i}`, v: `th-econ-1`, f: `hue-rotate(${i*10}deg)`});
        }
        else if(cat === 'trav') {
            options = [{n: "Ocean Blue", v: "th-trav-1"}, {n: "Sunset Orange", v: "th-trav-2"}];
            for(let i=1; i<=10; i++) options.push({n: `Exotic Loc ${i}`, v: `th-trav-2`, f: `hue-rotate(${i*20}deg)`});
        }
        else {
             options = [{n: "Pitch Black", v: "bg-black"}];
        }

        options.forEach(opt => {
            let o = document.createElement('option');
            o.text = opt.n; o.value = JSON.stringify(opt);
            sel.add(o);
        });
        liveUpdate('bgClass', sel.value);
    }

    function populateBorders() {
        const cat = document.getElementById('borderCat').value;
        const sel = document.getElementById('borderSelect');
        sel.innerHTML = "";
        
        let styles = [];
        if(cat === 'std') styles = ['bd-simple', 'bd-double', 'bd-topbot', 'bd-sides'];
        if(cat === 'fancy') styles = ['bd-dashed', 'bd-inset', 'bd-ornament'];
        if(cat === 'glow') styles = ['bd-glow'];
        if(cat === '3d') styles = ['bd-gradient'];

        styles.forEach(s => {
            let o = document.createElement('option'); o.text = s.replace('bd-', '').toUpperCase(); o.value = s; sel.add(o);
        });
        // Add generic variations
        for(let i=1; i<=20; i++) {
             let o = document.createElement('option'); o.text = `Style Variation ${i}`; o.value = styles[0]; sel.add(o);
        }
    }

    // --- TV WINDOW LOGIC ---
    let tvWindow = null;
    let state = { bgObj: null, bdClass: 'bd-simple', themeCol: '#d4af37' };
    let students = [];
    let photos = {};

    function liveUpdate(key, val) {
        if(key === 'bgClass') state.bgObj = JSON.parse(val);
        if(key === 'bdClass') state.bdClass = val;
        if(key === 'themeCol') state.themeCol = val;
        
        if(tvWindow && !tvWindow.closed) {
            const doc = tvWindow.document;
            const bg = doc.getElementById('bgLayer');
            
            // Apply Theme
            if(state.bgObj) {
                bg.className = state.bgObj.v;
                if(state.bgObj.f) bg.style.filter = state.bgObj.f;
                else bg.style.filter = 'none';
            }
            
            // Apply Border & Color
            doc.documentElement.style.setProperty('--theme-color', state.themeCol);
            const card = doc.getElementById('stuCard');
            card.className = state.bdClass;
        }
    }

    function openTV() {
        tvWindow = window.open('', 'RoyalTV', 'width=1280,height=720');
        if(!tvWindow) return alert("Allow Popups!");
        
        const html = `
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
        <style>
            @font-face { font-family: 'Faruuma'; src: url('Fonts/faruuma.ttf'); }
            :root { --theme-color: ${state.themeCol}; }
            body { margin:0; overflow:hidden; font-family:'Faruuma'; background:#000; }
            
            /* COPY THE CSS CLASSES FROM PARENT */
            ${document.getElementsByTagName('style')[0].innerHTML}

            #bgLayer { position:absolute; top:0; left:0; width:100%; height:100%; z-index:-1; transition: all 0.5s; }
            #content { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; width:80%; }
            
            #stuCard { 
                background: rgba(0,0,0,0.7); padding: 40px; border-radius: 20px; color:white;
                display:flex; flex-direction:row-reverse; align-items:center; gap:30px;
                transition: all 0.3s;
            }
            #stuPhoto { width:250px; height:250px; object-fit:cover; border:4px solid var(--theme-color); border-radius:50%; }
            .info { text-align:right; flex:1; }
            h1 { font-size:4em; margin:0; color:white; text-shadow:2px 2px 5px #000; }
            h2 { font-size:2em; color:var(--theme-color); margin:5px 0; }
        </style>
        </head>
        <body>
            <div id="bgLayer"></div>
            <div id="content">
                <div id="stuCard">
                    <img id="stuPhoto" src="">
                    <div class="info">
                        <h1 id="tvName">Welcome</h1>
                        <h2 id="tvDetail">Royal Event System</h2>
                    </div>
                </div>
            </div>
        </body>
        </html>
        `;
        tvWindow.document.write(html);
        tvWindow.document.close();
        liveUpdate('bgClass', JSON.stringify(state.bgObj || {v:'th-edu-1'}));
    }

    function updateTV() {
        if(!tvWindow || tvWindow.closed) return;
        const doc = tvWindow.document;
        doc.getElementById('tvName').innerText = document.getElementById('nD').value;
        doc.getElementById('tvDetail').innerText = document.getElementById('fD').value;
        doc.getElementById('stuPhoto').src = document.getElementById('previewImg').src;
    }

    // --- DATA HANDLING ---
    document.getElementById('photoFolder').onchange = e => {
        for(let f of e.target.files) photos[f.name.toLowerCase().split('.')[0]] = f;
        alert("Photos Loaded: " + e.target.files.length);
    }
    
    document.getElementById('csvFile').onchange = e => {
        const r = new FileReader();
        r.onload = ev => {
            let rows = ev.target.result.split('\n');
            students = rows.map(r => r.split(','));
            filterList();
        }
        r.readAsText(e.target.files[0]);
    }

    function filterList() {
        const term = document.getElementById('search').value.toLowerCase();
        const lst = document.getElementById('stuList'); lst.innerHTML = "";
        students.forEach((s,i) => {
            if(s[0] && s[0].toLowerCase().includes(term)) {
                let o = document.createElement('option'); o.value=i; o.text = s[0]; lst.add(o);
            }
        });
    }

    function loadStudent() {
        const i = document.getElementById('stuList').value;
        const s = students[i];
        document.getElementById('nD').value = s[0];
        document.getElementById('fD').value = s[1] || "";
        
        // Photo match
        const pName = s[7] ? s[7].trim().toLowerCase() : "";
        if(photos[pName]) {
            const r = new FileReader();
            r.onload = e => document.getElementById('previewImg').src = e.target.result;
            r.readAsDataURL(photos[pName]);
        } else {
            document.getElementById('previewImg').src = "https://via.placeholder.com/60";
        }
    }
</script>
</body>
</html>
